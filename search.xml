<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Linux 用户与组</title>
    <url>/2592592171/</url>
    <content><![CDATA[<h1 id="用户标识符"><a class="markdownIt-Anchor" href="#用户标识符"></a> 用户标识符</h1>
<p>每个用户至少都有两个 ID，用户 ID（UID，User ID）和用户组 ID（GID，Group ID）。</p>
<p>当显示文件属性时，系统会根据 <code>/etc/passwd</code> 与 <code>/etc/group</code> 文件的内容找到 UID/GID 对应的账号与组名再显示出来。</p>
<h1 id="用户账号"><a class="markdownIt-Anchor" href="#用户账号"></a> 用户账号</h1>
<p>用户通过终端或 SSH 登录时，系统的处理过程如下：</p>
<ol>
<li>首先在 <code>/etc/passwd</code> 中查找是否存在输入的账户，如果存在，则读取对应的 UID、GID、主目录和 shell 设置。</li>
<li>核对输入的密码是否与 <code>/etc/shadow</code> 记录匹配。</li>
<li>如果账户和密码都正确，就可以进入 shell。</li>
</ol>
<h2 id="etcpasswd-文件结构"><a class="markdownIt-Anchor" href="#etcpasswd-文件结构"></a> /etc/passwd 文件结构</h2>
<p>passwd 中以行为单位记录系统中所有账号，各字段之间用冒号分隔开：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">head</span> <span class="token parameter variable">-4</span> /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上以第一条为例，总共七个字段，说明如下：</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>root</td>
<td>账号名称，用来对应 UID。</td>
</tr>
<tr>
<td>2</td>
<td>x</td>
<td>密码，早期 UNIX 用来存放加密过的密码字段。</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>UID，其中 0 固定为 root 用，1-499 号留给系统账号用，500 之后为一般用户。</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
<td>GID，组信息保存在 <code>/etc/group</code> 中。</td>
</tr>
<tr>
<td>5</td>
<td>root</td>
<td>用户信息说明列，只是用来解释账号意义。</td>
</tr>
<tr>
<td>6</td>
<td>/root</td>
<td>用户主文件夹位置。</td>
</tr>
<tr>
<td>7</td>
<td>/bin/bash</td>
<td>默认使用的 shell。如果是 <code>/sbin/nologin</code> 代表不能登录。</td>
</tr>
</tbody>
</table>
<h2 id="etcshadow-文件结构"><a class="markdownIt-Anchor" href="#etcshadow-文件结构"></a> /etc/shadow 文件结构</h2>
<p>shadow 文件中保存了密码和相关限制设置：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/shadow
root:<span class="token variable">$6</span><span class="token variable">$A7YdIFXQJ47yq0</span>::0:99999:7:::
bin:*:17632:0:99999:7:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>以第一条记录为例，总共有九个字段，说明如下：</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>root</td>
<td>账户名。</td>
</tr>
<tr>
<td>2</td>
<td>7YdIFXQJ47yq0</td>
<td>编码过的密码，使用不同编码方式产生的长度不同。</td>
</tr>
<tr>
<td>3</td>
<td>13400</td>
<td>最近改动密码的日期，以 1970/01/01 作为基准计算经过时间。</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
<td>密码不可被改动的天数，0 无限制，11 表示每次修改密码的等待间隔为 11 天。</td>
</tr>
<tr>
<td>5</td>
<td>99999</td>
<td>密码过期的期限天数，如果超过这个限制天数没改密码，密码会变为已过期。</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>密码过期前发出警告的提前天数。</td>
</tr>
<tr>
<td>7</td>
<td>14</td>
<td>密码过期后的账号宽限时间。</td>
</tr>
<tr>
<td>8</td>
<td>14800</td>
<td>账号失效日期，过了限制日期后账号无法再使用。</td>
</tr>
<tr>
<td>9</td>
<td>-</td>
<td>保留字段。</td>
</tr>
</tbody>
</table>
<h1 id="用户组"><a class="markdownIt-Anchor" href="#用户组"></a> 用户组</h1>
<p>用户组可以将账户集中在一起组成一个逻辑排列，从而简化特权管理。和用户组有关的文件记录在 <code>/etc/group</code> 与 <code>/etc/gshadow</code> 中。</p>
<h2 id="etcgroup-文件结构"><a class="markdownIt-Anchor" href="#etcgroup-文件结构"></a> /etc/group 文件结构</h2>
<p>group 文件记录 GID 与组名的对应：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/group
root:x:0:
bin:x:1:
daemon:x:2:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>以第一条记录为例，总共有四个字段，说明如下：</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>root</td>
<td>用户组名。</td>
</tr>
<tr>
<td>2</td>
<td>x</td>
<td>用户组密码，不再使用。</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>用户组 ID。</td>
</tr>
<tr>
<td>4</td>
<td>-</td>
<td>此用户组支持的账号名称。</td>
</tr>
</tbody>
</table>
<p>初始用户组（initial group）与有效用户组（effective group）：</p>
<ul>
<li>保存在 <code>/etc/passwd</code> 中的用户对应 GID 就是初始用户组；</li>
<li>保存在 <code>/etc/group</code> 中的用户名说明用户在此组中，该组是组内用户的有效用户组。</li>
</ul>
<h2 id="etcgshadow-文件结构"><a class="markdownIt-Anchor" href="#etcgshadow-文件结构"></a> /etc/gshadow 文件结构</h2>
<p>gshadow 用来设定组密码：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/gshadow
root:::
bin:::<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>文件内容和 <code>/etc/group</code> 差不多，除了第二列用来记录组密码。</p>
<h2 id="两种群组机制"><a class="markdownIt-Anchor" href="#两种群组机制"></a> 两种群组机制</h2>
<p>针对创建用户时会不会创建私有组的策略有两种机制：</p>
<ul>
<li>
<p><strong>私有群组机制</strong></p>
<p>系统会创建一个与账号同名的群组给使用者作为初始群组，且主文件夹权限设置为 700，这样对用户来说保密性较好。使用这一机制的代表有 RHEL、Fedora、CentOS 等。</p>
</li>
<li>
<p><strong>公共群组机制</strong></p>
<p>新建账户时若没指定组，自动把 GID=100 分配给使用者作为初始群组。此组为 users 公共组，主文件夹权限是 755，同一组内的用户可以共享主文件夹内数据。代表有 SuSE 等。</p>
</li>
</ul>
<h1 id="新增用户"><a class="markdownIt-Anchor" href="#新增用户"></a> 新增用户</h1>
<p>使用默认设置新建用户时，系统所作的工作：</p>
<ol>
<li>在 <code>/etc/passwd</code> 中创建一行与账号相关的数据，包括创建 UID/GID/主文件夹等；</li>
<li>在 <code>/etc/shadow</code> 中将账号密码相关参数填入，默认无密码；</li>
<li>在 <code>/etc/group</code> 中加入一个与账户名一样的组名；</li>
<li>在 <code>/home</code> 下面创建与账户同名的目录作为用户主文件夹，权限为 700。</li>
</ol>
<p>可以通过<code>useradd -D</code>查看创建用户时使用的默认值：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">useradd</span> <span class="token parameter variable">-D</span>
<span class="token assign-left variable">GROUP</span><span class="token operator">=</span><span class="token number">100</span>
<span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/home
<span class="token assign-left variable">INACTIVE</span><span class="token operator">=</span>-1
<span class="token assign-left variable">EXPIRE</span><span class="token operator">=</span>
<span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/bash
<span class="token assign-left variable">SKEL</span><span class="token operator">=</span>/etc/skel
<span class="token assign-left variable">CREATE_MAIL_SPOOL</span><span class="token operator">=</span>yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其实调用的就是 <code>/etc/default/useradd</code> 文件内容。变量说明如下：</p>
<table>
<thead>
<tr>
<th>行</th>
<th>设置</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>GROUP=100</td>
<td>设置新用户初始组为 users，在 CentOS 中不适用</td>
</tr>
<tr>
<td>2</td>
<td>HOME=/home</td>
<td>用户主文件夹的基准目录（basedir）</td>
</tr>
<tr>
<td>3</td>
<td>INACTIVE=-1</td>
<td>密码过期后是否会失效的设置值</td>
</tr>
<tr>
<td>4</td>
<td>EXPIRE=</td>
<td>账号失效的日期，YYYY-MM-DD 格式</td>
</tr>
<tr>
<td>5</td>
<td>SHELL=/bin/bash</td>
<td>新用户默认 shell 的路径</td>
</tr>
<tr>
<td>6</td>
<td>SKEL=/etc/skel</td>
<td>新用户主目录里默认的内容参考来源</td>
</tr>
<tr>
<td>7</td>
<td>CREATE_MAIL_SPOOL=yes</td>
<td>创建用户邮件信箱</td>
</tr>
</tbody>
</table>
<p>其他一些设置，如密码策略、邮箱目录等，存放在 <code>/etc/login.defs</code> 文件下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/login.defs <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-E</span> <span class="token string">"^$|^#"</span>
MAIL_DIR        /var/spool/mail
PASS_MAX_DAYS   <span class="token number">99999</span>
PASS_MIN_DAYS   <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 <code>/etc/login.defs</code> 文件内一些重要参数说明：</p>
<table>
<thead>
<tr>
<th>行</th>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>MAIL_DIR</td>
<td>用户邮箱所在位置</td>
</tr>
<tr>
<td>2-6</td>
<td>PASS_, WARN_AGE</td>
<td>密码设置相关</td>
</tr>
<tr>
<td>7-14</td>
<td>UID, SYS_UID, GID, SYS_GID</td>
<td>设置 UID/GID 号相关参数</td>
</tr>
<tr>
<td>15</td>
<td>CREATE_HOME</td>
<td>建立用户主文件夹</td>
</tr>
<tr>
<td>16</td>
<td>UMASK</td>
<td>用户主文件的权限设置</td>
</tr>
<tr>
<td>17</td>
<td>USERGROUPS_ENAB</td>
<td>删掉用户时，如果同名组是空组，也一并删除</td>
</tr>
<tr>
<td>18</td>
<td>ENCRYPT_METHOD</td>
<td>密码加密方式</td>
</tr>
</tbody>
</table>
<h1 id="修改密码"><a class="markdownIt-Anchor" href="#修改密码"></a> 修改密码</h1>
<p>root 修改密码时不需要旧密码，可以忽略密码规则。一般账号改密码需要输入旧密码，密码需要符合复杂性要求。</p>
<p>密码管理机制由 <code>/etc/pam.d/passwd</code> 控制，密码测试模块使用 pam_cracklib.so。</p>
<p>可以通过 <code>authconfig</code> 命令来查看密码哈希使用算法:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ authconfig <span class="token parameter variable">--test</span> <span class="token operator">|</span> <span class="token function">grep</span> hashing
password hashing algorithm is sha512<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>假设作为一般用户，原始密码为 A2345678b，则修改密码时的错误示例如下：</p>
<table>
<thead>
<tr>
<th><strong>密码规则</strong></th>
<th><strong>错误示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>长度&gt;8</td>
<td>b2345C</td>
</tr>
<tr>
<td>不是回文(即上次密码的倒置)</td>
<td>b8765432A</td>
</tr>
<tr>
<td>不能和上次密码只有大小写区别</td>
<td>a2345678B</td>
</tr>
<tr>
<td>至少有字母+数字</td>
<td>abababab</td>
</tr>
<tr>
<td>简单的轮询检查</td>
<td>2345678bA</td>
</tr>
</tbody>
</table>
<h1 id="pam-模块"><a class="markdownIt-Anchor" href="#pam-模块"></a> PAM 模块</h1>
<p>PAM（可插拔身份验证模块）是一套应用程序编程接口（API）, 它提供一系列验证机制。只要用户将验证阶段的需求告诉 PAM，PAM 就能够回报用户验证的结果（成功或失败）。</p>
<p>由于 PAM 仅是一套验证机制，又可以提供给其他程序调用，因此无论使用什么程序都可以使用 PAM 进行身份验证。</p>
<p>例如，<code>passwd</code> 命令调用 PAM 的流程如下：</p>
<ol>
<li>用户执行 <code>/usr/bin/passwd</code> 程序，并输入密码;</li>
<li>passwd 调用 PAM 模块进行验证;</li>
<li>PAM 模块会到 <code>/etc/pam.d/</code> 中查找与程序 passwd 同名的配置文件;</li>
<li>根据 <code>/etc/pam.d/passwd</code> 内的设置，引用相关的 PAM 模块逐步进行验证分析;</li>
<li>将验证结果回传给 passwd 程序;</li>
<li>passwd 根据 PAM 回传结果决定下一个操作（通过或要求重试）。</li>
</ol>
<p>查看 <code>/etc/pam.d/passwd</code> 文件内容如下:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/pam.d/passwd
<span class="token comment">#%PAM-1.0</span>
auth       include      system-auth
account    include      system-auth
password   substack     system-auth
<span class="token parameter variable">-password</span>   optional    pam_gnome_keyring.so use_authtok
password   substack     postlogin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>每一行分为三个字段，分别是：验证类别（type）、控制标志（flag）、PAM 模块与该模块的参数。</p>
<h2 id="验证类型"><a class="markdownIt-Anchor" href="#验证类型"></a> 验证类型</h2>
<p>验证类型(Type)有四种，分别为：</p>
<ul>
<li>
<p><strong>auth</strong></p>
<p>authentication（认证）的缩写，主要用来检验用户的身份信息，通常需要密码来检验，因此后续接的模块是用来验证使用者的身份。</p>
</li>
<li>
<p><strong>account</strong></p>
<p>account（账号）则大部分用于进行授权，主要在检验用户是否具有正确的授权。例如使用一个过期的密码登录时，无法正确登录。</p>
</li>
<li>
<p><strong>session</strong></p>
<p>session（会话）管理的是用户在这次登录（或使用这个命令）期间 PAM 所给予的环境设置。这个类型通常用于记录用户登录和注销时的信息。例如使用 <code>sudo</code> 命令，会在安全日志里出现很多关于 PAM 的行，记录 session open、session close 等信息。</p>
</li>
<li>
<p><strong>password</strong></p>
<p>password 就是密码，所以这种类别主要用于提供验证的修订工作，例如修改密码。</p>
</li>
</ul>
<p>这四个验证的类型通常有顺序。先进行身份验证（auth），系统给予授权（account），登记登录信息（session），最后是需要更改密码（password）时才给予的 password 类型。</p>
<h2 id="控制标志"><a class="markdownIt-Anchor" href="#控制标志"></a> 控制标志</h2>
<p>控制标志(Control Flag)是验证通过的标准，这个字段在控制该验证的放行方式，也分为四种控制方式：</p>
<ul>
<li>
<p><strong>required</strong></p>
<p>此验证若成功带有 success 的标志，失败带有 failure 的标志，无论成功与失败都会继续后续的验证流程。由于后续的验证流程可以继续进行，因此相当有利于记录日志(log)，这是 PAM 最常使用的标志。</p>
</li>
<li>
<p><strong>requisite</strong></p>
<p>验证失败立刻回报原程序 failure 的标志，并终止后续的验证流程。成功则带有 success 的标志并继续后续的验证流程。与 required 最大的区别是遇到失败立马终止，因此失败所产生的 PAM 信息无法记录。</p>
</li>
<li>
<p><strong>sufficient</strong></p>
<p>若验证成功则立刻回传 success 给原程序，并终止后续的验证流程，失败则带有 failure 标志并继续后续的验证流程，与 requisite 刚好相反。</p>
</li>
<li>
<p><strong>optional</strong></p>
<p>这个模块控制目的大多是在显示信息，并不是用在验证方面。</p>
</li>
</ul>
<p>如果控制标志出现的是 include，代表的是调用后面的文件作为这个类别的验证。</p>
<h2 id="模块"><a class="markdownIt-Anchor" href="#模块"></a> 模块</h2>
<p>模块存放路径：</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/etc/pam.d/*</code></td>
<td>每个程序单独的 PAM 配置文件。</td>
</tr>
<tr>
<td><code>/lib/security/*</code></td>
<td>PAM 模块文件实际放置位置。</td>
</tr>
<tr>
<td><code>/etc/security/*</code></td>
<td>其他 PAM 环境配置文件。</td>
</tr>
<tr>
<td><code>/usr/share/doc/pam-*/</code></td>
<td>详细的 PAM 说明文件。</td>
</tr>
</tbody>
</table>
<p>一些比较常用的模块：</p>
<table>
<thead>
<tr>
<th>模块名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>pam_securetty.so</td>
<td>限制系统管理员 root 只能从安全的终端机登录，例如 tty1-7(由 <code>/etc/securetty</code> 设定)。</td>
</tr>
<tr>
<td>pam_nologin.so</td>
<td>限制一般用户能否登录主机。当 <code>/etc/nologin</code> 文件存在时，所有一般用户均无法登录。</td>
</tr>
<tr>
<td>pam_selinux.so</td>
<td>SELinux 是针对程序来进行详细管理权限的功能。</td>
</tr>
<tr>
<td>pam_console.so</td>
<td>需要使用特殊的终端接口登录主机时，这个模块帮助处理一些文件权限的问题。</td>
</tr>
<tr>
<td>pam_loginuid.so</td>
<td>验证用户的 UID 数值，可以使用这个模块来规范。</td>
</tr>
<tr>
<td>pam_env.so</td>
<td>用来设置环境变量的一个模块。</td>
</tr>
<tr>
<td>pam_unix.so</td>
<td>用于验证阶段的认证功能，可以用于授权阶段的账号许可证管理、日志记录等。</td>
</tr>
<tr>
<td>pam_pwquality.so</td>
<td>用来验证密码的强度，包括密码是否在字典中、密码最大重试次数等。</td>
</tr>
<tr>
<td>pam_cracklib.so</td>
<td>用来检验密码强度，已被 pam_pwquality.so 取代。</td>
</tr>
<tr>
<td>pam_limits.so</td>
<td>ulimit 命令用到了这个模块。</td>
</tr>
</tbody>
</table>
<p>另外一个比较常用的是 <code>/etc/security/limits.conf</code> 这个配置文件，可以直接修改这个文件来对用户的系统使用配额做一些设置。</p>
<p>例如修改用户 user1 只能新建小于 100MB 的文件（hard），且大于 80MB 会警告（soft）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">vim</span> /etc/security/limits.conf 
<span class="token comment">#&lt;domain>      &lt;type>  &lt;item>         &lt;value></span>
<span class="token comment">#</span>
<span class="token comment">#*               soft    core            0</span>
<span class="token comment">#*               hard    rss             10000</span>
<span class="token comment">#@student        hard    nproc           20</span>
<span class="token comment">#@faculty        soft    nproc           20</span>
<span class="token comment">#@faculty        hard    nproc           50</span>
<span class="token comment">#ftp             hard    nproc           0</span>
<span class="token comment">#@student        -       maxlogins       4</span>
user1            soft    fsize           <span class="token number">80000</span>
user1            hard    fsize           <span class="token number">100000</span>
<span class="token string">"/etc/security/limits.conf"</span> 64L, 2499C written<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>ulimit</code> 查询，并使用 <code>dd</code> 命令测试：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>user1@101c7 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-a</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'file size'</span>
core <span class="token function">file</span> size          <span class="token punctuation">(</span>blocks, -c<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token function">file</span> size               <span class="token punctuation">(</span>blocks, -f<span class="token punctuation">)</span> <span class="token number">80000</span>
<span class="token punctuation">[</span>user1@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>filetest <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">200</span>
File size limit exceeded
<span class="token punctuation">[</span>user1@101c7 ~<span class="token punctuation">]</span>$ ll <span class="token parameter variable">-k</span> filetest
-rw-rw-r--. <span class="token number">1</span> user1 user1 <span class="token number">81920000</span> Sep <span class="token number">13</span> <span class="token number">11</span>:23 filetest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>例如限制用户组 group1 每次只能有一个用户登录系统（maxlogins）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">vim</span> /etc/security/limits.conf 
<span class="token comment">#&lt;domain>      &lt;type>  &lt;item>         &lt;value></span>
@group1          hard    maxlogins       <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>登录相关日志文件存放目录有 <code>/var/log/secure</code> 和 <code>/var/log/messages</code>。如果发生任何无法登录或是产生意外错误，由 PAM 模块将数据记录在 <code>/var/log/secure</code> 中。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 目录结构</title>
    <url>/4087499240/</url>
    <content><![CDATA[<h1 id="目录配置标准"><a class="markdownIt-Anchor" href="#目录配置标准"></a> 目录配置标准</h1>
<p>Linux 采用将文件储存在单个目录结构中，这种目录被称为虚拟目录（Virtual Directory）。虚拟目录将安装在主机上的所有储存设备的文件路径纳入单个目录结构中。</p>
<p>各种发行版遵循同一套文件系统层次结构标准（FHS，Filesystem Hierarchy Standard），目的在于规范每个特定目录应该放什么数据。FHS 依据文件系统使用的频繁与否，以及是否允许使用者随意变更，将目录定义为四种交互形态：</p>
<ul>
<li>
<p><strong>可分享的</strong>（Shareable）</p>
<p>可以分享给其他系统挂载使用的目录，包括可执行文件与使用者的邮件等数据。</p>
</li>
<li>
<p><strong>不可分享的</strong>（Unshareable）</p>
<p>自己机器上面运行的设备文件或者是与程序有关的 socket 文件等，仅能自己使用，所以不适合分享。</p>
</li>
<li>
<p><strong>不变的</strong>（Static）</p>
<p>有些数据是不会经常变动的，例如函数库、文件说明文档、系统管理员所管理的主机服务配置文件等。</p>
</li>
<li>
<p><strong>可变动的</strong>（Variable）</p>
<p>经常改变的数据，例如日志文件等。</p>
</li>
</ul>
<h1 id="顶级目录"><a class="markdownIt-Anchor" href="#顶级目录"></a> 顶级目录</h1>
<p>所有目录都由根目录/衍生而来，因此 FHS 标准建议根目录所在分区应该越小越好，最好不要将应用程序所安装的软件与根目录放在同一个分区。这样可以提高性能，根目录所在的文件系统也较不容易发生问题。</p>
<p>开机过程中仅有根目录会被挂载，其他分区则是在开机完成后陆续进行挂载。</p>
<p>必须存在的顶级目录：</p>
<table>
<thead>
<tr>
<th><strong>目录</strong></th>
<th><strong>目录说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/bin</code></td>
<td>二进制目录，存放可以被 root 和一般账户所用的命令，以及在单用户维护模式下仍能被操作的常用命令，如 <code>cat</code>、<code>mv</code>、<code>chown</code> 等。</td>
</tr>
<tr>
<td><code>/boot</code></td>
<td>启动目录，存放开机会使用到的文件，包括内核文件及开机所需配置文件。</td>
</tr>
<tr>
<td><code>/dev</code></td>
<td>设备目录，Linux 上任何设备与接口设备都是以文件的形式存在于这个目录下，访问目录下的某个文件就等于访问某个设备。主要分为三类硬件，例如硬盘（sda）和打印机（lp0），终端如控制台（tty），伪设备如 <code>/dev/null</code> 和 <code>/dev/zero</code>。</td>
</tr>
<tr>
<td><code>/etc</code></td>
<td>系统配置文件目录，系统配置文件几乎都放在这里，如账号密码，服务起始文件等。一般不要放可执行文件到这个目录下。<br /><code>/etc/X11</code>：与 X Window 有关的配置文件放在这里，尤其是 xorg.conf 这个 XServer 的配置文件。<br /><code>/etc/opt</code>：放置第三方软件配置文件。<br /><code>/etc/sgml</code>：与 SGML 格式有关的各项配置文件。<br /><code>/etc/xml</code>：与 XML 格式有关的配置文件。</td>
</tr>
<tr>
<td><code>/home</code></td>
<td>主目录，系统默认用户主文件夹，一般子文件夹以用户账号命名。</td>
</tr>
<tr>
<td><code>/lib</code>、<code>/lib64</code></td>
<td>库目录，存放开机时会用到的函数库，以及在 <code>/bin</code> 或 <code>/sbin</code> 中命令会调用的函数库。<br /><code>/lib/modules/</code>：存放内核相关的模块（驱动程序）。</td>
</tr>
<tr>
<td><code>/media</code></td>
<td>媒体目录，存放可删除设备，包括 CD、DVD、U 盘等设备都暂时挂载于此。</td>
</tr>
<tr>
<td><code>/mnt</code></td>
<td>挂载目录，如果想要暂时挂载某些额外的设备，一般放置到这个目录中。</td>
</tr>
<tr>
<td><code>/opt</code></td>
<td>可选目录，给第三方软件放置的目录，包括发行版附加的一些软件包。</td>
</tr>
<tr>
<td><code>/root</code></td>
<td>系统管理员的主文件夹。</td>
</tr>
<tr>
<td><code>/sbin</code></td>
<td>系统二进制目录，只有 root 可用，包括开机，修复，还原系统所需要的系统命令，如 <code>fdisk</code>、<code>ifconfig</code>、<code>init</code> 等。</td>
</tr>
<tr>
<td><code>/srv</code></td>
<td>服务目录，一些网络服务启动后，这些服务所需要取用的数据目录，如将 www 服务需要的网页文件放置到 <code>/srv/www</code> 里。</td>
</tr>
<tr>
<td><code>/tmp</code></td>
<td>临时目录，重要数据不可放置到此目录，会被一些系统进程定期清空。</td>
</tr>
<tr>
<td><code>/run</code></td>
<td>运行目录，存放系统运作时的运行时数据。</td>
</tr>
</tbody>
</table>
<p>其他重要目录：</p>
<table>
<thead>
<tr>
<th><strong>目录</strong></th>
<th><strong>目录说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/lost+found</code></td>
<td>只有 ext 文件系统格式才会产生的目录，用来放置丢失的文件片段。</td>
</tr>
<tr>
<td><code>/proc</code></td>
<td>进程目录。这个目录本身是一个虚拟文件系统（Virtual Filesystem），它放置的数据都在内存中，如系统内核、进程、外部设备的状态及网络状态等，所以实际不占任何硬盘空间。</td>
</tr>
<tr>
<td><code>/sys</code></td>
<td>系统目录。和 <code>/proc</code> 类似的虚拟文件系统，记录与内核相关信息，包括目前已加载的内核模块与硬件设备信息。</td>
</tr>
</tbody>
</table>
<h1 id="usr-目录"><a class="markdownIt-Anchor" href="#usr-目录"></a> /usr 目录</h1>
<p><code>/usr</code> 目录存放静态数据,即不会随时间改变的文件,原则上放置独立安装的软件数据。系统默认软件也放在 <code>/usr</code> 目录下。</p>
<p><code>/usr</code> 目录下的子目录说明：</p>
<table>
<thead>
<tr>
<th><strong>目录</strong></th>
<th><strong>目录说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/usr/bin/</code></td>
<td>存放所有的用户命令。</td>
</tr>
<tr>
<td><code>/usr/include/</code></td>
<td>存放 C/C++ 等编程语言的头文件（header）和包含文件（include）。</td>
</tr>
<tr>
<td><code>/usr/lib/</code></td>
<td>存放各种应用软件的函数库、目标文件，以及一般用户不使用的执行文件或脚本。</td>
</tr>
<tr>
<td><code>/usr/local/</code></td>
<td>推荐系统管理员自行下载安装的软件存放目录。</td>
</tr>
<tr>
<td><code>/usr/sbin/</code></td>
<td>存放非正常运行所需的系统命令，例如网络服务器软件的服务命令。</td>
</tr>
<tr>
<td><code>/usr/share/</code></td>
<td>存放共享文件，如 man 手册和 doc 帮助文档。</td>
</tr>
<tr>
<td><code>/usr/src/</code></td>
<td>一般建议将源码放在该目录下。内核源码建议放在 <code>/usr/src/linux/</code> 下。</td>
</tr>
<tr>
<td><code>/usr/libexec/</code></td>
<td>存放某些不被一般使用者惯用的可执行文件或脚本。</td>
</tr>
</tbody>
</table>
<h1 id="var-目录"><a class="markdownIt-Anchor" href="#var-目录"></a> /var 目录</h1>
<p><code>/var</code> 目录是用来存放会经常变动的文件的，包括缓存（cache）、日志文件（log file）以及某些软件运行时所产生的文件（lock file、run file）或 MySQL 数据库的文件等等。最好可以将它独立出来挂在单独的一个分区中。</p>
<p><code>/var</code> 目录下的子目录说明：</p>
<table>
<thead>
<tr>
<th>目录</th>
<th>目录说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/var/cache/</code></td>
<td>应用程序本身运行过程中会产生一些暂存文件。</td>
</tr>
<tr>
<td><code>/var/lib/</code></td>
<td>程序执行的过程中需要使用到的数据文件的放置目录。在此目录下各自的软件应该要有自己的目录，例如 MySQL 数据库放置到 <code>/var/lib/mysql/</code> 下。</td>
</tr>
<tr>
<td><code>/var/lock/</code></td>
<td>某些设备或文件资源一次只能被一个应用程序所使用，为了避免使用冲突就得给该设备上锁。例如刻录机设备在刻录中时会被锁上。目前此目录已被挪到 <code>/run/lock/</code> 中。</td>
</tr>
<tr>
<td><code>/var/log/</code></td>
<td>日志文件放置的目录，例如记录登录者信息的文件 <code>/var/log/messages</code>、<code>/var/log/wtmp</code>。</td>
</tr>
<tr>
<td><code>/var/mail/</code></td>
<td>放置个人电子邮件信箱的目录，等同于 <code>/var/spool/mail/</code>。</td>
</tr>
<tr>
<td><code>/var/run/</code></td>
<td>某些程序或服务启动后，会将它们的 PID 放置在这个目录下。</td>
</tr>
<tr>
<td><code>/var/spool/</code></td>
<td>放置一些队列数据，通常在使用后会被删除。</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>计算机软件基础</title>
    <url>/2759544459/</url>
    <content><![CDATA[<h1 id="数字系统"><a class="markdownIt-Anchor" href="#数字系统"></a> 数字系统</h1>
<p>计算机使用电信号的开和关来代表二进制的 1 和 0，这种逢 2 进 1 位的表示法称为二进制。除了二进制，常用的进制还有八进制和十六进制。然而，现实生活中使用的数字系统是十进制。</p>
<p>在编程语言中，表示二进制数的前缀是&quot;0b&quot;，表示八进制数的前缀是&quot;0o&quot;，表示十六进制数的前缀是&quot;0x&quot;。</p>
<h2 id="二进制转十进制"><a class="markdownIt-Anchor" href="#二进制转十进制"></a> 二进制转十进制</h2>
<p>例如，要将二进制数 1101101 转换为十进制数，手动计算方法如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>1101101</mn><mo>=</mo><mn>1</mn><mo>∗</mo><msup><mn>2</mn><mn>6</mn></msup><mo>+</mo><mn>1</mn><mo>∗</mo><msup><mn>2</mn><mn>5</mn></msup><mo>+</mo><mn>0</mn><mo>∗</mo><msup><mn>2</mn><mn>4</mn></msup><mo>+</mo><mn>1</mn><mo>∗</mo><msup><mn>2</mn><mn>3</mn></msup><mo>+</mo><mn>1</mn><mo>∗</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>0</mn><mo>∗</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><mn>1</mn><mo>=</mo><mn>64</mn><mo>+</mo><mn>32</mn><mo>+</mo><mn>0</mn><mo>+</mo><mn>8</mn><mo>+</mo><mn>4</mn><mo>+</mo><mn>0</mn><mo>+</mo><mn>1</mn><mo>=</mo><mn>109</mn></mrow><annotation encoding="application/x-tex">1101101=1*2^6+1*2^5+0*2^4+1*2^3+1*2^2+0*2^1+1=64+32+0+8+4+0+1=109
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span><span class="mord">1</span><span class="mord">1</span><span class="mord">0</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">6</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">9</span></span></span></span></span></p>
<p>在 Bash 中，可以使用<code>echo $(())</code>来直接将二进制数转换为十进制数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server2 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">$((</span><span class="token number">2</span>#<span class="token number">1101101</span><span class="token variable">))</span></span>
<span class="token number">109</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="十进制转二进制"><a class="markdownIt-Anchor" href="#十进制转二进制"></a> 十进制转二进制</h2>
<p>例如，将十进制数 109 转换为二进制数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">109</span>/2<span class="token operator">=</span><span class="token number">54</span><span class="token punctuation">..</span>.1
054/2<span class="token operator">=</span><span class="token number">27</span><span class="token punctuation">..</span>.0
027/2<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">..</span>.1
013/2<span class="token operator">=</span>06<span class="token punctuation">..</span>.1
007/2<span class="token operator">=</span>03<span class="token punctuation">..</span>.0
003/2<span class="token operator">=</span>01<span class="token punctuation">..</span>.1
001/2<span class="token operator">=</span>00<span class="token punctuation">..</span>.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将商除到 0 为止，把所有的余数从下往上读，得到的就是二进制结果 1101101。</p>
<p>在 Bash 中，可以通过调用<code>bc</code>来进行计算：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server2 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"obase=2;ibase=10;109"</span><span class="token operator">|</span><span class="token function">bc</span> <span class="token parameter variable">-l</span>
<span class="token number">1101101</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="二进制转十六进制"><a class="markdownIt-Anchor" href="#二进制转十六进制"></a> 二进制转十六进制</h2>
<p>例如，将二进制数 1101101 转换为十六进制数。</p>
<p>因为四位二进制恰好等于一位十六进制，所以先将二进制数从低位到高位分为四位一组，高位不足四位在前面补 0：</p>
<p>0110 1101</p>
<p>然后将每一组转为对应的十六进制数：</p>
<p>6 D</p>
<p>得到转换结果 0x6D。</p>
<h2 id="十六进制转二进制"><a class="markdownIt-Anchor" href="#十六进制转二进制"></a> 十六进制转二进制</h2>
<p>例如，将十六进制数 0x6D 转换为二进制数。</p>
<p>原理同二进制转十六进制，将每位十六进制单独拿出来：</p>
<p>6 D</p>
<p>将每位转为对应的二进制：</p>
<p>0110 1101</p>
<p>得到转换结果 1101101。</p>
<h2 id="计量单位"><a class="markdownIt-Anchor" href="#计量单位"></a> 计量单位</h2>
<p>计算机中常用的计量单位有下面一些：</p>
<ul>
<li>存储容量单位
<ul>
<li><strong>比特</strong>（bit）：二进制单位，只记录 0 或 1。</li>
<li><strong>字节</strong>（Byte）：储存记录用的单位，1Byte = 8bit。1KB = 1024Byte，再往上有 GB、TB、PB、EB、ZB 等单位。</li>
</ul>
</li>
<li>速度单位
<ul>
<li><strong>运算速度</strong>：Hz 代表秒分之一，CPU 运算速度常使用 MHz 或 GHz。1MHz = 1000*1000Hz。</li>
<li><strong>网络传输</strong>：bps 意思是 bit per second 每秒多少比特，常见的网卡速度 100Mbps 意即每秒传输 100Mb，转为实际文件传输速度等于 12.5MB/s。</li>
</ul>
</li>
</ul>
<h1 id="编码系统"><a class="markdownIt-Anchor" href="#编码系统"></a> 编码系统</h1>
<p>计算机只能识别数字，因此需要使用编码系统将文字转换为数字进行储存。</p>
<h2 id="编码过程"><a class="markdownIt-Anchor" href="#编码过程"></a> 编码过程</h2>
<p>编码的过程是根据一个编码对照表将文字转换为对应编码表中的编号，并将编号存入文件中。</p>
<p>在读取文件时，再根据编码对照表将编号还原成文字进行显示。</p>
<p>如果选择的编码表与实际不符，则会出现所谓的“乱码”。</p>
<p>常用的编码表包括 ASCII、GB2312 和 Unicode 等。</p>
<h2 id="ascii-编码"><a class="markdownIt-Anchor" href="#ascii-编码"></a> ASCII 编码</h2>
<p>美国信息交换标准码（ASCII，American Standard Code for Information Interchange）为每个字符指定 7 位（最左边的位被忽略掉），占用 1Byte 的记录，因此总共可以表示 128 个字符，即从二进制 0000000 到 1111111。</p>
<p>ASII 码中包含 33 个控制字符、52 个字母（65 ~ 90，97 ~ 122）、10 个数字（48 ~ 57）、32 个标点符号以及空白符。</p>
<h2 id="gb2312-编码"><a class="markdownIt-Anchor" href="#gb2312-编码"></a> GB2312 编码</h2>
<p>简体中文最常用的是 GB2312 编码，每个中文字会占用 2Bytes。</p>
<p>理论上有 2<sup>16</sup>=65536 个记录位置，实际只收录了一万三千多个中文字。</p>
<h2 id="unicode-编码"><a class="markdownIt-Anchor" href="#unicode-编码"></a> Unicode 编码</h2>
<p>Unicode 编码也叫 UTF-8 或统一码。基本上包含了所有语言的文字。</p>
<h1 id="逻辑门"><a class="markdownIt-Anchor" href="#逻辑门"></a> 逻辑门</h1>
<p>计算机中的逻辑电路基本单元有以下几种：</p>
<h2 id="非门not-gate"><a class="markdownIt-Anchor" href="#非门not-gate"></a> 非门（NOT Gate）</h2>
<p>也称为反相器、倒相器、逻辑否定电路，它的输出是输入的反相。当输入端为高电平(1)时，输出端为低电平(0)，当输入端为低电平(0)时，输出端为高电平(1)。</p>
<p>非门的真值表：</p>
<table>
<thead>
<tr>
<th>输入 A</th>
<th>输出 Y</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>逻辑符号表示如下：</p>
<p><img data-src="../../../images/%E9%9D%9E%E9%97%A8.png" alt="非门" /></p>
<h2 id="与门and-gate"><a class="markdownIt-Anchor" href="#与门and-gate"></a> 与门（AND Gate）</h2>
<p>与门又称与电路、逻辑积、逻辑与电路。当所有的输入同时为高电平(1)时，输出才为高电平(1)，否则输出为低电平(0)。</p>
<p>与门的真值表：</p>
<table>
<thead>
<tr>
<th>输入 A</th>
<th>输入 B</th>
<th>输出 Y</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>逻辑符号表示如下：</p>
<p><img data-src="../../../images/%E4%B8%8E%E9%97%A8.png" alt="与门" /></p>
<h2 id="或门or-gate"><a class="markdownIt-Anchor" href="#或门or-gate"></a> 或门（OR Gate）</h2>
<p>又称或电路、逻辑和电路。只要输入中有一个为高电平(1)时，输出就为高电平(1)；只有当所有的输入全为低电平(0)时，输出才为低电平(0)。</p>
<p>或门的真值表：</p>
<table>
<thead>
<tr>
<th>输入 A</th>
<th>输入 B</th>
<th>输出 Y</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>逻辑符号表示如下：</p>
<p><img data-src="../../../images/%E6%88%96%E9%97%A8.jpg" alt="或门" /></p>
<h2 id="与非门nand-gate"><a class="markdownIt-Anchor" href="#与非门nand-gate"></a> 与非门（NAND Gate）</h2>
<p>与非门是与门和非门的叠加。当输入均为高电平(1)时，输出为低电平(0)；当输入中至少有一个为低电平(0)时，输出为高电平(1)。与非门可以看作是与门和非门的叠加。</p>
<p>与非门真值表：</p>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>Y</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>逻辑符号表示如下：</p>
<p><img data-src="../../../images/%E4%B8%8E%E9%9D%9E%E9%97%A8.png" alt="与非门" /></p>
<h2 id="或非门nor-gate"><a class="markdownIt-Anchor" href="#或非门nor-gate"></a> 或非门（NOR Gate）</h2>
<p>或非门实现逻辑或非功能。它有多个输入端，1 个输出端。多输入或非门可由 2 输入或非门和反相器构成。只有当两个输入 A 和 B 为低电平(0)时，输出为高电平(1)。也可以理解为任意输入为高电平(1)，输出为低电平(0)。</p>
<p>或非门真值表:</p>
<table>
<thead>
<tr>
<th>输入 A</th>
<th>输入 B</th>
<th>输出 Y</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>逻辑符号表示如下：</p>
<p><img data-src="../../../images/%E6%88%96%E9%9D%9E%E9%97%A8.png" alt="或非门" /></p>
<h2 id="异或门xor-gate"><a class="markdownIt-Anchor" href="#异或门xor-gate"></a> 异或门（XOR Gate）</h2>
<p>异或门是数字逻辑中实现逻辑异或的逻辑门。多输入异或门可由两输入异或门构成。若两个输入的电平相异，则输出为高电平(1)；若两个输入的电平相同，则输出为低电平(0)。即如果两个输入不同，则异或门输出高电平(1)。</p>
<p>异或门真值表:</p>
<table>
<thead>
<tr>
<th>输入 A</th>
<th>输入 B</th>
<th>输出 Y</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>逻辑符号表示如下：</p>
<p><img data-src="../../../images/%E5%BC%82%E6%88%96%E9%97%A8.png" alt="异或门" /></p>
<h2 id="同或门xnor-gate"><a class="markdownIt-Anchor" href="#同或门xnor-gate"></a> 同或门（XNOR Gate）</h2>
<p>同或门也称为异或非门，在异或门的输出端再加上一个非门就构成了异或非门。当 2 个输入端中有且只有一个是低电平(0)时，输出为低电平(0)。即当输入电平相同时，输出为高电平(1)。</p>
<p>同或门真值表:</p>
<table>
<thead>
<tr>
<th>输入 A</th>
<th>输入 B</th>
<th>输出 Y</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>逻辑符号表示如下：</p>
<p><img data-src="../../../images/%E5%90%8C%E6%88%96%E9%97%A8.png" alt="同或门" /></p>
<h2 id="二进制加法器"><a class="markdownIt-Anchor" href="#二进制加法器"></a> 二进制加法器</h2>
<p>可以使用两种基本逻辑门来计算两个二进制数相加的结果：</p>
<ul>
<li>
<p><strong>位相加</strong></p>
<p>位相加的计算结果由 XOR 异或门实现。</p>
<table>
<thead>
<tr>
<th>位和</th>
<th>0</th>
<th>1</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td><strong>1</strong></td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>进位位</strong></p>
<p>进位位的计算结果由 AND 与门实现。</p>
<table>
<thead>
<tr>
<th>进位</th>
<th>0</th>
<th>1</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td><strong>1</strong></td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>将它们连起来就成为半加器（Half Adder）：</p>
<p><img data-src="../../../images/%E5%8D%8A%E5%8A%A0%E5%99%A8.png" alt="半加器" /></p>
<p>为了将可能产生的进位位纳入下一次运算，需要对三个二进制数进行加法运算，最终将两个半加器和一个或门连接起来成为一个全加器（Full Adder）：</p>
<p><img data-src="../../../images/%E5%85%A8%E5%8A%A0%E5%99%A8.png" alt="全加器" /></p>
<p>首先这一次计算两个二进制数 A 和 B 的和得到进位和位和输出。然后将位和输出与上一次计算结果的进位输出相加得到另外一个进位和位和输出，最后将两次的进位输出做或运算，与上一步得出的位和输出在一起传递给下一环节。</p>
<h1 id="软件程序"><a class="markdownIt-Anchor" href="#软件程序"></a> 软件程序</h1>
<p>通常软件程序可以分为两类：操作系统和应用程序。</p>
<h2 id="操作系统"><a class="markdownIt-Anchor" href="#操作系统"></a> 操作系统</h2>
<p>操作系统（OS，Operating System）是一组程序，用于管理计算机的所有活动以及驱动系统中的所有硬件。</p>
<p>操作系统内核直接参考硬件规格编写，用于管理硬件，因此同一个操作系统内核不能在不同的硬件构架下运行。</p>
<p>操作系统的功能主要包括：</p>
<ul>
<li>
<p><strong>系统调用接口</strong>（System call interface）</p>
<p>方便程序员通过接口与内核通信，利用硬件资源。</p>
</li>
<li>
<p><strong>程序管理</strong>（Process Control）</p>
<p>一部计算机可以同时运行很多软件，一般管运行中的程序叫进程。进程可以在前台也可以在后台运行，内核控制着系统管理运行在系统上的所有进程。</p>
</li>
<li>
<p><strong>内存管理</strong>（Memory Management）</p>
<p>因为程序代码和数据都必须载入到内存中运行，所以内存控制非常重要。</p>
<p>交换空间（虚拟内存）用于物理内存不足时提供内存交换（swap）功能，调用虚拟内存的过程称为页面调度（Paging）。</p>
<p>内存储存单元按组划分成很多块，这些块称为页面（Page）。内核将每个内存页面放在物理内存或交换空间中，然后维护一个内存页面表，自动把一段时间未访问的内存页面复制到交换空间（Swapping Out）。当程序要访问一个已被换出的内存页面时，内核必须从物理内存换出另外一个内存页面给它让出空间，然后从交换空间换入请求的内存页面。</p>
</li>
<li>
<p><strong>文件系统管理</strong>（Filesystem Management）</p>
<p>负责对多种文件系统的支持，管理数据输入输出工作，文件格式支持等。</p>
</li>
<li>
<p><strong>设备驱动</strong>（Device Driver）</p>
<p>管理硬件的驱动。驱动程序相当于应用程序和硬件设备的中间人，允许内核与设备之间交换数据。</p>
</li>
</ul>
<h2 id="应用程序"><a class="markdownIt-Anchor" href="#应用程序"></a> 应用程序</h2>
<p>应用程序是利用操作系统提供的开发接口开发出来的软件，这些软件通常针对特定功能而开发。</p>
<h2 id="源代码"><a class="markdownIt-Anchor" href="#源代码"></a> 源代码</h2>
<p>源代码是创建软件的原始数据。可以使用诸如 C++之类的编程语言编写源代码，在使用这些代码之前需要进行编译。使用 Perl 或 Python 这样的脚本语言编写源代码，则无需编译即可运行。</p>
<h2 id="开源许可"><a class="markdownIt-Anchor" href="#开源许可"></a> 开源许可</h2>
<p>以源代码形式提供的软件称为开源软件，通常可以自由地查看、共享、使用和修改它。</p>
<p>开源软件许可证声明对源代码拥有版权，并确定代码的使用和发布以及派生代码的使用和发布的自由范围和限制。常见的开源许可证有 BSD 和 GPL。</p>
<ul>
<li>
<p><strong>BSD 许可证</strong></p>
<p>持有 BSD 许可证的源代码可以自由地进行修改，而且不需要重新发布这些修改。常用于私有或商业软件中。</p>
</li>
<li>
<p><strong>GPL 许可证</strong></p>
<p>GNU 通用公共许可证（GPL）规定任何已发布的软件所做的任何修改都必须以相同的许可证发布。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 下搜索文件</title>
    <url>/3570307132/</url>
    <content><![CDATA[<h1 id="通配符"><a class="markdownIt-Anchor" href="#通配符"></a> 通配符</h1>
<p>通配符（wildcard）是 Bash 操作接口的一个功能。常用的通配符如下表：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>代表 0 到无穷多个任意字符。</td>
</tr>
<tr>
<td>?</td>
<td>代表一定有一个任意字符。</td>
</tr>
<tr>
<td>[]</td>
<td>代表一定有一个括号内的字符，例如 [xgw] 代表可能是 xgw 其中一个。</td>
</tr>
<tr>
<td>[-]</td>
<td>代表在编码顺序内的所有字符，例如 [0-9] 代表 0 到 9 之间的所有数字。</td>
</tr>
<tr>
<td>[^]</td>
<td>第一个字符为 ^ 代表反向选择，例如 [^xpw]代表任意一个非 xpw 的字符。</td>
</tr>
</tbody>
</table>
<h1 id="快速搜索"><a class="markdownIt-Anchor" href="#快速搜索"></a> 快速搜索</h1>
<p>在 Linux 中，可以使用不同的命令进行快速搜索，以下是一些常用命令。</p>
<p>使用 <code>which</code> 命令来查找命令所在路径。这个命令根据的是$PATH 环境变量所指定的路径去查询：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">which</span> <span class="token function">ls</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">ls</span><span class="token operator">=</span><span class="token string">'ls --color=auto'</span>
        /usr/bin/ls<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>whereis</code> 命令会在指定的几个常用目录中搜索文件，使用 <code>-l</code> 参数可以查看可搜索的目录。</p>
<p><code>whereis</code> 命令可以搜索以下类型的文件：二进制文件（<code>-b</code>）、说明文件（<code>-m</code>）、源代码（<code>-s</code>）和其他特殊文件（<code>-u</code>）。</p>
<p>例如搜索和 <code>ifconfig</code> 有关的说明文档：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">whereis</span> <span class="token parameter variable">-m</span> <span class="token function">ifconfig</span>
ifconfig: /usr/share/man/man8/ifconfig.8.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>locate</code> 命令使用数据库来查找文件。数据库存放在 <code>/var/lib/mlocate/</code> 目录下，每天会更新一次。若需要手动更新数据库，可以使用 <code>updatedb</code> 命令。</p>
<p>例如忽略大小写搜索与 <code>passwd</code> 有关的文件，并列出前四个结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">locate</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-l</span> <span class="token number">4</span> <span class="token function">passwd</span>
/etc/passwd
/etc/passwd-
/etc/pam.d/passwd
/etc/security/opasswd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="精确搜索"><a class="markdownIt-Anchor" href="#精确搜索"></a> 精确搜索</h1>
<p>精确搜索指使用<code>find</code>命令执行的搜索。</p>
<h2 id="按时间搜索文件"><a class="markdownIt-Anchor" href="#按时间搜索文件"></a> 按时间搜索文件</h2>
<p>与时间有关的参数有<code>-atime</code>，<code>-ctime</code>和<code>-mtime</code>：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-mtime n</code></td>
<td>表示在 n 天之前那天内被更改过的文件；</td>
</tr>
<tr>
<td><code>-mtime +n</code></td>
<td>列出在 n 天之前（不含 n）被更改过的文件，文件修改日期大于等于 n+1 天；</td>
</tr>
<tr>
<td><code>-mtime -n</code></td>
<td>列出在 n 天之内（包含 n）被更改过的文件，文件修改日期小于等于 n 天；</td>
</tr>
<tr>
<td><code>-newer file</code></td>
<td>列出比<code>file</code>还要新的文件名。</td>
</tr>
</tbody>
</table>
<p>例如，搜索过去系统上 24 小时内有更改过的文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> / <span class="token parameter variable">-mtime</span> <span class="token number">0</span>
/dev/char
/dev/char/189:132<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>查找当前目录下修改时间在 5 分钟到 24 小时之间的文件：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> <span class="token parameter variable">-mtime</span> <span class="token number">0</span> <span class="token parameter variable">-mmin</span> +5
<span class="token builtin class-name">.</span>
./.bash_history
./audit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>寻找<code>/etc</code>目录下比<code>/etc/passwd</code>文件日期新的文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> /etc <span class="token parameter variable">-newer</span> /etc/passwd <span class="token operator">|</span> <span class="token function">tail</span> 
/etc/audit/audit.rules
/etc/postfix
/etc/kernel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>查找<code>/root</code>目录下更改时间在 5 天前的文件并删除：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">find</span> /root <span class="token parameter variable">-type</span> f <span class="token parameter variable">-mtime</span> +5 <span class="token parameter variable">-ok</span> rm<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>删除当前目录中访问时间在 7 天以前，含有数字后缀的<code>admin.log</code>文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">"admin.log[0-9][0-9][0-9]"</span> <span class="token parameter variable">-atime</span> <span class="token parameter variable">-7</span> <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="按用户名及组名搜索"><a class="markdownIt-Anchor" href="#按用户名及组名搜索"></a> 按用户名及组名搜索</h2>
<p>可以使用 <code>find</code> 命令按照文件的所有者和用户组来搜索文件，常用参数如下：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-uid n</code></td>
<td>按照用户 UID 来搜索</td>
</tr>
<tr>
<td><code>-gid n</code></td>
<td>按用户组 GID 来搜索</td>
</tr>
<tr>
<td><code>-user name</code></td>
<td>按用户名来搜索</td>
</tr>
<tr>
<td><code>-group name</code></td>
<td>按用户组名来搜索</td>
</tr>
<tr>
<td><code>-nouser</code></td>
<td>搜索文件的所有者不存在 <code>/etc/passwd</code> 的人</td>
</tr>
<tr>
<td><code>-nogroup</code></td>
<td>搜索所有用户组不存在 <code>/etc/group</code> 中的文件</td>
</tr>
</tbody>
</table>
<p>例如查找 <code>/home</code> 目录下属于用户 abc 的文件:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> /home <span class="token parameter variable">-user</span> abc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查找系统中不属于任何人的文件:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> / <span class="token parameter variable">-nouser</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="按文件名及属性搜索"><a class="markdownIt-Anchor" href="#按文件名及属性搜索"></a> 按文件名及属性搜索</h2>
<p>主要参数:</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-name filename</td>
<td>搜索文件名为 filename 的文件</td>
</tr>
<tr>
<td>-iname filename</td>
<td>忽略大小写，搜索文件名为 filename 的文件</td>
</tr>
<tr>
<td>-size [±]SIZE</td>
<td>搜索大小比 SIZE 大（+）或小（-）的文件，大小单位有 c、k、m、g 等</td>
</tr>
<tr>
<td>-type TYPE</td>
<td>搜索文件类型为 TYPE 的文件，如一般文件（f）、设备文件（b、c）、目录（d）、连接（l）、socket（s）等</td>
</tr>
<tr>
<td>-perm mode</td>
<td>搜索权限刚好等于 mode 的文件，如 mode 为 4775</td>
</tr>
<tr>
<td>-perm -mode</td>
<td>搜索权限必须全部包括 mode 的权限，如 mode 为 0744，会找到权限为 4775 的文件</td>
</tr>
<tr>
<td>-perm +mode</td>
<td>搜索权限包含任一 mode 的权限，如 mode 为 755 时，会找到权限为 101 的文件</td>
</tr>
</tbody>
</table>
<p>例如，在当前目录中查找文件 redis-3.2.6.tar.gz 并删除：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">find</span> <span class="token parameter variable">-name</span> redis-3.2.6.tar.gz <span class="token parameter variable">-delete</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>忽略大小写，在 <code>/etc</code> 目录下搜索 ssh 文件或目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">find</span> /etc <span class="token parameter variable">-iname</span> <span class="token function">ssh</span>
/etc/ssh
/etc/selinux/targeted/active/modules/100/ssh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在 <code>/etc</code> 目录中查找以 rc 开头的文件，并以列表形式显示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">find</span> /etc <span class="token parameter variable">-name</span> rc* <span class="token parameter variable">-ls</span>
<span class="token number">50332831</span>    <span class="token number">0</span> drwxr-xr-x  <span class="token number">10</span> root     root          <span class="token number">127</span> Sep  <span class="token number">7</span> 05:53 /etc/rc.d
<span class="token number">16781412</span>    <span class="token number">0</span> drwxr-xr-x   <span class="token number">2</span> root     root           <span class="token number">45</span> Oct <span class="token number">13</span>  <span class="token number">2020</span> /etc/rc.d/rc0.d
<span class="token number">33644238</span>    <span class="token number">0</span> drwxr-xr-x   <span class="token number">2</span> root     root           <span class="token number">45</span> Oct <span class="token number">13</span>  <span class="token number">2020</span> /etc/rc.d/rc1.d
<span class="token number">50332832</span>    <span class="token number">0</span> drwxr-xr-x   <span class="token number">2</span> root     root           <span class="token number">45</span> Oct <span class="token number">13</span>  <span class="token number">2020</span> /etc/rc.d/rc2.d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 <code>/root</code> 目录下搜索所有小于 1MB 的文件，用 <code>-size -1M</code> 参数等同于 <code>-size 0M</code>，需要注意。这是个 ChatGPT 都会答错的问题：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">find</span> /root <span class="token parameter variable">-size</span> <span class="token parameter variable">-1M</span>
/root/audit/a.log
/root/3/3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>查找 <code>/root</code> 目录下大于 10KB 并且（<code>-a</code> 表示“与”）小于 2M 的普通文件，并以列表形式显示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> /root <span class="token parameter variable">-type</span> f <span class="token parameter variable">-size</span> +10k <span class="token parameter variable">-a</span> <span class="token parameter variable">-size</span> <span class="token parameter variable">-2M</span> <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-lh</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
-rw-------. <span class="token number">1</span> root root 17K Sep <span class="token number">16</span> 03:15 /root/.bash_history
-rw-------. <span class="token number">1</span> root root 178K Sep  <span class="token number">9</span> 05:48 /root/audit/b.log
-rw-r--r--. <span class="token number">1</span> root root 30K Sep <span class="token number">10</span> <span class="token number">15</span>:05 /root/backup/sdb4.dump
-rw-r--r--. <span class="token number">1</span> root root 11K Sep <span class="token number">10</span> <span class="token number">14</span>:39 /root/backup/lost.dump.bz2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查找当前目录中的所有目录并排序：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-type</span> d <span class="token operator">|</span> <span class="token function">sort</span>
<span class="token builtin class-name">.</span>
./3
./audit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>在当前目录下查找除普通文件以外的所有类型的文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token operator">!</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-print</span>
<span class="token builtin class-name">.</span>
./.pki
./.pki/nssdb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>查找 <code>/bin</code> 和 <code>/sbin</code> 目录下中含有 SGID, SUID 或 SBIT 属性的文件:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> /bin /sbin <span class="token parameter variable">-perm</span> +7000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="处理搜索结果"><a class="markdownIt-Anchor" href="#处理搜索结果"></a> 处理搜索结果</h2>
<p><code>find</code> 命令可以接受表达式，表达式可能由下列成份组成：操作符、选项、测试表达式以及动作。</p>
<p>常见动作有 <code>-print</code>（打印输出，默认动作）、<code>-ls</code>（显示长目录列表）、<code>-delete</code>（删除文件）。</p>
<p><code>-exec</code> 选项后面跟命令（不支持别名）或脚本，然后是大括号 <code>&#123;&#125;</code> 表示由 <code>find</code> 找到的路径名，一个空格，接 <code>\</code> 用来转义分号；表示命令结束。相应命令的形式为 <code>command &#123;&#125; \</code>；</p>
<p><code>-ok</code> 和 <code>-exec</code> 的作用相同，只不过在执行每一个命令之前都会给出提示，让用户来确定是否执行。</p>
<p>例如在 <code>/etc</code> 目录中搜索 <code>passwd</code> 文件并从中找 <code>root</code> 相关信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">find</span> /etc <span class="token parameter variable">-name</span> <span class="token string">"passwd*"</span> <span class="token parameter variable">-exec</span> <span class="token function">grep</span> <span class="token string">"root"</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
root:x:0:0:root:/root:/bin/bash
operator:x:11:0:operator:/root:/sbin/nologin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在 <code>/usr/sam</code> 目录下查找不在 <code>dir1</code> 子目录之内的所有文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> /usr/sam <span class="token parameter variable">-path</span> <span class="token string">"/usr/sam/dir1"</span> <span class="token parameter variable">-prune</span> <span class="token parameter variable">-o</span> <span class="token parameter variable">-print</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>复制搜索到的文件到 <code>backup</code> 目录下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-exec</span> <span class="token function">cp</span> <span class="token parameter variable">--parents</span>  <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> ./backup/ <span class="token punctuation">\</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>-exec</code> 为每个文件生成一条单独的命令，例如搜索到 57 个文件，那么将生成 57 条单独命令。如果想要提高效率，可以使用 <code>xargs</code> 运行任何使用参数指定的命令，参数通过标准输入传递给程序。</p>
<p>例如配合 <code>grep</code> 在 <code>find</code> 找到的文件中搜寻特定内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> /var <span class="token parameter variable">-name</span> *.log <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">grep</span> <span class="token string">"notice"</span>
/var/log/anaconda/X.log:        <span class="token punctuation">(</span>++<span class="token punctuation">)</span> from <span class="token builtin class-name">command</span> line, <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">)</span> notice, <span class="token punctuation">(</span>II<span class="token punctuation">)</span> informational,
/var/log/anaconda/journal.log:Sep <span class="token number">22</span> <span class="token number">13</span>:09:41 localhost kernel: <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token number">1107</span> audit<span class="token punctuation">(</span><span class="token number">1632316181.830</span>:44<span class="token punctuation">)</span>: <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">1577</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">auid</span><span class="token operator">=</span><span class="token number">4294967295</span> <span class="token assign-left variable">ses</span><span class="token operator">=</span><span class="token number">4294967295</span> <span class="token assign-left variable">subj</span><span class="token operator">=</span>system_u:system_r:system_dbusd_t:s0-s0:c0.c1023 <span class="token assign-left variable">msg</span><span class="token operator">=</span>'avc:  received policyload notice <span class="token punctuation">(</span>seqno<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>将搜索到的文件重命名，可以在 <code>xargs</code> 中使用 <code>&#123;&#125;</code> 占位符来代表搜索结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ <span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">"back.sh*"</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-i</span> <span class="token function">mv</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>.dele
<span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ ll back*
-rwxr--r--. <span class="token number">1</span> root root <span class="token number">52</span> Oct  <span class="token number">7</span> 06:15 back.sh1.dele
-rwxr--r--. <span class="token number">2</span> root root <span class="token number">52</span> Sep <span class="token number">23</span> <span class="token number">19</span>:18 back.sh.dele<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 文件操作</title>
    <url>/3891118029/</url>
    <content><![CDATA[<h1 id="文件和目录查询"><a class="markdownIt-Anchor" href="#文件和目录查询"></a> 文件和目录查询</h1>
<p>使用 <code>ls</code> 命令可以列出目录中的文件，不包括隐藏文件。默认按文件名排序。<code>ll</code> 命令是 <code>ls -l</code> 的别名。</p>
<p>以下是一些常用选项参数：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示隐藏文件</td>
</tr>
<tr>
<td>-d</td>
<td>仅查看目录本身属性</td>
</tr>
<tr>
<td>-h</td>
<td>使显示结果更友好</td>
</tr>
<tr>
<td>-i</td>
<td>列出 inode 号码</td>
</tr>
<tr>
<td>-l</td>
<td>显示详细信息</td>
</tr>
<tr>
<td>-n</td>
<td>列出 UID 与 GID</td>
</tr>
<tr>
<td>-R</td>
<td>连同子目录内容一起列出</td>
</tr>
<tr>
<td>-S</td>
<td>以文件大小排序</td>
</tr>
<tr>
<td>-t</td>
<td>依时间排序</td>
</tr>
</tbody>
</table>
<p>可以同时查看多个文件信息，路径之间用空格隔开：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ ll ./dir1/ ./audit/
./audit/:
total <span class="token number">360</span>
-rw-------. <span class="token number">2</span> root root <span class="token number">182023</span> Sep <span class="token number">9</span> 05:01 audit.log
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">9</span> Sep <span class="token number">9</span> 05:29 ha.log -<span class="token operator">></span> audit.log
-rw-------. <span class="token number">2</span> root root <span class="token number">182023</span> Sep <span class="token number">9</span> 05:01 la.log

./dir1/:
total <span class="token number">0</span>
-rwxrwxr--. <span class="token number">1</span> <span class="token function">ftp</span> root <span class="token number">0</span> Sep <span class="token number">8</span> <span class="token number">23</span>:29 xx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以使用通配符 *（? 匹配单字母）来显示所有匹配的文件和目录，包括子文件夹中的文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> s*
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">83886080</span> Sep <span class="token number">10</span> <span class="token number">22</span>:20 sdb5.disk

sdb4m:
total <span class="token number">20</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">1260</span> Sep <span class="token number">10</span> <span class="token number">15</span>:05 a.cfg
drwx------. <span class="token number">2</span> root root <span class="token number">16384</span> Sep <span class="token number">10</span> <span class="token number">15</span>:03 lost+found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>展示完整的文件修改时间使用 <code>--full-time</code> 参数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token parameter variable">-Al</span> --full-time /etc/bash_completion.d/
total <span class="token number">72</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">56178</span> <span class="token number">2020</span>-05-28 <span class="token number">16</span>:32:30.000000000 <span class="token parameter variable">-0400</span> <span class="token function">git</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">829</span> <span class="token number">2020</span>-02-05 07:58:44.000000000 <span class="token parameter variable">-0500</span> iprutils
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">11736</span> <span class="token number">2020</span>-03-31 <span class="token number">23</span>:33:31.000000000 <span class="token parameter variable">-0400</span> mercurial.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以指定展示特定时间戳，比如查询文件访问时间：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token parameter variable">--time</span><span class="token operator">=</span>atime 
total <span class="token number">364</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep <span class="token number">9</span> 05:51 b.log
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">178</span> Sep <span class="token number">9</span> 05:57 c.log
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep <span class="token number">9</span> 05:48 mvau.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>-F</code> 参数能在文件名末显示该文件的类型：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token parameter variable">-F</span> /sbin/
accessdb*              fsfreeze*                   mkdict@ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>结果中可执行文件会在文件名后加*，软链接加@，目录加/，管道加|，并用不同颜色表示结果。</p>
<p>此外，还可以使用 stat 命令来查看某个文件的具体属性，其展示结果一步到位，包括文件大小、块数、I/O 块大小、设备号、Inode 号码、硬链接数量、文件权限、UID 和 GID、SELinux 安全上下文、文件访问时间、修改时间、变化时间和创建时间等信息。例如，查看 <a href="http://ftp.sh">ftp.sh</a> 文件的属性：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ <span class="token function">stat</span> ftp.sh
  File: ‘ftp.sh’
  Size: <span class="token number">52</span>              Blocks: <span class="token number">8</span>          IO Block: <span class="token number">4096</span>   regular <span class="token function">file</span>
Device: fd00h/64768d    Inode: <span class="token number">4215134</span>     Links: <span class="token number">1</span>
Access: <span class="token punctuation">(</span>0644/-rw-r--r--<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span>    <span class="token number">0</span>/    root<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span>    <span class="token number">0</span>/    root<span class="token punctuation">)</span>
Context: unconfined_u:object_r:admin_home_t:s0
Access: <span class="token number">2021</span>-09-23 <span class="token number">19</span>:18:22.974352478 +0800
Modify: <span class="token number">2021</span>-09-23 <span class="token number">19</span>:18:04.472546785 +0800
Change: <span class="token number">2021</span>-09-23 <span class="token number">19</span>:18:04.473546775 +0800
 Birth: -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其中，Size 表示文件大小，Blocks 表示块数，IO Block 表示 I/O 块大小，regular file 表示文件类型为常规文件，Device 表示设备号，Inode 表示 Inode 号码，Links 表示硬链接数量，Access 表示文件访问时间，Modify 表示文件修改时间，Change 表示文件状态更改时间，Birth 表示文件创建时间。</p>
<h1 id="检查文件类型"><a class="markdownIt-Anchor" href="#检查文件类型"></a> 检查文件类型</h1>
<p>想了解某个文件的基本数据类型，可以使用 file 命令。</p>
<p>例如，查看二进制文件 passwd 的信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">file</span> /usr/bin/passwd 
/usr/bin/passwd: setuid ELF <span class="token number">64</span>-bit LSB shared object, x86-64, version <span class="token number">1</span> <span class="token punctuation">(</span>SYSV<span class="token punctuation">)</span>, dynamically linked <span class="token punctuation">(</span>uses shared libs<span class="token punctuation">)</span>, <span class="token keyword">for</span> GNU/Linux <span class="token number">2.6</span>.32, BuildID<span class="token punctuation">[</span>sha1<span class="token punctuation">]</span><span class="token operator">=</span>dee1b9ab6618c6bfb84a14f85ba258c742cf4aec, stripped<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>再比如，查看日志文件 b.log 的信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">file</span> b.log 
b.log: ASCII text, with very long lines<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="复制文件与目录"><a class="markdownIt-Anchor" href="#复制文件与目录"></a> 复制文件与目录</h1>
<p>使用 <code>cp</code> 命令可以复制文件和文件夹，系统已经为 <code>cp</code> 加入 <code>-i</code> 选项以询问用户是否覆盖文件。</p>
<p>例如，复制当前目录下的 anaconda-ks.cfg 文件到 <code>/home/</code> 下并命名为 anac.cfg:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cp</span> anaconda-ks.cfg /home/anac.cfg <span class="token punctuation">;</span> ll /home
total <span class="token number">4</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">1260</span> Sep  <span class="token number">9</span> 05:12 anac.cfg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>复制文件夹需要使用递归参数 <code>-r</code>，例如复制 <code>/var/log</code> 下的文件夹 audit 到当前目录:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cp</span> <span class="token parameter variable">-r</span> /var/log/audit/ <span class="token builtin class-name">.</span> <span class="token punctuation">;</span> ll ./audit/
total <span class="token number">180</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep  <span class="token number">9</span> 05:14 audit.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>复制后的文件属性，如修改时间和权限（所有者变为操作者）会改变。如果要保留源文件属性，可以使用 <code>-a</code> 参数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ ll /var/log/audit/
total <span class="token number">180</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep  <span class="token number">9</span> 05:01 audit.log
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ ll audit/
total <span class="token number">180</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep  <span class="token number">9</span> 05:14 audit.log
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> audit/ <span class="token punctuation">;</span> <span class="token function">cp</span> <span class="token parameter variable">-ra</span> /var/log/audit/ <span class="token builtin class-name">.</span> <span class="token punctuation">;</span> ll audit/
total <span class="token number">180</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep  <span class="token number">9</span> 05:01 audit.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="删除文件与目录"><a class="markdownIt-Anchor" href="#删除文件与目录"></a> 删除文件与目录</h1>
<p>删除文件或文件夹使用 rm 命令。如果需要删除以-开头的特殊文件，需要使用相对路径。</p>
<p>例如，要删除当前目录下的 la.log 和 ha.log 两个文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">rm</span> <span class="token parameter variable">-f</span> la.log ha.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果需要删除文件夹，则需要使用 <code>-r</code> 参数，并且可以使用通配符*。例如，要删除当前文件夹下以 app 开头的所有文件和文件夹：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> app*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="移动和更名文件和目录"><a class="markdownIt-Anchor" href="#移动和更名文件和目录"></a> 移动和更名文件和目录</h1>
<p>在 Linux 中，可以使用 <code>mv</code> 命令移动和更名文件和目录。移动文件或目录会保持其 inode 编号和时间戳不变。</p>
<p>例如，将文件 audit.log 移动到其上级目录并将其更名为 mvau.log：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">mv</span> audit.log <span class="token punctuation">..</span>/mvau.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>也可以同时移动多个文件到指定目录。例如，将 mvau.log 和 b.log 一次性移动到目录 audit 中：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mv</span> mvau.log b.log audit/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="修改文件时间戳"><a class="markdownIt-Anchor" href="#修改文件时间戳"></a> 修改文件时间戳</h1>
<p>在 Linux 系统中，每个文件都有三个时间戳：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Modification Time(<strong>mtime</strong>)  修改时间</td>
<td>当文件<strong>内容更改</strong>时会更新这个时间.不包括文件的属性或权限更改</td>
</tr>
<tr>
<td>Status Time(<strong>ctime</strong>)     状态(创建)时间</td>
<td>当文件<strong>状态改变</strong>时会更新这个时间,比如权限和属性的更改</td>
</tr>
<tr>
<td>Access Time(<strong>atime</strong>)    (上次)访问时间</td>
<td>当文件<strong>内容读取</strong>时会更新这个时间,比如用 cat 或 less 去读取</td>
</tr>
</tbody>
</table>
<p>可以使用 <code>touch</code> 命令来修改文件的时间戳。如果不指定时间，则修改为当前时间。</p>
<p>例如，将 a.log 文件的修改时间和访问时间修改为 2007 年 1 月 1 日 1 点 1 分：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ ll a.log<span class="token punctuation">;</span>ll <span class="token parameter variable">--time</span><span class="token operator">=</span>atime a.log<span class="token punctuation">;</span> ll <span class="token parameter variable">--time</span><span class="token operator">=</span>ctime a.log 
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> 07:35 a.log
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> 07:35 a.log
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> 07:35 a.log
<span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">touch</span> <span class="token parameter variable">-t</span> 0701010101 a.log
<span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ ll a.log<span class="token punctuation">;</span>ll <span class="token parameter variable">--time</span><span class="token operator">=</span>atime a.log<span class="token punctuation">;</span> ll <span class="token parameter variable">--time</span><span class="token operator">=</span>ctime a.log 
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Jan  <span class="token number">1</span>  <span class="token number">2007</span> a.log
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Jan  <span class="token number">1</span>  <span class="token number">2007</span> a.log
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> 07:38 a.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="创建文件"><a class="markdownIt-Anchor" href="#创建文件"></a> 创建文件</h1>
<p><code>touch</code> 命令本意用来更新文件时间戳，当文件不存在时会创建一个新的空文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">touch</span> a.log <span class="token punctuation">;</span> ll
total <span class="token number">364</span>
-rw-r--r--. <span class="token number">1</span> root root      <span class="token number">0</span> Sep  <span class="token number">9</span> 07:35 a.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>也可以使用 <code>cat</code> 命令接收用户输入，并将其重定向到文件中：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> <span class="token operator">></span> catfile
<span class="token number">123</span>
<span class="token number">32</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>输入完毕后按下 Ctrl+d 组合键以结束输入。</p>
<h1 id="擦除文件内容"><a class="markdownIt-Anchor" href="#擦除文件内容"></a> 擦除文件内容</h1>
<p>当使用 <code>rm</code> 命令删除文件时，实际上只是将文件的块标记为可写，而磁盘上的数据并没有被删除。如果要安全删除文件并保证不留下任何痕迹，可以使用 <code>shred</code> 命令，它会用随机数据对目标文件进行多次覆写。例如，以下命令对名为 www 的文件进行四次覆写，最后填充为零后再删除文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ shred <span class="token parameter variable">-fuvz</span> www 
shred: www: pass <span class="token number">1</span>/4 <span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">..</span>.
shred: www: pass <span class="token number">2</span>/4 <span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">..</span>.
shred: www: pass <span class="token number">3</span>/4 <span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">..</span>.
shred: www: pass <span class="token number">4</span>/4 <span class="token punctuation">(</span>000000<span class="token punctuation">)</span><span class="token punctuation">..</span>.
shred: www: removing
shred: www: renamed to 000
shred: 000: renamed to 00
shred: 00: renamed to <span class="token number">0</span>
shred: www: removed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要注意的是，<code>shred</code> 命令并不适用于所有文件系统。例如，ZFS 文件系统会为新数据分配新的数据块，而不是直接覆写旧数据。</p>
<h1 id="连接文件"><a class="markdownIt-Anchor" href="#连接文件"></a> 连接文件</h1>
<p>在 Linux 中，可以使用 <code>ln</code> 命令来连接文件。<code>ln</code> 命令有两种链接方式：硬链接和软链接。</p>
<h2 id="硬连接"><a class="markdownIt-Anchor" href="#硬连接"></a> 硬连接</h2>
<p>硬连接（hard link）是在某个目录 block 数据中新建一条文件名，连接到某个已存在的 inode 号码关联记录。</p>
<p>硬链接特点：</p>
<ul>
<li>新建的硬连接属性权限和源文件一样，修改也和源文件同步，是因为其数据储存在引用的 inode 块中；</li>
<li>一个文件有几个硬连接就有几个 Link Counter；</li>
<li>建立硬连接不占用磁盘空间与 inode 数目。</li>
</ul>
<p>建立硬连接有两个限制：</p>
<ul>
<li>不能跨文件系统，因为不同文件系统有不同 inode；</li>
<li>不能连接到目录。</li>
</ul>
<h2 id="软连接"><a class="markdownIt-Anchor" href="#软连接"></a> 软连接</h2>
<p>软连接（symbolic link）也叫做符号连接或快捷方式，是指向另一个文件或目录的特殊文件。它有自己的 inode 编号和硬链接计数器。但是软链接的内容是源文件的路径名。</p>
<p>软连接文件属性为 l ，使用 <code>ls</code> 查看时会有个 -&gt; 符号指向源文件的路径名。</p>
<p>如果源文件改名或删除，软链接文件将不会指向正确位置，因为其使用文件名作为引用。</p>
<h2 id="目录的连接数量"><a class="markdownIt-Anchor" href="#目录的连接数量"></a> 目录的连接数量</h2>
<p>当新建一个目录时，新的目录连接数为 2。</p>
<p>比如新建目录 <code>/root/1/</code>，另一个硬连接等于 <code>/root/1/.</code>。</p>
<p>而上层目录的连接数会增加 1，也就是增加了 <code>/root/1/..</code> 这个硬连接。</p>
<h2 id="创建连接"><a class="markdownIt-Anchor" href="#创建连接"></a> 创建连接</h2>
<p>使用 <code>ln</code> 和 <code>cp</code> 命令都可以创建连接。默认不加参数使用 <code>ln</code> 建立的就是硬连接：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ <span class="token function">ln</span> hhh hhh_hark<span class="token punctuation">;</span> ll <span class="token parameter variable">-i</span>
total <span class="token number">24</span>
<span class="token number">16</span> -rw-r--r--. <span class="token number">2</span> root root     <span class="token number">4</span> Sep <span class="token number">10</span> 01:57 hhh
<span class="token number">16</span> -rw-r--r--. <span class="token number">2</span> root root     <span class="token number">4</span> Sep <span class="token number">10</span> 01:57 hhh_hark
<span class="token number">11</span> drwx------. <span class="token number">2</span> root root <span class="token number">16384</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:54 lost+found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>创建符号连接使用参数 <code>-s</code> 来建立：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ <span class="token function">ln</span> <span class="token parameter variable">-s</span> hhh hhh_soft<span class="token punctuation">;</span> ll <span class="token parameter variable">-i</span>
total <span class="token number">24</span>
<span class="token number">16</span> -rw-r--r--. <span class="token number">2</span> root root     <span class="token number">4</span> Sep <span class="token number">10</span> 01:57 hhh
<span class="token number">16</span> -rw-r--r--. <span class="token number">2</span> root root     <span class="token number">4</span> Sep <span class="token number">10</span> 01:57 hhh_hark
<span class="token number">12</span> lrwxrwxrwx. <span class="token number">1</span> root root     <span class="token number">3</span> Sep <span class="token number">10</span> 02:04 hhh_soft -<span class="token operator">></span> hhh
<span class="token number">11</span> drwx------. <span class="token number">2</span> root root <span class="token number">16384</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:54 lost+found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="隐藏属性"><a class="markdownIt-Anchor" href="#隐藏属性"></a> 隐藏属性</h1>
<p>文件和文件夹主要的隐藏属性列表如下：</p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>访问此文件的 atime 不会被修改，可避免读写较慢的机器过度访问磁盘。</td>
</tr>
<tr>
<td>S</td>
<td>加上此属性后，任何修改都将立即写入硬盘，不在内存中缓存。</td>
</tr>
<tr>
<td>a</td>
<td>设置此属性后，文件只能增加数据，不能删除也不能修改数据。设置在目录上，目录内的文件不能删除。</td>
</tr>
<tr>
<td>c</td>
<td>此文件会自动压缩，读取时自动解压缩。储存时会先进行压缩。</td>
</tr>
<tr>
<td>d</td>
<td>当 dump 执行时，此文件或目录不会被 dump 备份。</td>
</tr>
<tr>
<td>i</td>
<td>文件不能删除、改名、修改。设置在目录上表示不允许在目录内建立和删除文件。</td>
</tr>
<tr>
<td>s</td>
<td>如果文件被删除，立即将原先位置填充，完全销毁数据。</td>
</tr>
<tr>
<td>u</td>
<td>开启回收站功能，文件被删除后还能恢复。</td>
</tr>
</tbody>
</table>
<p>上表是在 ext 文件系统中可用的属性，xfs 文件系统仅支持部分隐藏属性。</p>
<h2 id="设置隐藏属性"><a class="markdownIt-Anchor" href="#设置隐藏属性"></a> 设置隐藏属性</h2>
<p>使用 <code>chattr</code> 命令来给文件设置隐藏属性。例如给文件 1 加上 i 和 a 属性：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ chattr +ia <span class="token number">1</span>
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token number">1</span>
rm: cannot remove <span class="token string">'1'</span><span class="token builtin class-name">:</span> Operation not permitted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>取消文件的隐藏属性 i：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ chattr <span class="token parameter variable">-i</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果设置对象是文件夹，使用 <code>-R</code> 可以递归修改，在文件夹中新建的文件会继承隐藏属性。</p>
<h2 id="显示文件隐藏属性"><a class="markdownIt-Anchor" href="#显示文件隐藏属性"></a> 显示文件隐藏属性</h2>
<p>使用 <code>lsattr</code> ming’l 来查看文件或目录的隐藏属性：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ lsattr <span class="token parameter variable">-R</span>
---------------- ./anaconda-ks.cfg
---------------- ./audit

./audit:
---------------- ./audit/mvau.log
---------------- ./audit/b.log

---------------- ./2
--S--adA-------- ./3

./3:
--S--adA-------- ./3/3

--S-ia-A-------- ./1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 文件查看</title>
    <url>/1251081056/</url>
    <content><![CDATA[<h1 id="一次性输出"><a class="markdownIt-Anchor" href="#一次性输出"></a> 一次性输出</h1>
<p>在 Linux 中，可以使用 <code>cat</code> 和 <code>tac</code> 命令一次性将文本内容打印出来，即将标准输入的数据复制到标准输出。</p>
<p><code>cat</code> 是 Catenate 的缩写，从第一行开始显示文件内容。另外一个重要的应用是组合多个文件。如果没有指定文件或文件为 <code>-</code>，则从标准输入读取。</p>
<p>例如，要查看 <code>c.log</code> 文件的内容，并使用 <code>-b</code> 参数来显示行号（不计空行，计空行使用 <code>-n</code>）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">cat</span> <span class="token parameter variable">-b</span> c.log 
     <span class="token number">1</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061.322</span>:415<span class="token punctuation">)</span>
     <span class="token number">2</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>USER_END <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061</span>
     <span class="token number">3</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>USER_START <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">163</span>
     <span class="token number">4</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>-A</code> 参数可以将特殊字符打印出来，例如 <code>[Tab]</code> 显示为 <code>^I</code>，<code>[Enter]</code> 换行显示为 <code>$</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">cat</span> <span class="token parameter variable">-nA</span> c.log 
     <span class="token number">1</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061.322</span>:415<span class="token punctuation">)</span>
     <span class="token number">2</span> ^Itype<span class="token operator">=</span>USER_END <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061</span>$
     <span class="token number">3</span>   <span class="token assign-left variable">type</span><span class="token operator">=</span>USER_START <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">163</span>$
     <span class="token number">4</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audi$
     <span class="token number">5</span> $<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>cat</code> 命令的一个常见用途是将多个文件内容组合到一个文件中：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> ftp.sh ca.srl <span class="token operator">>></span> newfile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>使用 <code>tac</code> 命令可以倒序输出文件内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">tac</span> c.log 
<span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audi
  <span class="token assign-left variable">type</span><span class="token operator">=</span>USER_START <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">163</span>
       <span class="token assign-left variable">type</span><span class="token operator">=</span>USER_END <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061</span>
<span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061.322</span>:415<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果要将每行的内容反转输出，可以使用 <code>rev</code> 命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server3 ~<span class="token punctuation">]</span>$ <span class="token function">rev</span> ftp.sh 
gro.miv.ptf nepo
bup <span class="token function">dc</span>
txt.tahWdniFoTerehW teg
eyb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>nl</code> 命令可以自定义行号位置打印文件内容，例如给行号加零填充：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">nl</span> <span class="token parameter variable">-n</span> rz c.log 
000001 <span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061.322</span>:415<span class="token punctuation">)</span>
000002  <span class="token assign-left variable">type</span><span class="token operator">=</span>USER_END <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061</span>
000003   <span class="token assign-left variable">type</span><span class="token operator">=</span>USER_START <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">163</span>
000004 <span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="阅读文件"><a class="markdownIt-Anchor" href="#阅读文件"></a> 阅读文件</h1>
<p>使用 <code>more</code> 命令可以查看文件内容并逐页翻阅：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">more</span> nohup.out
Vim: Warning: Output is not to a terminal
Vim: Warning: Input is not from a terminal
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
--More--<span class="token punctuation">(</span><span class="token number">23</span>%<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当文件内容超过一页时，会提示 <code>--More--</code>，此时可以使用以下按键进行操作：</p>
<table>
<thead>
<tr>
<th>按键</th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>空格(space)</td>
<td>向下翻一页</td>
</tr>
<tr>
<td>回车(enter)</td>
<td>向下滚动一行</td>
</tr>
<tr>
<td>/字符串</td>
<td>向下搜索关键字,定位到那一页</td>
</tr>
<tr>
<td>:f</td>
<td>显示文件名以及当前行数</td>
</tr>
<tr>
<td>q</td>
<td>退出</td>
</tr>
<tr>
<td>b</td>
<td>往回翻页,对管道无用</td>
</tr>
<tr>
<td>v</td>
<td>调用 vi 编辑器</td>
</tr>
</tbody>
</table>
<p>使用<code>less</code>命令查看文件时，可以使用方向键进行导航：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">less</span> nohup.out
Vim: Warning: Output is not to a terminal
Vim: Warning: Output is not to a terminal
<span class="token builtin class-name">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>进入查看页面后，可以使用以下键盘按键：</p>
<table>
<thead>
<tr>
<th>按键</th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>PageUp/PageDown</td>
<td>向上/向下翻页。</td>
</tr>
<tr>
<td>方向键上/方向键下</td>
<td>向上/向下滚动一行。</td>
</tr>
<tr>
<td>/字符串&amp;?字符串</td>
<td>向下&amp;向上查询字符串。</td>
</tr>
<tr>
<td>n/N</td>
<td>向下/向上重复查询。</td>
</tr>
<tr>
<td>v</td>
<td>启动 vi 编辑器编辑当前文件。</td>
</tr>
<tr>
<td>q</td>
<td>离开。</td>
</tr>
<tr>
<td>h</td>
<td>帮助文件。</td>
</tr>
</tbody>
</table>
<p>可以通过设置环境变量 PAGER 来指定希望使用的分页程序。</p>
<h1 id="数据选取"><a class="markdownIt-Anchor" href="#数据选取"></a> 数据选取</h1>
<p><code>head</code> 命令可以设定从文件开头开始选取多少行的内容。例如，要查看 nohup.out 文件的前 2 行内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">head</span> <span class="token parameter variable">-2</span> nohup.out
Vim: Warning: Output is not to a terminal
Vim: Warning: Input is not from a terminal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>tail</code> 命令则从文件后面开始取多少行的内容并显示出来。例如，要选取查看 list.txt 文件最后 1 行的内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">tail</span> <span class="token parameter variable">-1</span> list.txt
/tmp/etc/skel/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>可以加上 <code>-f</code> 参数来持续打印文件内容，这在查看日志文件时非常有用：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">tail</span> <span class="token parameter variable">-f</span> nohup.out 
Vim: Error reading input, exiting<span class="token punctuation">..</span>.sers package to sandbox the tcsd daemon:/devv
Vim: Finished.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这将持续打印 nohup.out 文件的内容，直到手动停止命令。</p>
<h1 id="二进制文件查看"><a class="markdownIt-Anchor" href="#二进制文件查看"></a> 二进制文件查看</h1>
<p>使用普通的文本查看命令查看二进制文件会显示乱码，可以使用 <code>od</code> 命令来查阅二进制文件。</p>
<p>例如，以默认八进制方式查看 <code>passwd</code> 文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ od /bin/passwd <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">10</span>
0000000 042577 043114 000402 000001 000000 000000 000000 000000
0000020 000003 000076 000001 000000 031110 000000 000000 000000
0000040 000100 000000 000000 000000 062620 000000 000000 000000
0000060 000000 000000 000100 000070 000011 000100 000035 000034
0000100 000006 000000 000005 000000 000100 000000 000000 000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>用 <code>-t</code> 参数指定显示格式，例如将十六位进制与 ASCII 字符同时显示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ od <span class="token parameter variable">-t</span> xCc c.log
0000000  <span class="token number">74</span>  <span class="token number">79</span>  <span class="token number">70</span>  <span class="token number">65</span>  3d  <span class="token number">43</span>  <span class="token number">52</span>  <span class="token number">45</span>  <span class="token number">44</span>  5f  <span class="token number">44</span>  <span class="token number">49</span>  <span class="token number">53</span>  <span class="token number">50</span>  <span class="token number">20</span>  6d
          t   y   p   e   <span class="token operator">=</span>   C   R   E   D   _   D   I   S   P       m
0000020  <span class="token number">73</span>  <span class="token number">67</span>  3d  <span class="token number">61</span>  <span class="token number">75</span>  <span class="token number">64</span>  <span class="token number">69</span>  <span class="token number">74</span>  <span class="token number">28</span>  <span class="token number">31</span>  <span class="token number">36</span>  <span class="token number">33</span>  <span class="token number">31</span>  <span class="token number">31</span>  <span class="token number">37</span>  <span class="token number">38</span>
          s   g   <span class="token operator">=</span>   a   u   d   i   t   <span class="token punctuation">(</span>   <span class="token number">1</span>   <span class="token number">6</span>   <span class="token number">3</span>   <span class="token number">1</span>   <span class="token number">1</span>   <span class="token number">7</span>   <span class="token number">8</span>
0000040  <span class="token number">30</span>  <span class="token number">36</span>  <span class="token number">31</span>  2e  <span class="token number">33</span>  <span class="token number">32</span>  <span class="token number">32</span>  3a  <span class="token number">34</span>  <span class="token number">31</span>  <span class="token number">35</span>  <span class="token number">29</span>  3a  <span class="token number">20</span>  <span class="token number">70</span>  <span class="token number">69</span>
          <span class="token number">0</span>   <span class="token number">6</span>   <span class="token number">1</span>   <span class="token builtin class-name">.</span>   <span class="token number">3</span>   <span class="token number">2</span>   <span class="token number">2</span>   <span class="token builtin class-name">:</span>   <span class="token number">4</span>   <span class="token number">1</span>   <span class="token number">5</span>   <span class="token punctuation">)</span>   <span class="token builtin class-name">:</span>       p   i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也可以使用 <code>hexdump</code> 命令来查看二进制文件，唯一区别是 <code>hexdump</code> 默认情况下以十六进制显示数据：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server3 ~<span class="token punctuation">]</span>$ hexdump <span class="token parameter variable">-C</span> /usr/bin/scsi_temperature
00000000  <span class="token number">23</span> <span class="token number">21</span> 2f <span class="token number">62</span> <span class="token number">69</span> 6e 2f <span class="token number">62</span>  <span class="token number">61</span> <span class="token number">73</span> <span class="token number">68</span> 0a 0a <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span>  <span class="token operator">|</span><span class="token comment">#!/bin/bash..###|</span>
00000010  <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span>  <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span> <span class="token number">23</span>  <span class="token operator">|</span><span class="token comment">################|</span>
*
00000050  0a <span class="token number">23</span> 0a <span class="token number">23</span> <span class="token number">20</span> <span class="token number">20</span> <span class="token number">43</span> <span class="token number">68</span>  <span class="token number">65</span> <span class="token number">63</span> 6b <span class="token number">20</span> <span class="token number">74</span> <span class="token number">68</span> <span class="token number">65</span> <span class="token number">20</span>  <span class="token operator">|</span><span class="token builtin class-name">.</span><span class="token comment">#.#  Check the |</span>
00000060  <span class="token number">74</span> <span class="token number">65</span> 6d <span class="token number">70</span> <span class="token number">65</span> <span class="token number">72</span> <span class="token number">61</span> <span class="token number">74</span>  <span class="token number">75</span> <span class="token number">72</span> <span class="token number">65</span> <span class="token number">20</span> 6f <span class="token number">66</span> <span class="token number">20</span> <span class="token number">74</span>  <span class="token operator">|</span>temperature of t<span class="token operator">|</span>
00000070  <span class="token number">68</span> <span class="token number">65</span> <span class="token number">20</span> <span class="token number">67</span> <span class="token number">69</span> <span class="token number">76</span> <span class="token number">65</span> 6e  <span class="token number">20</span> <span class="token number">53</span> <span class="token number">43</span> <span class="token number">53</span> <span class="token number">49</span> <span class="token number">20</span> <span class="token number">64</span> <span class="token number">65</span>  <span class="token operator">|</span>he given SCSI de<span class="token operator">|</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面二进制数据显示方式叫规范格式（Canonical Format）。每行最左边是十六进制表示的偏移，中间 16 个字节是实际数据，右边为相应 ASCII 字符。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 目录操作</title>
    <url>/735422586/</url>
    <content><![CDATA[<h1 id="路径"><a class="markdownIt-Anchor" href="#路径"></a> 路径</h1>
<p>根据文件名写法不同，可以分为绝对路径（absolute）和相对路径（relative）：</p>
<ul>
<li>
<p><strong>绝对路径</strong></p>
<p>由根目录开始写起的文件或目录名称，定义了在虚拟目录结构中该文件的确切位置。例如 <code>/home/base/.bashrc</code>。</p>
</li>
<li>
<p><strong>相对路径</strong></p>
<p>基于目前位置的路径写法。例如 <code>./base/.bashrc</code> 或 <code>../../home/base/</code> 等。</p>
</li>
</ul>
<p>Linux 中有些比较特殊的目录表示符号如下表：</p>
<table>
<thead>
<tr>
<th><strong>符号</strong></th>
<th><strong>意义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>此层目录</td>
</tr>
<tr>
<td>…</td>
<td>上一层目录</td>
</tr>
<tr>
<td>-</td>
<td>前一个工作目录</td>
</tr>
<tr>
<td>~</td>
<td>目前用户身份所在的主文件夹</td>
</tr>
<tr>
<td>~account</td>
<td>代表 account 这个用户的主文件夹</td>
</tr>
</tbody>
</table>
<h1 id="显示当前目录"><a class="markdownIt-Anchor" href="#显示当前目录"></a> 显示当前目录</h1>
<p>使用 <code>pwd</code> 命令（Print Working Directory 的缩写）显示目前所在目录。</p>
<p>如显示当前路径：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 init.d<span class="token punctuation">]</span>$ <span class="token builtin class-name">pwd</span>
/etc/init.d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>追踪链接文件显示实际路径加 <code>-P</code> 参数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 init.d<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /var/mail <span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span>
/var/mail
<span class="token punctuation">[</span>root@101c7 mail<span class="token punctuation">]</span>$ <span class="token builtin class-name">pwd</span> <span class="token parameter variable">-P</span>
/var/spool/mail<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="切换目录"><a class="markdownIt-Anchor" href="#切换目录"></a> 切换目录</h1>
<p>切换目录使用 <code>cd</code> 命令（change directory 的缩写）。</p>
<p>例如进入到用户 abc 主目录下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> ~abc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>使用绝对路径写法进入到 <code>/etc/fonts/</code> 目录中：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /etc/fonts/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>回退到上个目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> -
/etc/fonts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>使用相对路径写法进入到上级目录下的 init.d 目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 fonts<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/init.d/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>不接参数直接进入当前用户的主目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> <span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span>
/root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="新建目录"><a class="markdownIt-Anchor" href="#新建目录"></a> 新建目录</h1>
<p>使用 <code>mkdir</code> 命令（make directory 的简写）来建立目录。</p>
<p>如建立一个名为 test1 的目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> test1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可以用 -p 参数建立嵌套目录，比如建立 test2 文件夹后，在其下建立 test3 文件夹：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> test2/test3 <span class="token punctuation">;</span> ll test2
total <span class="token number">0</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">6</span> Sep <span class="token number">9</span> 04:19 test3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>可以同时创建多个目录，目录名之间用空格分开。如一次建立 a1、b2、c3 三个文件夹：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> a1 b2 c3 <span class="token punctuation">;</span> ll
total <span class="token number">3</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">6</span> Sep <span class="token number">9</span> 04:21 a1
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">6</span> Sep <span class="token number">9</span> 04:21 b2
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">6</span> Sep <span class="token number">9</span> 04:21 c3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>新建目录默认权限是 755，可以用 <code>-m</code> 参数在创建目录时自定义权限，比如建立权限为 777 的文件夹 decay：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 a1<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> <span class="token parameter variable">-m</span> <span class="token number">777</span> decay <span class="token punctuation">;</span> ll
total <span class="token number">0</span>
drwxrwxrwx. <span class="token number">2</span> root root <span class="token number">6</span> Sep <span class="token number">9</span> 04:23 decay<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="删除空目录"><a class="markdownIt-Anchor" href="#删除空目录"></a> 删除空目录</h1>
<p>使用 <code>rmdir</code> 只能删除空目录。例如同时删除空目录 b2、c3：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">rmdir</span> b2 c3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可以加入 <code>-p</code> 来递归删除多级空目录。例如删除 decay 目录下面的空文件夹 cc，再删除 decay 目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 a1<span class="token punctuation">]</span>$ ll
total <span class="token number">0</span>
drwxrwxrwx. <span class="token number">3</span> root root <span class="token number">16</span> Sep <span class="token number">9</span> 04:31 decay
<span class="token punctuation">[</span>root@101c7 a1<span class="token punctuation">]</span>$ <span class="token function">rmdir</span> <span class="token parameter variable">-p</span> decay/cc/ <span class="token punctuation">;</span> ll
total <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="查询目录大小"><a class="markdownIt-Anchor" href="#查询目录大小"></a> 查询目录大小</h1>
<p>使用 <code>du</code> 可以查询到文件或目录所占大小。列出当前目录下面所有文件与目录大小：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ <span class="token function">du</span> <span class="token parameter variable">-ha</span>
102K    ./100K2
21M     ./1.copy
21M     ./lost+found/1.copy
21M     ./lost+found
<span class="token number">2</span>.0K    ./a.cfg
21M     ./1.iso
<span class="token number">2</span>.0K    ./users/jill.txt
<span class="token number">4</span>.0K    ./users
102K    ./100K
61M     <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最末一行显示整个文件夹大小为 61MB。</p>
<p>只统计当前目录下文件和文件夹（不列出文件夹下文件）大小，不包括隐藏文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ <span class="token function">du</span> <span class="token parameter variable">-sh</span> *
102K    ./100K
102K    ./100K2
21M     ./1.copy
21M     ./1.iso
<span class="token number">2</span>.0K    ./a.cfg
21M     ./lost+found
<span class="token number">4</span>.0K    ./users<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>统计包含隐藏文件和文件夹大小：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@k8s-250 ~<span class="token punctuation">]</span>$ <span class="token function">du</span> <span class="token parameter variable">-h</span> --max-depth<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">0</span>       ./.pki
16M     ./.kube
16K     ./.ssh
<span class="token number">0</span>       ./.git-credential-cache
<span class="token number">8</span>.0K    ./.docker
124K    ./.mizu
40K     ./.cache
<span class="token number">1</span>.7G    ./1
<span class="token number">1</span>.7G    <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 启动流程</title>
    <url>/4291230975/</url>
    <content><![CDATA[<h1 id="bios-启动流程"><a class="markdownIt-Anchor" href="#bios-启动流程"></a> BIOS 启动流程</h1>
<p>目前，主机系统在载入硬件驱动方面的程序有两种：使用 BIOS 和 UEFI。简单的开机流程分为以下步骤：</p>
<ol>
<li>载入 BIOS 或 UEFI 的硬件信息与自测（POST，Power-On Self-Test），并根据设置取得第一个可开机的设备；</li>
<li>对于 BIOS，通过硬件的 INT 13 中断功能，读取并执行第一个可开机设备内 MBR 的引导加载程序（Boot Loader）；对于 UEFI，读取并执行第一个可开机设备内 EFI 分区的引导加载程序；</li>
<li>依据引导加载程序的设置，识别文件系统格式，加载核心文件。由内核开始检测硬件与驱动；</li>
<li>启动初始进程管理程序（systemd 或 System V），最终目的都是启动基础服务和用户设置的开机启动程序。</li>
</ol>
<p>在使用 BIOS 时，通常搭配 MBR（Master Boot Record）分区表。而在使用 UEFI 时，通常搭配 GPT（GUID Partition Table）分区表。GPT 格式启动过程与 MBR 类似，差异在于开机管理程序是否支持 GPT。</p>
<p>在引导加载程序读取到内核文件后，Linux 会将内核解压到内存中，由内核开始测试与驱动硬件。此时 Linux 内核会以自己检测结果为准，而不理会 BIOS 的硬件检测结果。也就是说内核此时开始接管 BIOS 后的工作了。</p>
<h1 id="多系统引导"><a class="markdownIt-Anchor" href="#多系统引导"></a> 多系统引导</h1>
<p>引导加载程序除了可以安装在 MBR 外，还可以安装到每个文件系统的引导扇区（Boot Sector）。</p>
<p>例如，硬盘第一和第二分区分别安装了 Windows 和 Linux。开机装载第一个分区引导加载程序，此时会出现分支选项：</p>
<ul>
<li>选择启动 Windows 直接加载第一个分区中的 Windows 核心文件。</li>
<li>选择启动 Linux 则转到第二个分区的引导扇区，由第二个分区的引导加载程序完成 Linux 系统启动工作。</li>
</ul>
<p>如果要安装多重开机，一般先安装 Windows 再安装 Linux，因为 Windows 安装时会直接覆盖掉 MBR 以及自己所在分区的引导扇区，并且 Windows 的引导程序默认没有转移引导功能。而 Linux 安装时可以选择引导加载程序不安装到 MBR，只装在指定分区的引导扇区。之后修改引导程序加入 Windows 开机选项，完成双系统引导功能。</p>
<h1 id="引导目录说明"><a class="markdownIt-Anchor" href="#引导目录说明"></a> 引导目录说明</h1>
<p>如果使用 GRUB 引导，需给 <code>/boot</code> 分区来放置开机过程所需的文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ ll /boot
total <span class="token number">149232</span>
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">153596</span> Aug <span class="token number">31</span> <span class="token number">10</span>:57 config-3.10.0-1160.41.1.el7.x86_64
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">147819</span> Apr <span class="token number">20</span>  <span class="token number">2018</span> config-3.10.0-862.el7.x86_64
drwxr-xr-x. <span class="token number">3</span> root root       <span class="token number">17</span> Sep  <span class="token number">7</span> <span class="token number">13</span>:34 efi
drwxr-xr-x. <span class="token number">2</span> root root       <span class="token number">27</span> Sep  <span class="token number">7</span> <span class="token number">13</span>:35 grub
drwx------. <span class="token number">5</span> root root      <span class="token number">132</span> Sep  <span class="token number">7</span> 05:55 grub2
-rw-------. <span class="token number">1</span> root root <span class="token number">55385253</span> Sep  <span class="token number">7</span> <span class="token number">13</span>:37 initramfs-0-rescue-77a36143eb014dd5a0d6e738b1d84778.img
-rw-------. <span class="token number">1</span> root root <span class="token number">21322754</span> Sep  <span class="token number">7</span> 05:55 initramfs-3.10.0-1160.41.1.el7.x86_64.img
-rw-------. <span class="token number">1</span> root root <span class="token number">13851614</span> Sep <span class="token number">18</span> <span class="token number">23</span>:13 initramfs-3.10.0-1160.41.1.el7.x86_64kdump.img
-rw-------. <span class="token number">1</span> root root <span class="token number">21288233</span> Sep  <span class="token number">7</span> 05:56 initramfs-3.10.0-862.el7.x86_64.img
-rw-------. <span class="token number">1</span> root root <span class="token number">13761710</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:00 initramfs-3.10.0-862.el7.x86_64kdump.img
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">320757</span> Aug <span class="token number">31</span> <span class="token number">10</span>:57 symvers-3.10.0-1160.41.1.el7.x86_64.gz
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">304926</span> Apr <span class="token number">20</span>  <span class="token number">2018</span> symvers-3.10.0-862.el7.x86_64.gz
-rw-------. <span class="token number">1</span> root root  <span class="token number">3620596</span> Aug <span class="token number">31</span> <span class="token number">10</span>:57 System.map-3.10.0-1160.41.1.el7.x86_64
-rw-------. <span class="token number">1</span> root root  <span class="token number">3409143</span> Apr <span class="token number">20</span>  <span class="token number">2018</span> System.map-3.10.0-862.el7.x86_64
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">6224704</span> Sep  <span class="token number">7</span> <span class="token number">13</span>:37 vmlinuz-0-rescue-77a36143eb014dd5a0d6e738b1d84778
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">6773352</span> Aug <span class="token number">31</span> <span class="token number">10</span>:57 vmlinuz-3.10.0-1160.41.1.el7.x86_64
-rwxr-xr-x. <span class="token number">1</span> root root  <span class="token number">6224704</span> Apr <span class="token number">20</span>  <span class="token number">2018</span> vmlinuz-3.10.0-862.el7.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>/boot</code> 内文件与目录说明如下所示：</p>
<table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>config-*</td>
<td>此版本内核被编译时选择的功能与模块配置文件</td>
</tr>
<tr>
<td>grub、grub2</td>
<td>开机管理程序 grub 相关数据目录</td>
</tr>
<tr>
<td>initramfs-0-rescue-*</td>
<td>救援模式的虚拟文件系统</td>
</tr>
<tr>
<td>initramfs-*.img</td>
<td>正常模式的虚拟文件系统</td>
</tr>
<tr>
<td>initramfs-*kdump.img</td>
<td>内核出问题时用到的虚拟文件系统</td>
</tr>
<tr>
<td>System.map-*</td>
<td>内核功能放置到内存位址的对应表</td>
</tr>
<tr>
<td>vmlinuz-0-rescue-*</td>
<td>救援模式的内核文件</td>
</tr>
<tr>
<td>vmlinuz-*</td>
<td>正常模式的内核文件</td>
</tr>
</tbody>
</table>
<h1 id="虚拟文件系统"><a class="markdownIt-Anchor" href="#虚拟文件系统"></a> 虚拟文件系统</h1>
<p>Linux 内核可以动态载入内核模块（驱动），这些内核模块放置在 <code>/lib/modules/</code> 目录内。由于模块放置到根目录内，因此开机过程中内核必须要以只读方式挂载根目录，才可以读取到驱动程序。</p>
<p>但是在挂载根目录时，很大可能 Linux 内核并不认识 SATA 设备。为了让内核顺利执行下去，引用了一个虚拟文件系统（Initial RAM Disk 或 Initial RAM Filesystem）来处理，就是在 <code>/boot</code> 目录内以 initramfs 开头命名的 img 文件。</p>
<p>虚拟文件系统的 img 文件也能被引导加载程序载入到内存中，解压后在内存中仿真成一个根目录。内核会读取虚拟文件系统内的驱动，通常是与磁盘接口和文件系统格式支持有关的驱动程序。</p>
<p>等驱动载入完毕，根目录所在分区信息被正确识别后，此虚拟文件系统被卸载，并挂载实际的根目录文件系统，继续后续开机流程。</p>
<p>可以用 <code>lsinitrd</code> 命令查看 initramfs 镜像的内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ lsinitrd /boot/initramfs-3.10.0-1160.41.1.el7.x86_64.img 
Image: /boot/initramfs-3.10.0-1160.41.1.el7.x86_64.img: 21M
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Early CPIO image
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
drwxr-xr-x   <span class="token number">3</span> root     root            <span class="token number">0</span> Sep  <span class="token number">7</span> 05:55 <span class="token builtin class-name">.</span>
-rw-r--r--   <span class="token number">1</span> root     root            <span class="token number">2</span> Sep  <span class="token number">7</span> 05:55 early_cpio
drwxr-xr-x   <span class="token number">3</span> root     root            <span class="token number">0</span> Sep  <span class="token number">7</span> 05:55 kernel
drwxr-xr-x   <span class="token number">3</span> root     root            <span class="token number">0</span> Sep  <span class="token number">7</span> 05:55 kernel/x86
drwxr-xr-x   <span class="token number">2</span> root     root            <span class="token number">0</span> Sep  <span class="token number">7</span> 05:55 kernel/x86/microcode
-rw-r--r--   <span class="token number">1</span> root     root         <span class="token number">6476</span> Sep  <span class="token number">7</span> 05:55 kernel/x86/microcode/AuthenticAMD.bin
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Version: dracut-033-572.el7

Arguments: <span class="token parameter variable">-f</span>

dracut modules:
<span class="token function">bash</span>
nss-softokn
i18n
microcode_ctl-fw_dir_override
<span class="token function">shutdown</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
drwxr-xr-x  <span class="token number">12</span> root     root            <span class="token number">0</span> Sep  <span class="token number">7</span> 05:55 <span class="token builtin class-name">.</span>
crw-r--r--   <span class="token number">1</span> root     root       <span class="token number">5</span>,   <span class="token number">1</span> Sep  <span class="token number">7</span> 05:55 dev/console
crw-r--r--   <span class="token number">1</span> root     root       <span class="token number">1</span>,  <span class="token number">11</span> Sep  <span class="token number">7</span> 05:55 dev/kmsg
crw-r--r--   <span class="token number">1</span> root     root       <span class="token number">1</span>,   <span class="token number">3</span> Sep  <span class="token number">7</span> 05:55 dev/null
lrwxrwxrwx   <span class="token number">1</span> root     root            <span class="token number">7</span> Sep  <span class="token number">7</span> 05:55 bin -<span class="token operator">></span> usr/bin
drwxr-xr-x   <span class="token number">2</span> root     root            <span class="token number">0</span> Sep  <span class="token number">7</span> 05:55 dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到，这个 img 文件可以分为两部分。前半部分包括一些预先声明的数据，其中包括一个可执行的 bin 文件；而后半部分才是内核会去读取的重要文件。</p>
<p>进一步解压整个 img 文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 initrams<span class="token punctuation">]</span>$ <span class="token function">cp</span> /boot/initramfs-3.10.0-1160.41.1.el7.x86_64.img init.img
<span class="token punctuation">[</span>root@101c7 initrams<span class="token punctuation">]</span>$ <span class="token function">file</span> init.img 
init.img: ASCII cpio archive <span class="token punctuation">(</span>SVR4 with no CRC<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@101c7 initrams<span class="token punctuation">]</span>$ /usr/lib/dracut/skipcpio init.img <span class="token operator">|</span> zcat <span class="token operator">|</span> cpio <span class="token parameter variable">-div</span>
init
<span class="token function">shutdown</span>
<span class="token number">88189</span> blocks
<span class="token punctuation">[</span>root@101c7 initrams<span class="token punctuation">]</span>$ ll
total <span class="token number">8</span>
lrwxrwxrwx.  <span class="token number">1</span> root root    <span class="token number">7</span> Sep <span class="token number">19</span> 09:10 bin -<span class="token operator">></span> usr/bin
drwxr-xr-x.  <span class="token number">2</span> root root   <span class="token number">45</span> Sep <span class="token number">19</span> 09:10 dev
drwxr-xr-x. <span class="token number">12</span> root root <span class="token number">4096</span> Sep <span class="token number">19</span> 09:10 etc
lrwxrwxrwx.  <span class="token number">1</span> root root   <span class="token number">23</span> Sep <span class="token number">19</span> 09:10 init -<span class="token operator">></span> usr/lib/systemd/systemd
lrwxrwxrwx.  <span class="token number">1</span> root root    <span class="token number">7</span> Sep <span class="token number">19</span> 09:10 lib -<span class="token operator">></span> usr/lib
lrwxrwxrwx.  <span class="token number">1</span> root root    <span class="token number">9</span> Sep <span class="token number">19</span> 09:10 lib64 -<span class="token operator">></span> usr/lib64
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Sep <span class="token number">19</span> 09:10 proc
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Sep <span class="token number">19</span> 09:10 root
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Sep <span class="token number">19</span> 09:10 run
lrwxrwxrwx.  <span class="token number">1</span> root root    <span class="token number">8</span> Sep <span class="token number">19</span> 09:10 sbin -<span class="token operator">></span> usr/sbin
-rwxr-xr-x.  <span class="token number">1</span> root root <span class="token number">3117</span> Sep <span class="token number">19</span> 09:10 <span class="token function">shutdown</span>
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Sep <span class="token number">19</span> 09:10 sys
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Sep <span class="token number">19</span> 09:10 sysroot
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Sep <span class="token number">19</span> 09:10 tmp
drwxr-xr-x.  <span class="token number">7</span> root root   <span class="token number">66</span> Sep <span class="token number">19</span> 09:10 usr
drwxr-xr-x.  <span class="token number">2</span> root root   <span class="token number">29</span> Sep <span class="token number">19</span> 09:10 var<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解压后查询下这个文件系统中 systemd 调用的运行模式：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 initrams<span class="token punctuation">]</span>$ ll usr/lib/systemd/system/default.target
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">13</span> Sep <span class="token number">19</span> 09:10 usr/lib/systemd/system/default.target -<span class="token operator">></span> initrd.target
<span class="token punctuation">[</span>root@101c7 initrams<span class="token punctuation">]</span>$ systemctl list-dependencies initrd.target
initrd.target
● ├─dracut-cmdline.service
● ├─dracut-initqueue.service
● ├─dracut-mount.service
● ├─dracut-pre-mount.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过查询 initrd.target 可以知道内核先是用载入虚拟文件系统中的 basic.target、sysinit.target 等功能启用的流程，让系统顺利运行，再卸载虚拟文件系统，挂载实际系统根目录。</p>
<p>如果想要创建一个自定义的 initramfs 镜像，可以使用 dracut 或 mkinitrd 来处理。例如，新建一个添加了 x200 网卡驱动和 nfs 文件系统驱动的 initramfs 镜像：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ dracut <span class="token parameter variable">-v</span> -add-drivers <span class="token string">"x200"</span> <span class="token parameter variable">--filesystems</span> <span class="token string">"nfs"</span> <span class="token operator">></span> initramfs-new.img <span class="token operator">&amp;</span> <span class="token punctuation">(</span>uname -r<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="systemd-启动流程"><a class="markdownIt-Anchor" href="#systemd-启动流程"></a> Systemd 启动流程</h1>
<p>Systemd 是一种系统和服务管理器，是 Linux 系统中的一项关键技术。它可以用于启动、停止和管理系统进程、网络、文件系统和其他系统资源。Systemd 最初是为 Red Hat Linux 发行版设计的，但现在已被广泛采用，并被大多数 Linux 发行版所使用。</p>
<p>Systemd 的主要优势是速度和可靠性。它的启动速度远远快于传统的 init 系统，因为它能够并行启动多个服务。此外，Systemd 还提供了强大的日志功能和灵活的单元文件格式，可用于管理各种类型的服务和资源。</p>
<p>Systemd 还引入了一些新的概念，例如单元和片段。单元是 Systemd 中的基本单位，用于描述系统资源（例如服务、套接字、挂载点等）。片段是一种单元文件的组成部分，它可以被其他单元文件重用。这种灵活性使得 Systemd 能够更容易地管理和组织系统资源，使其更加模块化和可重用。</p>
<h2 id="启动流程"><a class="markdownIt-Anchor" href="#启动流程"></a> 启动流程</h2>
<p>在内核载入完毕硬件驱动后，采用 systemd 管理服务的启动流程如下：</p>
<ol>
<li>内核会主动调用第一个程序 <code>systemd</code> 执行 sysinit.target 初始化系统及 basic.target 准备系统；</li>
<li>接下来到<code>/usr/lib/systemd/system/</code>目录下去调用 multi-user.target(default.target)；</li>
<li>然后系统会到<code>/etc/systemd/system/multi-user.target.wants/</code>目录去找用户设置开机启动服务(unit)；</li>
<li>最后到<code>/usr/lib/systemd/system/multi-user.target.wants/</code>目录去找系统默认的开机启动服务(unit)；</li>
<li>（非必须）执行 graphical 需要的服务。</li>
</ol>
<p>至于最终启动的服务有哪些，可以用<code>systemctl list-dependencies</code>命令查询：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 initrams<span class="token punctuation">]</span>$ systemctl list-dependencies multi-user.target <span class="token operator">|</span> <span class="token function">grep</span> target
multi-user.target
● ├─basic.target
● │ ├─selinux-policy-migrate-local-changes@targeted.service
● │ ├─paths.target
● │ ├─slices.target
● │ ├─sockets.target
● │ ├─sysinit.target
● │ │ ├─cryptsetup.target
● │ │ ├─local-fs.target
● │ │ └─swap.target
● │ └─timers.target
● ├─getty.target
● └─remote-fs.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>另外，为了兼容旧有的通过 <code>/etc/rc.d/rc.local</code> 配置自启动脚本的方式，CentOS 7 保留了一个 rc-local.service 来执行这些脚本。</p>
<h2 id="启动相关目录"><a class="markdownIt-Anchor" href="#启动相关目录"></a> 启动相关目录</h2>
<p>开机会读取的文件目录如下：</p>
<ul>
<li><code>/etc/modules-load.d/*.conf</code>：配置内核需要加载的模块。</li>
<li><code>/etc/modprobe.d/*.conf</code>：可以设置模块参数的配置。</li>
<li><code>/etc/sysconfig/</code>：系统配置目录下有许多环境配置文件，其中一些重要的是：
<ul>
<li>authconfig：用于规范用户身份认证机制，包括是否使用本地 <code>/etc/passwd</code>，<code>/etc/shadow</code> 等文件以及密码记录使用的加密算法，是否使用外部密码服务器提供的账号验证（NIS、LDAP）等。</li>
<li>cpupower：如果启动了 cpupower.service 服务，会读取此配置文件。</li>
<li>firewalld、iptables-config、iptables-config、ebtables-config：与防火墙服务相关的配置。</li>
<li>network-scripts：网卡设置。</li>
</ul>
</li>
</ul>
<h1 id="system-v-启动流程"><a class="markdownIt-Anchor" href="#system-v-启动流程"></a> System V 启动流程</h1>
<p>System V (System 5) 是 Unix 操作系统中的一个初始化系统。它是早期 Unix 系统的标准初始化系统，常见于许多 Linux 发行版中。System V 通过运行一个脚本，逐个启动和停止系统服务来初始化系统。这些脚本通常存储在 <code>/etc/rc.d/init.d/</code> 目录下，每个脚本对应着一个系统服务。在系统启动或关闭时，System V 会根据 <code>/etc/inittab</code> 文件的配置来执行这些脚本。</p>
<p>System V 的缺点在于启动过程比较慢，因为它需要逐个启动和停止每个系统服务，这使得启动时间较长。此外，System V 在处理系统服务时需要手动编写脚本，并且难以处理服务之间的依赖关系，这可能导致系统启动失败或服务无法正常运行。由于这些缺点，现代 Linux 发行版逐渐转向使用 Systemd 作为默认初始化系统。</p>
<h2 id="启动流程-2"><a class="markdownIt-Anchor" href="#启动流程-2"></a> 启动流程</h2>
<p>在内核加载完硬件驱动后，内核会主动调用第一个进程 <code>/sbin/init</code>。它最主要的功能是准备软件执行环境：</p>
<ol>
<li>init 取得默认执行等级，执行 <code>/etc/rc.d/rc.sysinit</code> 文件来准备软件执行的操作环境（网络、时区等）；</li>
<li>init 执行 run level 的各个服务的启动（脚本方式）。例如执行等级是 5，则只执行 <code>5:5:wait:/etc/rc.d/rc5</code> 这行：
<ul>
<li>和 rc5 相关的脚本存放在 <code>/etc/rc5.d/</code> 下面，以 Kxx 开头的文件代表执行 stop，以 Sxx 开头代表执行 start 操作。</li>
<li>这些脚本全部是连接文件，连接到 stand alone 服务启动的目录 <code>/etc/init.d/</code>内。</li>
<li>S 或 K 后面两位数字代表执行顺序，数字越小执行越早。</li>
</ul>
</li>
<li>设置好组合键功能和不断电系统 pf、pr 机制。</li>
<li>init 用户自定义脚本 <code>/etc/rc.d/rc.local</code> 配置文件内的程序；</li>
<li>init 执行终端模拟程序 mingetty 来启动 login 进程。</li>
<li>（非必须）以 <code>/etc/X11/perfdm -nodaemon</code> 启动图形界面。</li>
</ol>
<h2 id="启动相关目录-2"><a class="markdownIt-Anchor" href="#启动相关目录-2"></a> 启动相关目录</h2>
<p>开机用到的配置文件：</p>
<ul>
<li>
<p><code>/etc/modprobe.conf</code></p>
<p>定义开机要加载的模块，模块存放于 <code>/etc/sysconfig/modules/</code> 目录下。</p>
</li>
<li>
<p><code>/etc/sysconfig/*</code></p>
<p>服务相关配置，重要的有：</p>
<ul>
<li>authconfig：设置用户身份认证机制。</li>
<li>clock：设置 Linux 主机的时区。</li>
<li>i18n：设置语系。</li>
<li>keyboard &amp; mouse：设置键盘与鼠标样式。</li>
<li>network：设置网络启用、主机名和网关。</li>
<li>network-scripts：设置网卡。</li>
</ul>
</li>
</ul>
<h2 id="init-配置文件"><a class="markdownIt-Anchor" href="#init-配置文件"></a> init 配置文件</h2>
<p>init 通过配置文件 <code>/etc/inittab</code> 规划行动。配置文件每行内容由冒号<code>:</code>分隔四个字段：</p>
<ul>
<li>
<p><strong>设置选项</strong></p>
<p>最多四个字符，代表 init 的主要工作选项，只是一个说明。</p>
</li>
<li>
<p><strong>执行等级</strong></p>
<p>代表该选项在哪些执行等级下面运行，如果是 35 表示在执行等级 3 和 5 都会运行。</p>
</li>
<li>
<p><strong>init 的操作行为</strong></p>
<p>可设置的值有：</p>
<ul>
<li>initdefault：默认执行等级设置值。</li>
<li>sysinit：系统初始化的操作选项。</li>
<li>ctrlaltdel：代表组合快捷键[Ctrl]+[Alt]+[Del]是否可以重新启动的设置。</li>
<li>wait：代表后面设置的命令必须要执行完毕才能继续下面其他操作。</li>
<li>respawn：代表后面的命令可以无限重启，例如 tty1。</li>
</ul>
</li>
<li>
<p><strong>命令选项</strong></p>
<p>执行的命令，通常是一些脚本。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 查询系统信息</title>
    <url>/741506456/</url>
    <content><![CDATA[<h1 id="查看内核版本"><a class="markdownIt-Anchor" href="#查看内核版本"></a> 查看内核版本</h1>
<p>使用命令<code>uname -r</code>可以查看当前内核版本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">uname</span> <span class="token parameter variable">-r</span>
<span class="token number">3.10</span>.0-862.el7.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>如果想要查看更详细的内核信息，可以使用<code>uname -a</code>命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">uname</span> <span class="token parameter variable">-a</span>
Linux 101c7 <span class="token number">3.10</span>.0-862.el7.x86_64 <span class="token comment">#1 SMP Fri Apr 20 16:44:24 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="查看操作系统位数"><a class="markdownIt-Anchor" href="#查看操作系统位数"></a> 查看操作系统位数</h1>
<p>使用<code>getconf</code>命令查看<code>LONG_BIT</code>变量可以得到操作系统位数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ getconf LONG_BIT
<span class="token number">64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="查看发行版本"><a class="markdownIt-Anchor" href="#查看发行版本"></a> 查看发行版本</h1>
<p>在 CentOS 5 中，可以使用命令<code>lsb_release -a</code>查看发行版本。</p>
<p>在 CentOS 7 中，可以查看文件<code>/etc/centos-release</code>的内容来查看版本号：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/centos-release
CentOS Linux release <span class="token number">7.9</span>.2009 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="查看当前时间"><a class="markdownIt-Anchor" href="#查看当前时间"></a> 查看当前时间</h1>
<p>使用<code>date</code>命令可以查看系统中当前的时间和日期：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">date</span>
Sat Sep <span class="token number">11</span> 00:16:31 EDT <span class="token number">2021</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>可以使用<code>systemd-analyze</code>命令查看系统启动时间：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@k8s-m1-pro ~<span class="token punctuation">]</span><span class="token comment"># systemd-analyze</span>
Startup finished <span class="token keyword">in</span> 614ms <span class="token punctuation">(</span>kernel<span class="token punctuation">)</span> + <span class="token number">1</span>.192s <span class="token punctuation">(</span>initrd<span class="token punctuation">)</span> + <span class="token number">27</span>.889s <span class="token punctuation">(</span>userspace<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">29</span>.695s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>其中，kernel 表示内核启动时间，initrd 表示 initramfs 加载时间，userspace 表示用户空间启动时间。</p>
<h1 id="查看内存使用情况"><a class="markdownIt-Anchor" href="#查看内存使用情况"></a> 查看内存使用情况</h1>
<p>使用<code>free</code>命令查看内存使用情况，单位默认为 KB：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">free</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:        <span class="token number">3861280</span>      <span class="token number">283612</span>     <span class="token number">2429740</span>       <span class="token number">11956</span>     <span class="token number">1147928</span>     <span class="token number">3272400</span>
Swap:       <span class="token number">2097148</span>           <span class="token number">0</span>     <span class="token number">2097148</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>一般来说，内存被大量<code>buff/cache</code>了是正常现象，但<code>swap</code>用量超过 20%说明物理内存不足。</p>
<h1 id="系统资源占用信息"><a class="markdownIt-Anchor" href="#系统资源占用信息"></a> 系统资源占用信息</h1>
<p>如果想要了解系统资源的运行情况，可以使用<code>vmstat</code>命令检测 CPU/内存/磁盘 IO 等。该命令常用参数如下：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>使用 inactive/active 替代 buffer/.cache 的内存输出信息</td>
</tr>
<tr>
<td>-f</td>
<td>开机到目前为止系统复制（fork）的进程数</td>
</tr>
<tr>
<td>-s</td>
<td>将一些事件导致的内存变化情况列表说明</td>
</tr>
<tr>
<td>-S</td>
<td>接单位，让显示的数据有单位</td>
</tr>
<tr>
<td>-d</td>
<td>列出磁盘的读写总量统计</td>
</tr>
<tr>
<td>-p</td>
<td>列出分区，可显示该分区的读写总量统计</td>
</tr>
</tbody>
</table>
<p>例如统计目前主机 CPU 状态，每秒一次，共三次:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">vmstat</span> <span class="token number">1</span> <span class="token number">3</span>
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
r  b   swpd   <span class="token function">free</span>   buff  cache   si   so    bi    bo   <span class="token keyword">in</span>   cs us sy <span class="token function">id</span> wa st
<span class="token number">1</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">2434408</span>  <span class="token number">15508</span> <span class="token number">1132464</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>    <span class="token number">4</span>    <span class="token number">6</span>  <span class="token number">0</span>  <span class="token number">0</span> <span class="token number">100</span>  <span class="token number">0</span>  <span class="token number">0</span>
<span class="token number">0</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">2434416</span>  <span class="token number">15508</span> <span class="token number">1132464</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>  <span class="token number">143</span>  <span class="token number">191</span>  <span class="token number">0</span>  <span class="token number">0</span> <span class="token number">100</span>  <span class="token number">0</span>  <span class="token number">0</span>
<span class="token number">0</span>  <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">2434416</span>  <span class="token number">15508</span> <span class="token number">1132464</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>   <span class="token number">87</span>  <span class="token number">113</span>  <span class="token number">0</span>  <span class="token number">0</span> <span class="token number">100</span>  <span class="token number">0</span>  <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面是各字段的说明。</p>
<p>进程（procs）字段统计的数量越多，代表系统越繁忙：</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>就绪或正在运行的进程数</td>
</tr>
<tr>
<td>b</td>
<td>不可中断的睡眠进程数</td>
</tr>
</tbody>
</table>
<p>内存字段（memory）：</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>swpd</td>
<td>使用的虚拟内存大小（单位 KB）</td>
</tr>
<tr>
<td>free</td>
<td>空闲内存大小（单位 KB）</td>
</tr>
<tr>
<td>buff</td>
<td>用于缓存的内存大小（单位 KB）</td>
</tr>
<tr>
<td>cache</td>
<td>用于高速缓存的内存大小（单位 KB）</td>
</tr>
</tbody>
</table>
<p>内存交换空间（swap）数值越大代表内存不太够用：</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>si</td>
<td>从磁盘中交换到内存的块数量</td>
</tr>
<tr>
<td>so</td>
<td>从内存中交换到磁盘的块数量</td>
</tr>
</tbody>
</table>
<p>磁盘读写（io）数值越高代表磁盘越忙碌：</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>bi</td>
<td>从块设备（磁盘）读取的块数</td>
</tr>
<tr>
<td>bo</td>
<td>写入到块设备（磁盘）的块数</td>
</tr>
</tbody>
</table>
<p>系统（system）项目计数越大，代表系统与接口设备的通信越频繁：</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>in</td>
<td>每秒中断次数（包括时钟中断）</td>
</tr>
<tr>
<td>cs</td>
<td>每秒上下文切换次数</td>
</tr>
</tbody>
</table>
<p>CPU 的选项：</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>us</td>
<td>用户空间占用 CPU 时间的百分比</td>
</tr>
<tr>
<td>sy</td>
<td>内核空间占用 CPU 时间的百分比</td>
</tr>
<tr>
<td>id</td>
<td>空闲 CPU 时间的百分比</td>
</tr>
<tr>
<td>wa</td>
<td>等待 I/O 操作占用 CPU 时间的百分比</td>
</tr>
<tr>
<td>st</td>
<td>用于运行虚拟机的 CPU 时间的百分比</td>
</tr>
</tbody>
</table>
<p>例如查看磁盘读写状态：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">vmstat</span> <span class="token parameter variable">-d</span>
disk- ------------reads------------ ------------writes----------- -----IO------
       total merged sectors      ms  total merged sectors      ms    cur    sec
sdb    <span class="token number">11640</span>  <span class="token number">23419</span> <span class="token number">1679403</span>    <span class="token number">3097</span>   <span class="token number">3013</span> <span class="token number">143194</span>  <span class="token number">714969</span>    <span class="token number">2367</span>      <span class="token number">0</span>      <span class="token number">2</span>
sda    <span class="token number">13672</span>     <span class="token number">28</span> <span class="token number">1219051</span>    <span class="token number">6501</span>  <span class="token number">22246</span>   <span class="token number">3488</span> <span class="token number">1921401</span>   <span class="token number">17945</span>      <span class="token number">0</span>     <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="查询内存中内容"><a class="markdownIt-Anchor" href="#查询内存中内容"></a> 查询内存中内容</h1>
<p>内存中的数据都写入到目录<code>/proc/*</code>中（不占用实际硬盘空间）。查看目录<code>/proc</code>中的内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ ll /proc <span class="token operator">|</span> <span class="token function">head</span> 
total <span class="token number">0</span>
dr-xr-xr-x.  <span class="token number">9</span> root    root                  <span class="token number">0</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:08 <span class="token number">1</span>
dr-xr-xr-x.  <span class="token number">9</span> root    root                  <span class="token number">0</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:08 <span class="token number">10</span>
dr-xr-xr-x.  <span class="token number">9</span> root    root                  <span class="token number">0</span> Sep <span class="token number">14</span> 00:31 <span class="token number">10025</span>
dr-xr-xr-x.  <span class="token number">9</span> root    root                  <span class="token number">0</span> Sep <span class="token number">14</span> 00:31 <span class="token number">10026</span>
dr-xr-xr-x.  <span class="token number">9</span> root    root                  <span class="token number">0</span> Sep <span class="token number">14</span> 00:31 <span class="token number">10139</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到，各个进程的 PID 都是以目录的形式存在于 <code>/proc</code> 中。</p>
<p>进一步查看进程在内存中写入的内容，以 PID=1 的 init 程序为例：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ ll /proc/1
total <span class="token number">0</span>
dr-xr-xr-x. <span class="token number">2</span> root root <span class="token number">0</span> Sep <span class="token number">10</span> 01:44 attr
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">10</span> 01:44 autogroup
-r--------. <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">10</span> 01:44 auxv
-r--r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:08 cgroup
--w-------. <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">10</span> 01:44 clear_refs
-r--r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:08 cmdline
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:08 <span class="token function">comm</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">10</span> 01:44 coredump_filter
-r--r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">10</span> 01:44 cpuset
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">0</span> Sep <span class="token number">10</span> 01:44 cwd -<span class="token operator">></span> /
-r--------. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:08 environ
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">0</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:08 exe -<span class="token operator">></span> /usr/lib/systemd/systemd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其中 <code>cmdline</code> 定义了 init 被启动的命令串，<code>environ</code> 定义了这个进程的环境变量。</p>
<p>以下是在 <code>/proc</code> 目录下常见文件的内容：</p>
<table>
<thead>
<tr>
<th><strong>文件名</strong></th>
<th><strong>文件内容</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>cmdline</td>
<td>加载 kernel 时所执行的相关参数</td>
</tr>
<tr>
<td>cpuinfo</td>
<td>本机 CPU 的相关信息，包括频率、类型和运算功能等</td>
</tr>
<tr>
<td>devices</td>
<td>记录各个主要设备的主要设备代号，与 mknod 有关</td>
</tr>
<tr>
<td>filesystems</td>
<td>目前系统已经加载的文件系统</td>
</tr>
<tr>
<td>interrupts</td>
<td>目前系统上的 IRQ 分配状态</td>
</tr>
<tr>
<td>ioports</td>
<td>目前系统上各个设备所配置的 I/O 地址</td>
</tr>
<tr>
<td>kcore</td>
<td>内存的大小</td>
</tr>
<tr>
<td>loadavg</td>
<td>系统负载情况</td>
</tr>
<tr>
<td>meminfo</td>
<td>内存信息</td>
</tr>
<tr>
<td>modules</td>
<td>已经加载的模块列表，主要是驱动程序</td>
</tr>
<tr>
<td>mounts</td>
<td>系统已挂载的数据</td>
</tr>
<tr>
<td>swaps</td>
<td>系统加载的内存使用的分区记录</td>
</tr>
<tr>
<td>partitions</td>
<td>记录系统分区信息</td>
</tr>
<tr>
<td>pci</td>
<td>在 PCI 总线上每个设备的详细情况，可用 lspci 查询</td>
</tr>
<tr>
<td>uptime</td>
<td>系统运行时长记录</td>
</tr>
<tr>
<td>version</td>
<td>内核版本</td>
</tr>
<tr>
<td>bus/*</td>
<td>一些总线设备，包括 USB 记录设备</td>
</tr>
</tbody>
</table>
<p>对 <code>/proc</code> 下的文件进行修改后，修改将立即生效。</p>
<h1 id="查询使用中的文件"><a class="markdownIt-Anchor" href="#查询使用中的文件"></a> 查询使用中的文件</h1>
<p>查询文件正在被什么程序使用可以使用 <code>fuser</code>命令查询（使用 yum install psmisc 安装）。可用参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-u</td>
<td>列出进程所有者</td>
</tr>
<tr>
<td>-m</td>
<td>列出占用文件系统的进程</td>
</tr>
<tr>
<td>-v</td>
<td>列出文件与程序还有命令的完整相关性</td>
</tr>
<tr>
<td>-k</td>
<td>找出使用文件的 PID，并试图强制结束程序</td>
</tr>
<tr>
<td>-i</td>
<td>结束程序前询问用户</td>
</tr>
</tbody>
</table>
<p>例如找到当前目录正在使用它的 PID/所属账户/权限：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">fuser</span> <span class="token parameter variable">-uv</span> <span class="token builtin class-name">.</span>
            <span class="token environment constant">USER</span>      PID   ACCESS COMMAND
/root/bin:  root      <span class="token number">40090</span> <span class="token punctuation">..</span>c<span class="token punctuation">..</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span>bash
            root      <span class="token number">40855</span> <span class="token punctuation">..</span>c<span class="token punctuation">..</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span>tail<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果显示有两个 PID 为 40090 和 40855 的程序在使用该目录，程序所属为 root，命令是 <code>bash</code> 和 <code>tail</code>。可以直接使用<code>fuser -k</code>命令来终止使用该目录的进程：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ <span class="token function">fuser</span> <span class="token parameter variable">-k</span> /root/bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ACCESS 选项代表的意义为：</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>此进程在当前目录下（非子目录）</td>
</tr>
<tr>
<td>e</td>
<td>可被触发为执行状态</td>
</tr>
<tr>
<td>f</td>
<td>是一个被打开的文件</td>
</tr>
<tr>
<td>r</td>
<td>代表顶层目录</td>
</tr>
<tr>
<td>F</td>
<td>该文件被打开了，不过在等待回应中</td>
</tr>
<tr>
<td>m</td>
<td>可能为分享的动态函数库</td>
</tr>
</tbody>
</table>
<h1 id="查询程序打开的文件"><a class="markdownIt-Anchor" href="#查询程序打开的文件"></a> 查询程序打开的文件</h1>
<p>要查询某个程序正在使用的文件，可以使用 <code>lsof</code> 命令。命令参数如下：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>多项数据需要同时成立才显示出结果时</td>
</tr>
<tr>
<td>-p</td>
<td>指定进程 PID</td>
</tr>
<tr>
<td>-U</td>
<td>仅列出 Unix like 系统的 socket 文件类型</td>
</tr>
<tr>
<td>-u</td>
<td>接 username，列出该用户相关进程所打开的文件</td>
</tr>
<tr>
<td>+d</td>
<td>接目录，找出某个目录下面已经被打开的文件</td>
</tr>
</tbody>
</table>
<p>例如，列出关于 root 的所有进程打开的 socket 文件（-a 表示逻辑与，限定了必须为 root 用户和 socket 文件）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">lsof</span> <span class="token parameter variable">-u</span> root <span class="token parameter variable">-a</span> <span class="token parameter variable">-U</span>
COMMAND     PID <span class="token environment constant">USER</span>   FD   TYPE             DEVICE SIZE/OFF   NODE NAME
systemd       <span class="token number">1</span> root   12u  unix 0xffff9ac438950000      0t0  <span class="token number">20565</span> /run/systemd/private
systemd       <span class="token number">1</span> root   13u  unix 0xffff9ac438b14400      0t0 <span class="token number">605204</span> socket
systemd       <span class="token number">1</span> root   18u  unix 0xffff9ac4b5ec8440      0t0     <span class="token number">29</span> /run/systemd/notify<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>例如，查询属于 root 的 <code>tail</code> 命令所打开的文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">lsof</span> <span class="token parameter variable">-u</span> root <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">tail</span>
<span class="token function">tail</span>       <span class="token number">40855</span> root  cwd       DIR      <span class="token number">253,0</span>       <span class="token number">246</span>   <span class="token number">33607964</span> /root/bin
<span class="token function">tail</span>       <span class="token number">40855</span> root  rtd       DIR      <span class="token number">253,0</span>       <span class="token number">253</span>         <span class="token number">64</span> /
<span class="token function">tail</span>       <span class="token number">40855</span> root  txt       REG      <span class="token number">253,0</span>     <span class="token number">66816</span>   <span class="token number">50333754</span> /usr/bin/tail
<span class="token function">tail</span>       <span class="token number">40855</span> root    0w      CHR        <span class="token number">1,3</span>       0t0       <span class="token number">1028</span> /dev/null
<span class="token function">tail</span>       <span class="token number">40855</span> root    1w      REG      <span class="token number">253,0</span>       <span class="token number">236</span>   <span class="token number">33607951</span> /root/bin/nomarl.log
<span class="token function">tail</span>       <span class="token number">40855</span> root    2w      REG      <span class="token number">253,0</span>        <span class="token number">54</span>   <span class="token number">33607959</span> /root/bin/error.log
<span class="token function">tail</span>       <span class="token number">40855</span> root    3r      REG      <span class="token number">253,0</span>       <span class="token number">236</span>   <span class="token number">33607979</span> /root/bin/sh01.sh
<span class="token function">tail</span>       <span class="token number">40855</span> root    4r  a_inode      <span class="token number">0,10</span>         <span class="token number">0</span>       <span class="token number">8534</span> inotify<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>显示结果字段含义如下：</p>
<ul>
<li>COMMAND：正在运行的命令名前 9 个字符。</li>
<li>PID：进程的 PID。</li>
<li>USER：进程属主的登录名。</li>
<li>FD：文件描述符号以及访问类型。r 读，w 写，u 代表读写。</li>
<li>TYPE：文件的类型。CHR 字符型，BLK 块型，DIR 目录，REG 代表常规文件。</li>
<li>DEVICE：设备的设备号。</li>
<li>SIZE：文件的大小。</li>
<li>NODE：本地文件的 inode 号。</li>
<li>NAME：文件名。</li>
</ul>
<h1 id="查询硬件信息"><a class="markdownIt-Anchor" href="#查询硬件信息"></a> 查询硬件信息</h1>
<p>使用 <code>dmidecode</code> 命令可以查询当前计算机的硬件配置。主要查询的项目有：1（主板信息）、4（CPU 信息）、9（插槽信息）、17（内存信息）。例如查看 CPU 信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ dmidecode <span class="token parameter variable">-t</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">50</span>
<span class="token comment"># dmidecode 3.2</span>
Getting SMBIOS data from sysfs.
SMBIOS <span class="token number">2.7</span> present.

Handle 0x0004, DMI <span class="token builtin class-name">type</span> <span class="token number">4</span>, <span class="token number">42</span> bytes
Processor Information
        Socket Designation: CPU <span class="token comment">#000</span>
        Type: Central Processor
        Family: Unknown
        Manufacturer: AuthenticAMD
        ID: <span class="token number">82</span> 0F <span class="token number">80</span> 00 FF FB 8B <span class="token number">17</span>
        Version: AMD Ryzen Threadripper 2990WX <span class="token number">32</span>-Core Processor
        Voltage: <span class="token number">3.3</span> V
        External Clock: Unknown
        Max Speed: <span class="token number">30000</span> MHz
        Current Speed: <span class="token number">3200</span> MHz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以使用<code>dmesg</code>来输出所有的内核运行时的记录日志：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">less</span>
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Initializing cgroup subsys cpuset
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Initializing cgroup subsys cpu
<span class="token punctuation">[</span>    <span class="token number">0.000000</span><span class="token punctuation">]</span> Initializing cgroup subsys cpuacct<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>配合 <code>grep ATA</code>过滤掉无关的信息，查询 SATA 接口硬盘信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@s55 ~<span class="token punctuation">]</span>$ <span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> ATA
<span class="token punctuation">[</span>    <span class="token number">3.367870</span><span class="token punctuation">]</span> ata6.00: ATA-10: HGST HUS722T1TALA604, RAGNWA09, max UDMA/133
<span class="token punctuation">[</span>    <span class="token number">3.369145</span><span class="token punctuation">]</span> ata5.00: ATA-10: HGST HUS722T1TALA604, RAGNWA09, max UDMA/133<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>以下是一些常用的 Linux 系统硬件信息查询命令：</p>
<ul>
<li><code>gdisk</code>/<code>fdisk</code>：查询分区信息。</li>
<li><code>vmstat</code>：分析系统状态。</li>
<li><code>lscpu</code>：查询 CPU 相关信息。</li>
<li><code>lspci</code>：查询 PCI 接口设备。</li>
<li><code>lsusb</code>：查询 USB 接口状态。</li>
<li><code>iostat</code>：查询系统 I/O 状态。</li>
<li><code>smartctl</code>：查询硬盘 S.M.A.R.T 信息。</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 工作控制</title>
    <url>/517799084/</url>
    <content><![CDATA[<h1 id="工作控制"><a class="markdownIt-Anchor" href="#工作控制"></a> 工作控制</h1>
<p>工作控制是一种由内核支持、shell 实现的功能，允许用户同时运行多个进程，其中一个进程在前台（foreground），其他进程在后台（background）运行。用户可以在前台和后台之间切换、挂起和显示进程状态。</p>
<p>将一个进程放入后台运行，该进程必须不需要与用户交互，且不能使用 Ctrl+c 来终止运行。</p>
<h1 id="后台运行"><a class="markdownIt-Anchor" href="#后台运行"></a> 后台运行</h1>
<p>在命令后加入空格和&amp;符号即可将进程放入后台运行，这也被称为异步进程（Asynchronous Process）运行程序：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> <span class="token number">1</span>.iso <span class="token parameter variable">-C</span> lost+found/ <span class="token operator">&amp;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">36961</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>中括号内的数字为工作号码（job number），后续数字为工作在系统中的 PID。</p>
<p>后台工作完成后会给前台发信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>+  Done                    <span class="token function">cp</span> <span class="token parameter variable">-i</span> <span class="token number">1</span>.iso <span class="token number">1</span>.copy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>后台运行的工作如果有标准输出（stdout）和标准错误输出（stderr），依然会实时输出到屏幕。可以在执行时将这些数据重定向，以免影响前台工作。</p>
<h1 id="后台暂停"><a class="markdownIt-Anchor" href="#后台暂停"></a> 后台暂停</h1>
<p>使用 Ctrl+z 把当前的前台工作停止放到后台：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">tail</span> <span class="token parameter variable">-f</span> root.txt 
-rw-r--r--.  <span class="token number">1</span> root root         <span class="token number">0</span> Sep <span class="token number">11</span> <span class="token number">10</span>:11 list_error.txt
-rw-r--r--.  <span class="token number">1</span> root root        <span class="token number">54</span> Sep <span class="token number">11</span> <span class="token number">10</span>:16 list.txt
^Z
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>+  Stopped                 <span class="token function">tail</span> <span class="token parameter variable">-f</span> root.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>数字 2 表示这是后台中的第 2 个工作，加号 + 代表最近一个被丢进后台的工作。</p>
<h1 id="后台状态"><a class="markdownIt-Anchor" href="#后台状态"></a> 后台状态</h1>
<p>使用 <code>jobs</code> 命令查看当前后台工作状态。可用参数如下：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-l</td>
<td>除了列出 job number 与命令外，同时列出 PID</td>
</tr>
<tr>
<td>-r</td>
<td>仅列出后台运行的工作</td>
</tr>
<tr>
<td>-s</td>
<td>仅列出后台暂停的工作</td>
</tr>
</tbody>
</table>
<p>使用 <code>-l</code> 参数查看当前后台工作状态与工作 PID：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">jobs</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>- <span class="token number">37687</span> Stopped                 <span class="token function">tail</span> <span class="token parameter variable">-f</span> root1.txt
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>+ <span class="token number">37698</span> Stopped                 <span class="token function">tail</span> <span class="token parameter variable">-f</span> root.txt
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>  <span class="token number">37916</span> Running                 <span class="token function">tail</span> <span class="token parameter variable">-f</span> list_error.txt <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>加号 <code>+</code> 代表最近一个被放置到后台的工作，减号 <code>-</code> 代表倒数第二个被放置到后台中的工作，其他工作没有符号。</p>
<h1 id="后台转前台"><a class="markdownIt-Anchor" href="#后台转前台"></a> 后台转前台</h1>
<p>使用 <code>fg</code> 命令将后台工作转到前台处理。例如将 3 号工作取出到前台：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">fg</span> %3
<span class="token function">tail</span> <span class="token parameter variable">-f</span> list_error.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="后台转运行"><a class="markdownIt-Anchor" href="#后台转运行"></a> 后台转运行</h1>
<p>使用 <code>bg</code> 命令启动后台暂停中工作为后台运行。例如将后台暂停的 3 号工作转为后台运行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">bg</span> <span class="token variable">$3</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>+ <span class="token function">tail</span> <span class="token parameter variable">-f</span> list_error.txt <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="脱机运行"><a class="markdownIt-Anchor" href="#脱机运行"></a> 脱机运行</h2>
<p>由于登陆后在 shell 中运行的命令父进程是 bash，所以当 shell 会话中断时，后台的程序也会跟着被中断。</p>
<p>想要保持程序一直运行与终端状态脱离关系，可以使用 <code>nohup</code> 命令来处理。命令格式为：<code>nohup [命令与参数] &amp;</code></p>
<p>例如保持 <code>sh13.sh</code> 脚本脱机运行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 bin<span class="token punctuation">]</span>$ <span class="token function">nohup</span> ./sh13.sh <span class="token operator">&amp;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">40062</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>注销用户后重新登录，使用<code>ps</code>命令查询：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> sh13
root      <span class="token number">40062</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span> <span class="token number">113284</span>  <span class="token number">1184</span> ?        S    03:53   <span class="token number">0</span>:00 /bin/bash ./sh13.sh
root      <span class="token number">40219</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span> <span class="token number">112812</span>   <span class="token number">968</span> pts/0    S+   03:55   <span class="token number">0</span>:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto sh13<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>可以看到程序（PID=40062）依然在运行中，可以使用 <code>kill</code> 命令来终止运行。</p>
<p>程序的输出会被重定向到 <code>~/nohup.out</code> 文件。也可以手动指定 <code>1&gt;</code> 和 <code>2&gt;</code> 到其他文件。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 程序和进程</title>
    <url>/630034191/</url>
    <content><![CDATA[<h1 id="进程与程序"><a class="markdownIt-Anchor" href="#进程与程序"></a> 进程与程序</h1>
<p>程序（Program）是可执行的二进制文件。</p>
<p>当触发执行程序动作后，程序内容及程序数据会加载到内存中，成为一个运行中的程序，即进程（Process）。</p>
<p>系统为这个进程分配一个 ID，称为 PID（Program ID）。同时，根据触发这个进程的用户及相关属性关系，为这个 PID 设置一组有效的权限。</p>
<h1 id="子进程与父进程"><a class="markdownIt-Anchor" href="#子进程与父进程"></a> 子进程与父进程</h1>
<p>登录系统后，会获得一个 bash 的 shell。通过 bash 提供的接口执行另一个命令，如 <code>vim</code>，它也会被分配一个 PID。此时，原本的 bash 就是 <code>vim</code> 的父进程。父进程的 PID 可以用 PPID（Parent ID）表示。</p>
<p>通常，子进程会继承父进程的相关权限和环境变量。</p>
<p>例如，在 bash 中执行 <code>bash</code>，再用<code>ps -l</code>命令查看：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span>
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">ps</span> <span class="token parameter variable">-l</span>
F S   <span class="token environment constant">UID</span>    PID   <span class="token environment constant">PPID</span>  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
<span class="token number">4</span> S     <span class="token number">0</span>   <span class="token number">5713</span>   <span class="token number">5709</span>  <span class="token number">0</span>  <span class="token number">80</span>   <span class="token number">0</span> - <span class="token number">28920</span> do_wai pts/0    00:00:00 <span class="token function">bash</span>
<span class="token number">4</span> S     <span class="token number">0</span>  <span class="token number">35555</span>   <span class="token number">5713</span>  <span class="token number">0</span>  <span class="token number">80</span>   <span class="token number">0</span> - <span class="token number">28919</span> do_wai pts/0    00:00:00 <span class="token function">bash</span>
<span class="token number">0</span> R     <span class="token number">0</span>  <span class="token number">35570</span>  <span class="token number">35555</span>  <span class="token number">0</span>  <span class="token number">80</span>   <span class="token number">0</span> - <span class="token number">38332</span> -      pts/0    00:00:00 <span class="token function">ps</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到第一个 bash 的 PID 5517 是第二个 bash 的 PPID。</p>
<h1 id="过程调用的流程"><a class="markdownIt-Anchor" href="#过程调用的流程"></a> 过程调用的流程</h1>
<p>父进程和子进程之间的互相调用过程通常称为 fork-and-exec 的流程。进程都会通过父进程以复制（fork）的方式产生一个一模一样的子进程，然后被复制的子进程再以 exec 的方式执行实际要进行的进程，最终成为一个子进程的存在。</p>
<p>其过程从上往下执行如下示意：</p>
<table>
<thead>
<tr>
<th><strong>阶段</strong></th>
<th><strong>状态</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>父进程</td>
<td>PID=x，程序=a</td>
</tr>
<tr>
<td>中间暂存进程</td>
<td>PID=y，程序=a，PPID=x</td>
</tr>
<tr>
<td>子进程</td>
<td>PID=y，程序=b，PPID=x</td>
</tr>
</tbody>
</table>
<h1 id="内部程序沟通"><a class="markdownIt-Anchor" href="#内部程序沟通"></a> 内部程序沟通</h1>
<p>在系统内，许多进程需要互相交换信息。除了通过文件进行沟通，还包括共享内存（Shared Memory）、消息队列（Message Queues）、管道（Pipe）等方式，统称为内部程序沟通（Interprocess Communication）。可以用命令 <code>ipcs</code> 观察沟通状态：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ ipcs

 Message Queues 
key        msqid      owner      perms      used-bytes   messages    

 Shared Memory Segments 
key        shmid      owner      perms      bytes      nattch     status      

 Semaphore Arrays 
key        semid      owner      perms      nsems   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以通过 <code>ipcrm</code> 命令将看到的 interprocess 删除。</p>
<h1 id="多用户与多任务环境"><a class="markdownIt-Anchor" href="#多用户与多任务环境"></a> 多用户与多任务环境</h1>
<p>多用户系统也叫分时系统（Time-Share System），指多个用户可以在同一时间使用计算机系统。与 Linux 相比，Windows 系统是单用户系统。</p>
<p>多任务是指 Linux 可以同时执行几个任务，它可以在还未执行完一个任务时又执行另一项任务。</p>
<p>每个用户权限不同，所以登录后获得的 shell 的 PID 不同。而 CPU 速度 1GHz 代表 CPU 每秒可以运行 10<sup>9</sup>次命令，每个工作都占用 CPU 的几个命令次数。Linux 可以让 CPU 在各个进程间进行切换。所以实际上，所谓多任务处理是 CPU 快速地执行多个任务，看上去就像它们同时被执行一样。CPU 切换进程的工作与这些工作进入到 CPU 运行的调度会影响到系统的整体性能。由于 CPU 性能出众，所以可以支持多个用户同时登录运行不同程序，这就是多用户与多任务环境。</p>
<h1 id="僵尸进程"><a class="markdownIt-Anchor" href="#僵尸进程"></a> 僵尸进程</h1>
<p>造成僵尸进程的原因是该进程应该已经执行完毕或因故应该要终止时，该进程的父进程很可能已经死亡，无法完整将该进程结束掉，而造成那个进程一直滞留在内存。</p>
<p>使用 <code>ps</code> 命令查看进程时，如果发现某个进程的 CMD 后面有 <code>&lt;defunct&gt;</code>，就代表该进程是僵尸进程。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 工作调度</title>
    <url>/3847284551/</url>
    <content><![CDATA[<h1 id="系统例行性工作"><a class="markdownIt-Anchor" href="#系统例行性工作"></a> 系统例行性工作</h1>
<p>在 Linux 系统常见的例行性任务有：</p>
<ul>
<li>
<p><strong>进行日志文件的轮替</strong></p>
<p>Linux 会主动将系统所发生的各种事件都记录到日志文件，日志轮替会不时检查，将旧日志与新日志分别存放。</p>
</li>
<li>
<p><strong>日志文件分析</strong></p>
<p>CentOS 提供 <code>logwatch</code> 来主动分析日志信息。</p>
</li>
<li>
<p><strong>更新 locate 数据库</strong></p>
<p>默认每天都更新一次存放在 <code>/var/lib/mlocate</code> 中的数据库。</p>
</li>
<li>
<p><strong>更新 RPM 软件数据库</strong></p>
<p>由于系统中软件经常变更，需要系统帮我们将文件名做个排序记录，生成 RPM 数据库。</p>
</li>
<li>
<p><strong>删除临时文件</strong></p>
<p>系统通过调用 <code>tmpwatch</code> 命令来删除软件运行时所产生的不再需要的临时文件。</p>
</li>
<li>
<p><strong>与网络服务有关的分析行为</strong></p>
<p>如果安装了 WWW 服务器，系统会主动分析软件的入口文件。</p>
</li>
</ul>
<h1 id="单次工作调度"><a class="markdownIt-Anchor" href="#单次工作调度"></a> 单次工作调度</h1>
<p>单次工作调度任务主要由 atd 服务提供，使用 <code>at</code> 命令来生成所需要运行的工作，再将工作写入 <code>/var/spool/at</code> 目录内。</p>
<p>可以运行 <code>at</code> 的账号记录在 <code>/etc/at.allow</code> 中，禁止运行 <code>at</code> 的账号记录在 <code>/etc/at.deny</code> 中。如果两个文件都不存在，则只有 root 可以使用 <code>at</code> 命令。如果账号在两个文件中都有记录，以 <code>/etc/at.allow</code> 优先。</p>
<p>可以使用 <code>service</code> 命令查询启动 <code>atd</code> 服务：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">service</span> atd status
Redirecting to /bin/systemctl status atd.service
a—? atd.service - Job spooling tools
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/atd.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>
   Active: inactive <span class="token punctuation">(</span>dead<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">service</span> atd start
Redirecting to /bin/systemctl start atd.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>设置开机启动使用 <code>chkconfig</code> 配置或 <code>systemctl enable atd</code> 开启：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">chkconfig</span> atd on
Note: Forwarding request to <span class="token string">'systemctl enable atd.service'</span><span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>at</code> 命令的基本语法为 <code>at [-mldv] 时间</code>，其中可以使用的参数如下：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-m</td>
<td>当 <code>at</code> 的工作完成后，即使没有输出信息，也会发送邮件通知用户工作已完成</td>
</tr>
<tr>
<td>-l</td>
<td>相当于 <code>atq</code>，列出目前系统上所有该用户的 <code>at</code> 调度</td>
</tr>
<tr>
<td>-d</td>
<td>相当于 <code>atrm</code>，可以取消一个在 <code>at</code> 调度中的任务</td>
</tr>
<tr>
<td>-v</td>
<td>可以使用较明显的时间格式列出 <code>at</code> 调度中的任务列表</td>
</tr>
<tr>
<td>-c</td>
<td>可以列出后面接的该项工作的实际命令内容</td>
</tr>
</tbody>
</table>
<p><code>at</code> 命令还支持多种可用的时间格式，包括：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>说明（范例）</th>
</tr>
</thead>
<tbody>
<tr>
<td>HH:MM</td>
<td>在今天 HH:MM进行，若超时改在明天（15:00）</td>
</tr>
<tr>
<td>HH:MM YYYY-MM-DD</td>
<td>规定在特定日期和时间执行（16:32 2043-04-01）</td>
</tr>
<tr>
<td>HH:MM[am|pm] [M] [D]</td>
<td>规定在特定日期和时间进行（01pm March 23）</td>
</tr>
<tr>
<td>HH:MM[am|pm] + n [minutes|hours|days|weeks]</td>
<td>在某个时间点加上指定时间后进行（04am + 2 days）</td>
</tr>
</tbody>
</table>
<p>例如，设置在 1 分钟后运行 <code>ls /root</code> 命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ at now + 1minutes
at<span class="token operator">></span> <span class="token function">ls</span> /root
at<span class="token operator">></span> <span class="token operator">&lt;</span>EOT<span class="token operator">></span>
job <span class="token number">1</span> at Tue Sep <span class="token number">14</span> 00:22:00 <span class="token number">2021</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>工作内容输入完毕后，使用 <code>Ctrl+d</code> 结束，系统会出现一行提示信息。</p>
<p>查询第 3 号任务：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ at <span class="token parameter variable">-c</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>at</code> 执行命令产生的 <code>stdout</code> 和 <code>stderr</code> 会传送到执行者的邮箱。如果想在终端看到输出，可以重定向输出到 <code>/dev/tty1</code>（或 <code>pts/0</code>）。</p>
<p>删除一个 <code>at</code> 调度中的任务：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ at <span class="token parameter variable">-l</span>
<span class="token number">7</span>       Tue Sep <span class="token number">14</span> <span class="token number">18</span>:15:00 <span class="token number">2021</span> a root
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ at <span class="token parameter variable">-d</span> <span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>可以使用 <code>batch</code> 命令来控制在 CPU 工作负载小于 0.8 时执行。否则暂缓执行。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ batch
at<span class="token operator">></span> <span class="token function">sync</span>
at<span class="token operator">></span> <span class="token operator">&lt;</span>EOT<span class="token operator">></span>
job <span class="token number">9</span> at Tue Sep <span class="token number">14</span> 00:58:00 <span class="token number">2021</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="循环工作调度"><a class="markdownIt-Anchor" href="#循环工作调度"></a> 循环工作调度</h1>
<p>循环执行例行工作调度由 <code>crond</code> 这个系统服务控制。</p>
<p>调用 <code>cron</code> 的用户限制和 <code>at</code> 一样保存在文件中。允许账户保存在 <code>/etc/cron.allow</code>，禁止用户保存在 <code>/etc/cron.deny</code>。系统默认保留 <code>cron.deny</code>，也就是除了 <code>cron.deny</code> 中定义的用户外均可执行 <code>cron</code>。</p>
<p>用户使用 <code>crontab</code> 命令新建工作调度后，工作被记录到 <code>/var/spool/cron</code> 里面，而且以账号为分类分别建立文件。</p>
<p><code>cron</code> 执行的每一项工作都会被记录到 <code>/var/log/cron</code> 这个日志文件中。</p>
<p>命令语法: <code>crontab [-u username] [-l|-e|-r]</code></p>
<p>使用参数:</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-u</td>
<td>只有 root 可以调用，帮助其他用户新建/删除 <code>crontab</code> 工作调度</td>
</tr>
<tr>
<td>-e</td>
<td>编辑 <code>crontab</code> 的工作内容</td>
</tr>
<tr>
<td>-l</td>
<td>查询 <code>crontab</code> 的工作内容</td>
</tr>
<tr>
<td>-r</td>
<td>删除所有的 <code>crontab</code> 的工作内容</td>
</tr>
</tbody>
</table>
<p>例如每天 13:15 执行一次清空命令历史记录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">crontab</span> <span class="token parameter variable">-e</span>
no <span class="token function">crontab</span> <span class="token keyword">for</span> root - using an empty one
<span class="token number">15</span> <span class="token number">13</span> * * * <span class="token function">history</span> <span class="token parameter variable">-c</span>
<span class="token string">"/tmp/crontab.0bZmP6"</span> 1L, 22C written
crontab: installing new <span class="token function">crontab</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>编辑 <code>cron</code> 时分为 6 个字段设置为：<code>分钟 小时 日期 月份 周 命令</code></p>
<p>周时间设置为 0 等同于 7 表示星期天。</p>
<p>设定时间时可用的一些特殊字符说明如下：</p>
<table>
<thead>
<tr>
<th>特殊字符</th>
<th>代表意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>*（星号）</td>
<td>代表任何时刻都接受的意思。例如日、月、周都是 *，代表无论何日的 13:15 都会执行</td>
</tr>
<tr>
<td>,（逗号）</td>
<td>代表分隔时段的意思，例如在小时字段设置 4,11,15 代表执行时间为 4 点、11 点和 15 点</td>
</tr>
<tr>
<td>-（减号）</td>
<td>代表一段时间范围，例如在小时字段设置 8-12 代表执行时间为 8 点到 12 点每小时执行一次</td>
</tr>
<tr>
<td>/n（斜线）</td>
<td>n 代表数字，即是每隔 n 单位间隔的意思。例如在分钟字段设置 <code>*/5</code> 代表每五分钟执行一次</td>
</tr>
</tbody>
</table>
<p><code>cron</code> 不可以使用“几月几号且为星期几”的模式工作，也就是在日、月、周都设置的情况下会报错</p>
<p>例如，每天在早上 7 点和下午 8 点执行 <code>/root/backup.sh</code> 备份脚本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">crontab</span> <span class="token parameter variable">-e</span>
*  <span class="token number">7,20</span> * * * <span class="token function">bash</span> /root/backup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="系统例行调度"><a class="markdownIt-Anchor" href="#系统例行调度"></a> 系统例行调度</h1>
<p>系统例行性任务保存在 <code>/etc/crontab</code> 文件中。<code>cron</code> 每分钟会去读取一次 <code>/etc/crontab</code> 和 <code>/var/spool/cron</code>，所以直接编辑完 <code>/etc/crontab</code> 文件后保存退出即可添加系统调度工作。</p>
<p>查看 <code>/etc/crontab</code> 文件内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/crontab
<span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/bash
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/sbin:/bin:/usr/sbin:/usr/bin
<span class="token assign-left variable">MAILTO</span><span class="token operator">=</span>root

<span class="token comment"># For details see man 4 crontabs</span>
<span class="token comment"># Example of job definition:</span>
<span class="token comment"># .---------------- minute (0 - 59)</span>
<span class="token comment"># |  .------------- hour (0 - 23)</span>
<span class="token comment"># |  |  .---------- day of month (1 - 31)</span>
<span class="token comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="token comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="token comment"># |  |  |  |  |</span>
<span class="token comment"># *  *  *  *  * user-name  command to be executed</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><strong>MAILTO</strong></p>
<p>表示将 <code>stdout</code> 和 <code>stderr</code> 用邮件发送给指定用户或指定邮箱。</p>
</li>
<li>
<p><strong>user-name</strong></p>
<p>执行命令使用的用户身份，例如 <code>root</code>。</p>
</li>
<li>
<p><strong>command to be executed</strong></p>
<p>除了直接运行命令外，还可以以目录为目标批量运行脚本。例如 <code>run-parts /etc/cron.hourly</code>，意思代表将 <code>/etc/cron.hourly/</code> 目录下的所有脚本执行。</p>
</li>
</ul>
<h1 id="唤醒停机期间的工作任务"><a class="markdownIt-Anchor" href="#唤醒停机期间的工作任务"></a> 唤醒停机期间的工作任务</h1>
<p>如果在<code>crond</code>设定的任务运行时段系统已关机，那么需要借助<code>anacron</code>将关机期间系统<code>crontab</code>运行。</p>
<p><code>anacron</code>以小时为单位或在开机后立刻进行检查，将停机期间没有进行的<code>crontab</code>任务执行一遍。</p>
<p>一般不用修改<code>anacron</code>的默认设置，需要手动执行<code>anacron</code>命令语法如下：</p>
<p><code>anacron [-sfn] [job]..</code></p>
<p><code>anacron -u [job]..</code></p>
<p>参数说明如下：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-s</td>
<td>开始连续执行各项工作，会依据时间记录文件的数据判断是否进行</td>
</tr>
<tr>
<td>-f</td>
<td>强制进行，不判断事件记录文件的时间戳</td>
</tr>
<tr>
<td>-n</td>
<td>立刻进行未进行的任务，而不延迟等待时间</td>
</tr>
<tr>
<td>-u</td>
<td>仅更新事件记录文件的时间戳，不进行任何工作</td>
</tr>
<tr>
<td>job</td>
<td>由<code>/etc/anacrontab</code>定义的各项工作名称</td>
</tr>
</tbody>
</table>
<p>查看<code>/etc/anacrontab</code>文件的内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/anacrontab 
<span class="token comment"># /etc/anacrontab: configuration file for anacron</span>
<span class="token comment"># See anacron(8) and anacrontab(5) for details.</span>
<span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/sh
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/sbin:/bin:/usr/sbin:/usr/bin
<span class="token assign-left variable">MAILTO</span><span class="token operator">=</span>root
<span class="token comment"># the maximal random delay added to the base delay of the jobs</span>
<span class="token assign-left variable">RANDOM_DELAY</span><span class="token operator">=</span><span class="token number">45</span>
<span class="token comment"># the jobs will be started during the following hours only</span>
<span class="token assign-left variable">START_HOURS_RANGE</span><span class="token operator">=</span><span class="token number">3</span>-22

<span class="token comment">#period in days   delay in minutes   job-identifier   command</span>
<span class="token number">1</span>       <span class="token number">5</span>       cron.daily              <span class="token function">nice</span> run-parts /etc/cron.daily
<span class="token number">7</span>       <span class="token number">25</span>      cron.weekly             <span class="token function">nice</span> run-parts /etc/cron.weekly
@monthly <span class="token number">45</span>     cron.monthly            <span class="token function">nice</span> run-parts /etc/cron.monthly<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>任务设置分别为四个字段：执行间隔天数、延迟时间（分钟）、工作名称、实际命令。</p>
<p>查看<code>/var/spool/anacron/cron.daily</code>文件内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /var/spool/anacron/cron.daily
<span class="token number">20210913</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>用每天进行的任务分析一下<code>anacron</code>的执行过程：</p>
<ol>
<li>由<code>/etc/anacrontab</code>分析到<code>cron.daily</code>这项工作的天数为 1 天；</li>
<li>由<code>/var/spool/anacron/cron.daily</code>取出最近一次执行<code>anacron</code>的时间戳；</li>
<li>将取出的时间与目前的时间比较，如果差异天数大于等于 1 天旧准备进行命令；</li>
<li>根据<code>/etc/anacrontab</code>的设置将延迟 5 分钟；</li>
<li>延迟时间过后开始执行后续命令，即<code>run-parts /etc/cron.daily</code>。</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 命令行使用</title>
    <url>/1784829336/</url>
    <content><![CDATA[<h1 id="终端类型"><a class="markdownIt-Anchor" href="#终端类型"></a> 终端类型</h1>
<p>只使用文本的终端被称为字符终端（Character Terminal）或基于文本的终端（Text-Based Terminal），统称命令行界面（CLI，Command Line Interface）。其硬件设备标准代表是 DEC 公司 1978 年生产的 VT100。</p>
<p>图形终端（Graphics Terminal）不仅可以处理文本，还可以显示任何能使用小点在屏幕上进行绘制的内容，也就是可以通过图形用户界面（GUI，Graphical User Interface）和服务端交互。Unix 的 GUI 都基于 X Window System。在图形终端中，用户可以通过鼠标、键盘和触摸屏等设备进行交互操作，相比于命令行界面，图形终端更加直观和易用。</p>
<p>在现代计算机系统中，通常都同时支持命令行界面和图形界面。命令行界面通常用于系统维护、编程和高级用户操作等任务，而图形界面则主要用于日常应用程序的操作和交互。</p>
<p>可以通过查看 <code>$TERM</code> 变量来了解当前使用的终端配置文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server3 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$TERM</span>
vt100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="常用组合快捷键"><a class="markdownIt-Anchor" href="#常用组合快捷键"></a> 常用组合快捷键</h1>
<p>在终端中常用的快捷键如下：</p>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>【Tab】</td>
<td>命令补全/文件名补齐。</td>
</tr>
<tr>
<td>【Ctrl】+C</td>
<td>中断操作，停止程序运行。</td>
</tr>
<tr>
<td>【Ctrl】+D</td>
<td>键盘输入结束/退出终端/删除光标后字符。</td>
</tr>
<tr>
<td>【Ctrl】+Z</td>
<td>暂停当前进程并丢入后台。</td>
</tr>
<tr>
<td>【Ctrl】+S</td>
<td>暂停当前程序，暂停后按下任意键恢复运行。</td>
</tr>
<tr>
<td>【Ctrl】+A</td>
<td>将光标移动到命令行首。</td>
</tr>
<tr>
<td>【Ctrl】+E</td>
<td>将光标移动到命令行尾。</td>
</tr>
<tr>
<td>【Ctrl】+L</td>
<td>清屏。</td>
</tr>
<tr>
<td>【Ctrl】+【Shift】+N</td>
<td>新建终端窗口。</td>
</tr>
</tbody>
</table>
<h1 id="命令提示符"><a class="markdownIt-Anchor" href="#命令提示符"></a> 命令提示符</h1>
<p>成功登录系统后，终端会显示如下命令提示符：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>各字段的含义如下：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>root</td>
<td>标识当前登录的用户身份</td>
</tr>
<tr>
<td>101c7</td>
<td>表示当前主机的名称</td>
</tr>
<tr>
<td>~</td>
<td>表示当前所在的目录。其中，~表示当前用户的主目录，是一个变量。</td>
</tr>
<tr>
<td>#</td>
<td>如果当前用户为 root，命令提示符为 #；如果为普通用户，则为 $。</td>
</tr>
</tbody>
</table>
<h1 id="命令格式"><a class="markdownIt-Anchor" href="#命令格式"></a> 命令格式</h1>
<p>一般命令格式如下，中括号 [] 表示非必须输入：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">命令名称 <span class="token punctuation">[</span>-选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>参数1<span class="token punctuation">]</span> <span class="token punctuation">[</span>参数2<span class="token punctuation">]</span><span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="命令名称"><a class="markdownIt-Anchor" href="#命令名称"></a> 命令名称</h2>
<p>一行命令第一个输入的部分绝对是命令（command）或可执行文件。</p>
<p>当命令太长时，可以使用反斜杠 \ 来转义回车（必须立刻接特殊字符才能转义），使命令输入连续到下一行。</p>
<p>命令严格区分大小写，通常由小写字母构成。</p>
<h2 id="选项"><a class="markdownIt-Anchor" href="#选项"></a> 选项</h2>
<p>选项（options）前通常会加 - 号，例如 -h。</p>
<p>有时表示输入选项完整全名，则使用 – 符号，例如 <code>--help</code>。</p>
<p>多个选项可以用一个 - 连接起来，例如 -abc，表示同时使用 a、b、c 三个选项。</p>
<h2 id="参数"><a class="markdownIt-Anchor" href="#参数"></a> 参数</h2>
<p>参数（parameter）用于向希望运行的程序传递信息，通常是一些文件名，告诉命令从哪里可以得到输入，以及把输出送到什么地方。</p>
<p>参数之间用空格隔开，多个空格会被视为一个空格。如果参数中含有空格，应该使用双引号或单引号将其括起来，例如：<code>&quot;file name&quot;</code>。</p>
<h1 id="执行命令"><a class="markdownIt-Anchor" href="#执行命令"></a> 执行命令</h1>
<p>在命令行执行命令时，通常有以下两种情况：</p>
<ul>
<li>按下回车键后，命令立即运行并显示结果，等待下一条命令输入。</li>
<li>进入到该命令的环境中，直到结束该命令才回到命令提示符的环境。</li>
</ul>
<p>在命令正常执行完毕后，会返回一个值。如果命令执行成功，则返回值为 0。如果命令执行过程中出错没有完成全部工作，则返回一个非零值（可以通过变量$?查看）。</p>
<h2 id="命令执行顺序"><a class="markdownIt-Anchor" href="#命令执行顺序"></a> 命令执行顺序</h2>
<p>命令的执行顺序按照以下优先级排列：</p>
<ol>
<li>以相对/绝对路径执行命令，例如 <code>/bin/ls</code> 或 <code>ls</code>。</li>
<li>由别名（alias）找到该命令来执行。</li>
<li>由 bash 内置的（builtin）命令来执行。</li>
<li>通过$PATH 变量的顺序找到的第一个命令来执行。</li>
</ol>
<h2 id="执行多条命令"><a class="markdownIt-Anchor" href="#执行多条命令"></a> 执行多条命令</h2>
<p>可以用分号将多条命令写在同一行，这些命令将会依次执行。</p>
<p>例如：查看 root.txt 文件属性；修改其权限为 6755；再次查看 root.txt 的属性：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ ll root.txt <span class="token punctuation">;</span> <span class="token function">chmod</span> <span class="token number">6775</span> root.txt <span class="token punctuation">;</span> ll root.txt 
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">7549</span> Sep <span class="token number">11</span> <span class="token number">11</span>:59 root.txt
-rwsrwsr-x. <span class="token number">1</span> root root <span class="token number">7549</span> Sep <span class="token number">11</span> <span class="token number">11</span>:59 root.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="报错信息"><a class="markdownIt-Anchor" href="#报错信息"></a> 报错信息</h2>
<p>以下是两条报错信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ <span class="token function">cat</span> nohup.out <span class="token punctuation">;</span> catt
cat: nohup.out: Permission denied
bash: catt: <span class="token builtin class-name">command</span> not found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>上面的报错信息使用冒号 : 分隔成了三段，分别表示：命令、参数和报错原因。</p>
<h1 id="命令别名"><a class="markdownIt-Anchor" href="#命令别名"></a> 命令别名</h1>
<p>使用<code>alias</code>命令可以为命令或一组命令指定自定义名称。例如，将命令<code>ll -a | more</code>设置为<code>lm</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">alias</span> <span class="token assign-left variable">lm</span><span class="token operator">=</span><span class="token string">'ll -a | more'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>要查询已定义的别名，可以使用<code>-p</code>参数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">alias</span> <span class="token parameter variable">-p</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">cp</span><span class="token operator">=</span><span class="token string">'cp -i'</span>
<span class="token builtin class-name">alias</span> <span class="token assign-left variable">egrep</span><span class="token operator">=</span><span class="token string">'egrep --color=auto'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>如果要取消别名，使用<code>unalias</code>命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">unalias</span> lm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果要临时挂起别名，例如想要使用原始的<code>ls</code>命令而不是带有<code>--color=auto</code>参数的别名<code>ls</code>，可以在命令前面加上反斜杠\字符：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server3 ~<span class="token punctuation">]</span>$ <span class="token punctuation">\</span>ls <span class="token parameter variable">-la</span>
total <span class="token number">64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="历史命令"><a class="markdownIt-Anchor" href="#历史命令"></a> 历史命令</h1>
<p>使用快捷键 [Ctrl]+r 可以搜索历史命令记录。搜索结果继续按 [Ctrl]+r 显示上一个找到的命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>reverse-i-search<span class="token punctuation">)</span>`history': <span class="token function">history</span> <span class="token operator">|</span> <span class="token function">grep</span> dump<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可以使用 <code>history</code> 命令查询输入过的历史命令列表。默认情况下，历史命令保存在 <code>~/.bash_history</code> 中。只有在注销登录后，此次会话所执行的命令才会写入文件中。</p>
<p>可用参数:</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-c</td>
<td>清除所有记录。</td>
</tr>
<tr>
<td>-d</td>
<td>删除指定编号的命令记录。</td>
</tr>
<tr>
<td>-a</td>
<td>插入当前历史记录到指定文件末尾，默认会将此次会话的历史记录写入到 .bash_history 文件中。</td>
</tr>
<tr>
<td>-w</td>
<td>写入当前的历史记录到指定文件中。</td>
</tr>
</tbody>
</table>
<p>例如，要显示最近的 5 条历史记录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">history</span> <span class="token number">5</span>
  <span class="token number">888</span>  <span class="token function">date</span>
  <span class="token number">889</span>  <span class="token function">time</span>
  <span class="token number">890</span>  w <span class="token parameter variable">-i</span>
  <span class="token number">891</span>  <span class="token function">cat</span> .bash_history 
  <span class="token number">892</span>  <span class="token function">history</span> <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-n5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以通过<code>!记录编号</code>直接执行对应的命令。例如，要重新运行第 890 条记录，可以输入：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token operator">!</span><span class="token number">890</span>
w <span class="token parameter variable">-i</span>
<span class="token number">23</span>:41:23 up <span class="token number">1</span> day,  <span class="token number">8</span>:32,  <span class="token number">2</span> users,  load average: <span class="token number">0.00</span>, <span class="token number">0.01</span>, <span class="token number">0.05</span>
<span class="token environment constant">USER</span>     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
root     pts/0    <span class="token number">192.168</span>.2.101    04:01    <span class="token number">3</span>.00s  <span class="token number">0</span>.84s  <span class="token number">0</span>.00s w <span class="token parameter variable">-i</span>
root     pts/1    <span class="token number">192.168</span>.2.101    <span class="token number">15</span>:12    <span class="token number">8</span>:28m  <span class="token number">0</span>.01s  <span class="token number">0</span>.01s <span class="token parameter variable">-bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果使用<code>!!</code>，则会执行上一个命令。</p>
<h1 id="清屏"><a class="markdownIt-Anchor" href="#清屏"></a> 清屏</h1>
<p>直接输入 <code>clear</code> 命令能清屏：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">clear</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 文件系统</title>
    <url>/2794564793/</url>
    <content><![CDATA[<h1 id="查看文件系统支持"><a class="markdownIt-Anchor" href="#查看文件系统支持"></a> 查看文件系统支持</h1>
<p>Linux 系统现支持的文件系统格式如下：</p>
<table>
<thead>
<tr>
<th><strong>文件系统</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ext</td>
<td>Linux 扩展文件系统（Extended Filesystem），最早的 Linux 文件系统。。</td>
</tr>
<tr>
<td>ext2</td>
<td>第 2 代扩展文件系统，在 ext 的基础上提供了更多的功能。ext2 支持 undelete（反删除）和大文件。</td>
</tr>
<tr>
<td>ext3</td>
<td>第 3 代扩展文件系统，支持日志功能。ext3 支持大文件。但不支持反删除（undelete）操作。</td>
</tr>
<tr>
<td>ext4</td>
<td>第 4 代扩展文件系统，支持高级日志功能。</td>
</tr>
<tr>
<td>hpfs</td>
<td>OS/2 高性能文件系统</td>
</tr>
<tr>
<td>jfs</td>
<td>IBM 日志文件系统。</td>
</tr>
<tr>
<td>iso9660</td>
<td>ISO 9660 文件系统（CD-ROM）。</td>
</tr>
<tr>
<td>minix</td>
<td>MINIX 文件系统。</td>
</tr>
<tr>
<td>msdos</td>
<td>微软的 FAT16。</td>
</tr>
<tr>
<td>ncp</td>
<td>Netware 文件系统。</td>
</tr>
<tr>
<td>nfs</td>
<td>网络文件系统。</td>
</tr>
<tr>
<td>ntfs</td>
<td>支持 Microsoft NT 文件系统。</td>
</tr>
<tr>
<td>proc</td>
<td>访问系统信息。</td>
</tr>
<tr>
<td>ReiserFS</td>
<td>高级 Linux 文件系统，支持大文件，支持反删除，几乎能恢复 90%以上的数据，有时能恢复到 100%。</td>
</tr>
<tr>
<td>smb</td>
<td>支持网络访问的 Samba SMB 文件系统。</td>
</tr>
<tr>
<td>sysv</td>
<td>较早期的 Unix 文件系统。</td>
</tr>
<tr>
<td>ufs</td>
<td>BSD 文件系统。</td>
</tr>
<tr>
<td>umsdos</td>
<td>建立在 msdos 上的类 Unix 文件系统。</td>
</tr>
<tr>
<td>vfat</td>
<td>Windows 95 文件系统（FAT32）。</td>
</tr>
<tr>
<td>XFS</td>
<td>高性能 64 位日志文件系统。</td>
</tr>
</tbody>
</table>
<p>可以通过查看 fs 目录了解支持的文件系统有哪些：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 /<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> /lib/modules/<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>/kernel/fs
total <span class="token number">20</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">5992</span> Aug <span class="token number">31</span> <span class="token number">11</span>:05 binfmt_misc.ko.xz
drwxr-xr-x. <span class="token number">2</span> root root   <span class="token number">25</span> Sep  <span class="token number">7</span> 05:54 btrfs
drwxr-xr-x. <span class="token number">2</span> root root   <span class="token number">30</span> Sep  <span class="token number">7</span> 05:54 cachefiles
drwxr-xr-x. <span class="token number">2</span> root root   <span class="token number">24</span> Sep  <span class="token number">7</span> 05:54 ceph<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看系统目前已加载到内存中支持的文件系统：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 /<span class="token punctuation">]</span>$ <span class="token function">cat</span> /proc/filesystems 
nodev   sysfs
nodev   rootfs
nodev   ramfs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>整个 Linux 系统都是通过虚拟文件系统（VFS，Virtual Filesystem Switch）的内核功能来读取文件系统。虚拟文件系统会管理各种文件系统中的数据，并统一提供给系统调用使用。</p>
<h1 id="日志式文件系统"><a class="markdownIt-Anchor" href="#日志式文件系统"></a> 日志式文件系统</h1>
<p>Linux 中有三种广泛使用的日志文件方法，每种的保护等级都不相同：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据模式</td>
<td>索引节点和文件都会被写入日志。所有写入储存设备的数据都要写两次，因此数据安全但性能较差。</td>
</tr>
<tr>
<td>有序模式</td>
<td>只有索引节点数据会被写入日志，数据写入成功后立即删除。</td>
</tr>
<tr>
<td>回写模式</td>
<td>只有索引节点数据会被写入日志，但不控制文件数据何时写入。</td>
</tr>
</tbody>
</table>
<h2 id="异步处理"><a class="markdownIt-Anchor" href="#异步处理"></a> 异步处理</h2>
<p>当系统加载一个文件到内存后，如果长时间没有改动，则内存区段中的文件数据会被设置为 clean。如果更改了，则设置为 dirty。系统会不定时将内存中设置为 dirty 的数据写回磁盘。这个过程叫做异步处理（Asynchronously）。</p>
<ul>
<li>系统会将常用的文件数据放置在主储存器的缓冲区，以加速文件系统的读写；</li>
<li>可以通过 <code>sync</code> 命令将 dirty 数据写回到硬盘；</li>
<li>正常关机时会调用 <code>sync</code> 将内存中数据写回到硬盘；</li>
<li>非正常关机时可能会造成数据损毁。日志文件系统下次启动时会读取日志文件并处理上次留下的未写入的数据。</li>
</ul>
<h2 id="数据不一致状态"><a class="markdownIt-Anchor" href="#数据不一致状态"></a> 数据不一致状态</h2>
<p>假如文件写入过程中突然断电，写入的数据仅有 inode table 和 data block，最后一个同步更新中间数据的步骤没有完成就会发生数据不一致状态（Inconsistent）。</p>
<p>在 Ext2 文件系统中发生这个问题，系统在重启后会通过 Super Block 当中记录的 valid bit（是否有挂载）与文件系统的 state 等状态判断是否强制进行数据一致性的检查，需要的话运行磁盘扫描程序。</p>
<h2 id="日志文件系统种类"><a class="markdownIt-Anchor" href="#日志文件系统种类"></a> 日志文件系统种类</h2>
<p>日志式文件系统（Journaling file system）是为了避免文件系统不一致的情况发生，在文件系统中规划出一个块，用来记录写入或修改文件时的步骤。</p>
<ul>
<li>当系统要写入一个文件时，会先在日志记录块中记录某个文件准备要写入的信息；</li>
<li>当完成数据与元数据更新后，在日志记录块中完成该文件的记录；</li>
<li>这样当出现问题时，系统只要去检查日志记录块就知道哪个文件发生了问题，针对该问题做一致性检查即可。</li>
</ul>
<p>在上面的 <code>/dev/sdb1</code> 中，journal 块指向 inode 8 号记录，具有 16MB 容量处理日志。</p>
<p>常见日志文件系统如下：</p>
<ul>
<li>
<p><strong>ext3 文件系统</strong></p>
<p>采用和 ext2 文件系统相同的索引节点表结构，但给每个存储设备增加了一个日志文件，以将准备写入存储设备的数据先记入日志。</p>
<p>默认情况下，ext3 文件系统用有序模式的日志功能。也可以在创建文件系统时加入选项，将日志方法改成数据模式或回写模式。</p>
</li>
<li>
<p><strong>ext4 文件系统</strong></p>
<p>除了支持数据压缩和加密，ext4 文件系统还支持一个称为区段（Extent）的特性，区段在存储设备上按块分配空间，但在索引节点表中只保留起始块的位置。</p>
<p>另外一个特性是块预分配技术（Block Preallocation）。如果要给存储一个会变大的文件预留空间，ext4 文件系统可以为文件预分配所有需要的块用 0 填满。</p>
</li>
<li>
<p><strong>Reiser 文件系统</strong></p>
<p>ReiserFS 文件系统只支持回写日志模式，它具有两个特性。一个是可以在线调整已有文件系统的大小。另一个被称为尾部压缩处理（Tailpacking），它能将一个文件的数据填进另一个文件的数据块中空白空间，以此节省容量。</p>
</li>
<li>
<p><strong>JFS 文件系统</strong></p>
<p>JFS 文件系统采用有序日志方法。特点是采用基于区段的文件分配，即为每个写入存储设备的文件分配一组块，这样可以减少存储设备上的碎片。</p>
</li>
<li>
<p><strong>XFS 文件系统</strong></p>
<p>XFS 文件系统采用回写日志模式。和 Reiser 一样支持在线调整文件系统大小，但它<strong>只能扩容，不能缩容</strong>。</p>
</li>
</ul>
<h1 id="ext-文件系统结构"><a class="markdownIt-Anchor" href="#ext-文件系统结构"></a> Ext 文件系统结构</h1>
<p>Linux 中，分区格式化的意义在于选择文件系统，按照文件系统标准将数据初始化。</p>
<p>在选择 ext 文件系统格式化后，磁盘结构变为一个引导扇区（有装系统）+多个块组（Block Group）。如下图所示：</p>
<p><img data-src="../../../images/Ext%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84.gif" alt="Ext文件系统结构" /></p>
<p>启动扇区占大小为 1KB，所以如果 block 大小设为 1024B 的话，启动扇区会存在 0 号 block。而在 block 大小大于 1024B 时，0 号 block 前面是启动扇区，后面跟着 superblock 占用 1K。</p>
<p>每个块组又包含分为六个区域：</p>
<ul>
<li>
<p><strong>超级块</strong>（SuperBlock）</p>
<p>记录文件系统的整体信息，包括 inode/block 的总量、使用量、剩余量，以及文件系统的格式与相关信息。</p>
</li>
<li>
<p><strong>文件系统描述</strong>（File System Description）</p>
<p>这个区段可以描述每个块组的起止 block 号码。</p>
<p>说明块组每个区段（superblock、inode、data、bitmap）的 block 起止号码。</p>
</li>
<li>
<p><strong>块对照表</strong>（Block Bitmap）</p>
<p>块对照表用来辅助块组找到可用的 block 写数据。</p>
<p>删除文件时将对应 block 号码标记为未使用。</p>
</li>
<li>
<p><strong>Inode 对照表</strong>（Inode Bitmap）</p>
<p>与块对照表功能类似，用来记录已使用与未使用的 inode 号码。</p>
</li>
<li>
<p><strong>Inode 表格</strong>（Inode Table）</p>
<p>记录文件的属性，一个文件占用一个 inode，同时记录此文件的数据所在的 block 号码。</p>
</li>
<li>
<p><strong>数据块</strong>（Data Block）</p>
<p>实际记录文件的内容，如果文件太大时，会占用多个 block。</p>
</li>
</ul>
<p>与 FAT 文件系统对比：</p>
<ul>
<li>Linux 文件系统每个 inode 与 block 都有编号，读取文件时先读取 inode 记录，得到文件实际存放的 block 号码，将整个文件读取出来。这种数据访问方法称为索引式文件系统（indexed allocation）。</li>
<li>FAT 格式没有 inode 存在，每个 block 号码都记录在前一个 block 当中。读取文件时必须一个个追踪，硬盘转很多圈才能读到最后一个 block。因此需要磁盘碎片整理，将同一个文件所属的 block 汇合在一起提升磁头搜寻效率。</li>
</ul>
<h2 id="数据块"><a class="markdownIt-Anchor" href="#数据块"></a> 数据块</h2>
<p>数据块是放置文件内容的地方，在 Ext2 中支持的块大小有 1KB、2KB 和 4KB，格式化时可选择块大小，每个块都有编号。</p>
<p>不同块大小支持的分区大小和单文件大小有所不同：</p>
<table>
<thead>
<tr>
<th>块大小</th>
<th>1KB</th>
<th>2KB</th>
<th>4KB</th>
</tr>
</thead>
<tbody>
<tr>
<td>最大单一文件限制</td>
<td>16GB</td>
<td>256GB</td>
<td>2TB</td>
</tr>
<tr>
<td>最大文件系统总容量</td>
<td>2TB</td>
<td>8TB</td>
<td>16TB</td>
</tr>
</tbody>
</table>
<p>每个 block 内最多放置一个文件的数据，如果文件超过 block 大小，会占用多个 block。文件大小小于 block 大小时，block 内剩余容量也不能再被利用。</p>
<h2 id="inode-表格"><a class="markdownIt-Anchor" href="#inode-表格"></a> Inode 表格</h2>
<p>inode 的内容主要记录文件的属性及文件实际数据存放的 block 号码。</p>
<p>inode 记录的文件数据有下面这些：</p>
<ul>
<li>该文件的访问模式（read/write/execute）；</li>
<li>该文件的所有者与组（owner/group）；</li>
<li>该文件的大小；</li>
<li>该文件创建或状态改变的时间（ctime）；</li>
<li>最近一次读取的时间（atime）；</li>
<li>最近修改的时间（mtime）；</li>
<li>定义文件特性的标志（flag），比如 SUID 等；</li>
<li>该文件真正内容的指向（pointer）。</li>
</ul>
<p>inode 的特点：</p>
<ul>
<li>每个 inode 大小均固定为 128Bytes（ext4 和 xfs 可设置到 256Bytes）；</li>
<li>每个文件都仅占用一个 inode；</li>
<li>文件系统能创建的文件数量与 inode 数量有关；</li>
<li>系统读取 inode 时，会匹配 inode 上记录权限与用户是否符合，符合才继续读取 block 内容。</li>
</ul>
<p>inode 记录方式：</p>
<ul>
<li>每个 inode 记录 block 号码的区域定义为：12 个直接，1 个间接，1 个双间接和 1 个三间接记录区；</li>
<li>12 个直接记录能直接取得 block 号码，间接则是再拿一个 block 来当作记录 block 号码的记录区。双间接和三间接则是 block 再次指向下一个记录编号的 block 号码，以此最多三层指向；</li>
<li>以 1k 大小 block 块计算，总共能记录的文件大小为：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>12</mn><mo>×</mo><mn>1</mn><mi>K</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mi>K</mi><mi mathvariant="normal">/</mi><mn>4</mn><mi>B</mi><mo>=</mo><mn>256</mn><mi>K</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>256</mn><mo>×</mo><mn>256</mn><mi>K</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>256</mn><mo>×</mo><mn>256</mn><mo>×</mo><mn>256</mn><mi>K</mi><mo stretchy="false">)</mo><mo>=</mo><mn>16</mn><mi>G</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">(12\times1K)+(1K/4B=256K)+(256\times256K)+(256\times256\times256K)=16GB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord">/</span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>；</li>
<li>现在使用 256Bytes 容量大小的 inode，还可以记录更多文件系统信息，包括 ACL 及 SELinux 类型等。记录的单一文件大小达 16TB，且单一文件系统总容量可达 1EB；</li>
</ul>
<h2 id="超级块"><a class="markdownIt-Anchor" href="#超级块"></a> 超级块</h2>
<p>超级块是记录整个文件系统相关信息的地方，一般超级块的大小为 1024 字节。</p>
<p>超级块记录的信息有：</p>
<ul>
<li>block 与 inode 的总量；</li>
<li>未使用与已使用的 inode/block 数量；</li>
<li>block 与 inode 的大小；</li>
<li>文件系统的挂载时间、最近一次写入数据的时间、最近一次检验磁盘（fsck）的时间等；</li>
<li>一个 valid bit 数值，若此文件系统已被挂载则值为 0，未挂载为 1。</li>
</ul>
<p>因为超级块非常重要，所以除了第一个块组中含有超级块外，其他块组中可能存在超级块备份，用来在关键时进行救援修复。</p>
<h2 id="查询文件系统详情"><a class="markdownIt-Anchor" href="#查询文件系统详情"></a> 查询文件系统详情</h2>
<p>使用 <code>dumpe2fs</code> 命令可以查询 ext 文件系统信息.例如查询设备 sdb1：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 /<span class="token punctuation">]</span>$ dumpe2fs /dev/sdb1
dumpe2fs <span class="token number">1.42</span>.9 <span class="token punctuation">(</span><span class="token number">28</span>-Dec-2013<span class="token punctuation">)</span>
Filesystem volume name:   <span class="token operator">&lt;</span>none<span class="token operator">></span>
Last mounted on:          <span class="token operator">&lt;</span>not available<span class="token operator">></span>
Filesystem UUID:          3789ee36-8f38-441c-ac01-c0a9ca8171a1
Filesystem magic number:  0xEF53
Filesystem revision <span class="token comment">#:    1 (dynamic)</span>
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery sparse_super large_file
Filesystem flags:         signed_directory_hash 
Default <span class="token function">mount</span> options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              <span class="token number">65536</span>
Block count:              <span class="token number">261888</span>
Reserved block count:     <span class="token number">13094</span>
Free blocks:              <span class="token number">253344</span>
Free inodes:              <span class="token number">65525</span>
First block:              <span class="token number">0</span>
Block size:               <span class="token number">4096</span>
Fragment size:            <span class="token number">4096</span>
Reserved GDT blocks:      <span class="token number">63</span>
Blocks per group:         <span class="token number">32768</span>
Fragments per group:      <span class="token number">32768</span>
Inodes per group:         <span class="token number">8192</span>
Inode blocks per group:   <span class="token number">512</span>
Filesystem created:       Thu Sep  <span class="token number">9</span> <span class="token number">15</span>:10:34 <span class="token number">2021</span>
Last <span class="token function">mount</span> time:          Thu Sep  <span class="token number">9</span> <span class="token number">15</span>:11:11 <span class="token number">2021</span>
Last <span class="token function">write</span> time:          Thu Sep  <span class="token number">9</span> <span class="token number">15</span>:11:11 <span class="token number">2021</span>
Mount count:              <span class="token number">1</span>
Maximum <span class="token function">mount</span> count:      <span class="token parameter variable">-1</span>
Last checked:             Thu Sep  <span class="token number">9</span> <span class="token number">15</span>:10:34 <span class="token number">2021</span>
Check interval:           <span class="token number">0</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>none<span class="token operator">></span><span class="token punctuation">)</span>
Reserved blocks uid:      <span class="token number">0</span> <span class="token punctuation">(</span>user root<span class="token punctuation">)</span>
Reserved blocks gid:      <span class="token number">0</span> <span class="token punctuation">(</span>group root<span class="token punctuation">)</span>
First inode:              <span class="token number">11</span>
Inode size:               <span class="token number">256</span>
Required extra isize:     <span class="token number">28</span>
Desired extra isize:      <span class="token number">28</span>
Journal inode:            <span class="token number">8</span>
Default directory hash:   half_md4
Directory Hash Seed:      32744b35-d887-4ba9-9431-c5a9d63b9474
Journal backup:           inode blocks
Journal features:         <span class="token punctuation">(</span>none<span class="token punctuation">)</span>
Journal size:             16M
Journal length:           <span class="token number">4096</span>
Journal sequence:         0x00000002
Journal start:            <span class="token number">1</span>


Group <span class="token number">0</span>: <span class="token punctuation">(</span>Blocks <span class="token number">0</span>-32767<span class="token punctuation">)</span>
  Primary superblock at <span class="token number">0</span>, Group descriptors at <span class="token number">1</span>-1
  Reserved GDT blocks at <span class="token number">2</span>-64
  Block bitmap at <span class="token number">65</span> <span class="token punctuation">(</span>+65<span class="token punctuation">)</span>, Inode bitmap at <span class="token number">66</span> <span class="token punctuation">(</span>+66<span class="token punctuation">)</span>
  Inode table at <span class="token number">67</span>-578 <span class="token punctuation">(</span>+67<span class="token punctuation">)</span>
  <span class="token number">32183</span> <span class="token function">free</span> blocks, <span class="token number">8181</span> <span class="token function">free</span> inodes, <span class="token number">2</span> directories
  Free blocks: <span class="token number">585</span>-32767
  Free inodes: <span class="token number">12</span>-8192
Group <span class="token number">1</span>: <span class="token punctuation">(</span>Blocks <span class="token number">32768</span>-65535<span class="token punctuation">)</span>
  Backup superblock at <span class="token number">32768</span>, Group descriptors at <span class="token number">32769</span>-32769
  Reserved GDT blocks at <span class="token number">32770</span>-32832
  Block bitmap at <span class="token number">32833</span> <span class="token punctuation">(</span>+65<span class="token punctuation">)</span>, Inode bitmap at <span class="token number">32834</span> <span class="token punctuation">(</span>+66<span class="token punctuation">)</span>
  Inode table at <span class="token number">32835</span>-33346 <span class="token punctuation">(</span>+67<span class="token punctuation">)</span>
  <span class="token number">32189</span> <span class="token function">free</span> blocks, <span class="token number">8192</span> <span class="token function">free</span> inodes, <span class="token number">0</span> directories
  Free blocks: <span class="token number">33347</span>-65535
  Free inodes: <span class="token number">8193</span>-16384
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到这块磁盘格式化成了 ext3 文件系统后的 inode/block 数量，目前状态为 clean 正常等，这些就是 superblock 所记录的内容。后面以 Group 开头的段为一个个块组信息。</p>
<h1 id="xfs-文件系统结构"><a class="markdownIt-Anchor" href="#xfs-文件系统结构"></a> XFS 文件系统结构</h1>
<p>由于 Ext 文件系统在格式化时采用的是预先规划出所有 inode/block/metadata 等数据，当磁盘容量很小时问题不大，但处理按 TB 计的大硬盘时，仅格式化就需要花费很长时间。</p>
<p>而 XFS 是针对大文件和数据设计的日志式文件系统。XFS 具备了 Ext 文件系统的所有功能，因此被作为 CentOS 7 中的默认文件系统。</p>
<p>XFS 文件系统在数据分布上主要划分为三部分：数据区、文件系统活动登录区和实时运行区。</p>
<h2 id="数据区"><a class="markdownIt-Anchor" href="#数据区"></a> 数据区</h2>
<p>数据区(Data Section)结构基本与 Ext 文件系统相同，包括 inode/data block/superblock 等数据，并且也是分为多个存储区组（Allocation Groups）来分别放置文件系统所需数据。</p>
<p>每个存储区组都包含了：</p>
<ul>
<li>整个文件系统的 superblock；</li>
<li>剩余空间管理机制；</li>
<li>inode 的分配与追踪。</li>
</ul>
<p>此外，inode 与 block 都是系统需要用时才动态配置产生。block 容量可以设置成 512 字节到 64KB，inode 的容量可以设置成 256 字节到 2MB。这是与 Ext 文件系统的主要区别。</p>
<h2 id="文件系统活动日志区"><a class="markdownIt-Anchor" href="#文件系统活动日志区"></a> 文件系统活动日志区</h2>
<p>在文件系统活动日志区（Log Section）中，主要被用来记录文件系统的变化，有点像日志系统。文件的变化会在这里记录下来，直到变化完整写入到硬盘后，记录才会终止。</p>
<p>在遇到突发情况而造成文件系统损毁时，系统会检查日志区，看系统之前正在操作的文件，再检查文件是否正确，依次修复文件系统。</p>
<p>由于此区块读写频繁，因此可以指定单独的磁盘作为 XFS 文件系统的日志区。</p>
<h2 id="实时运行区"><a class="markdownIt-Anchor" href="#实时运行区"></a> 实时运行区</h2>
<p>当有文件要被创建时，XFS 会在实时运行区（Realtime Section）找一到多个 extent 区块，将文件放置在这个区块内，等到分配完成再写入到数据区的 inode 和 block 中。</p>
<p>extent 区块在格式化时可以指定，范围从 4KB 到 1GB，一般默认设置为 64KB 容量。</p>
<h2 id="查询文件系统详情-2"><a class="markdownIt-Anchor" href="#查询文件系统详情-2"></a> 查询文件系统详情</h2>
<p>在 XFS 文件系统中，使用 <code>xfs_info</code> 命令来查看分区详情：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ xfs_info /dev/mapper/centos-root
meta-data<span class="token operator">=</span>/dev/mapper/centos-root <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">1113856</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">spinodes</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">4455424</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal               <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">2560</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面简单解释下字段含义：</p>
<ul>
<li>第 1 行：
<ul>
<li>isize=512 指定 inode 的容量每个 512 字节大小。</li>
<li>agcount=4 是储存区群组的个数 4 个。可以设置成 CPU 核心的数量来搭配。</li>
<li>agsize=1113856 blks 每个储存区群组具有 1113856 个 block。</li>
</ul>
</li>
<li>第 2 行：
<ul>
<li>sectsz=512 指逻辑扇区容量设置为 512 字节。</li>
</ul>
</li>
<li>第 4 行：
<ul>
<li>bsize=4096 指每个 block 大小为 4KB，可以用 bsize*blocks 得到分区总容量 17821696KB ≈ 16GB。</li>
<li>blocks=4455424 指系统总共有 4455424 个 blocks，可以由 agsize*agcount 算得。</li>
</ul>
</li>
<li>第 5 行：
<ul>
<li>sunit=0 和 RAID 的 stripe 设置有关。</li>
<li>swidth=0 和 RAID 的工作盘数量有关。</li>
</ul>
</li>
<li>第 7 行：
<ul>
<li>internal 表示这个日志区的位置在文件系统内，而不是外部设备。</li>
<li>bsize=4096 日志区 block 大小为 4KB。</li>
<li>blocks=2560 日志区 block 总数 2560，可以算得日志区大小为 10MB。</li>
</ul>
</li>
<li>第 9 行：
<ul>
<li>extsz=4096 指 extent 大小为 4KB。</li>
</ul>
</li>
</ul>
<h1 id="文件与目录数据结构"><a class="markdownIt-Anchor" href="#文件与目录数据结构"></a> 文件与目录数据结构</h1>
<p>每个文件或目录都会占用一个 inode，且可依据文件内容的大小来分配多个 block 给该文件使用。</p>
<h2 id="目录"><a class="markdownIt-Anchor" href="#目录"></a> 目录</h2>
<p>当在系统中新建一个目录时，至少会分配一个 inode 与一个 block 给该目录。</p>
<ul>
<li><strong>inode 记录本目录相关权限、属性与本目录 block 号码</strong>。</li>
<li><strong>block 记录在这个目录下的文件名与该文件（或目录）对应的 inode 号码</strong>。</li>
</ul>
<p>例如使用 <code>ls -i</code> 查看目录 ext333 内文件所占用 inode 号码：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token parameter variable">-li</span>
total <span class="token number">16</span>
<span class="token number">12</span> -rw-r--r--. <span class="token number">1</span> root root     <span class="token number">0</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:37 fist.log
<span class="token number">11</span> drwx------. <span class="token number">2</span> root root <span class="token number">16384</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:10 lost+found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>fist.log 文件的 inode 号码是 12，lost+found 目录的 inode 号码是 11，这些就是记录在 ext333 目录 block 中的数据。</p>
<p>再查看一下目录占用的大小：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ ll <span class="token parameter variable">-dh</span> /ext333/lost+found/ /ext333/
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">4</span>.0K Sep  <span class="token number">9</span> <span class="token number">15</span>:37 /ext333/
drwx------. <span class="token number">2</span> root root  16K Sep  <span class="token number">9</span> <span class="token number">15</span>:10 /ext333/lost+found/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>可以看到 ext333 目录大小为 4KB，而分区时设置的一个 block 大小也是 4KB，因此它使用了 1 个 block 来记录文件和目录 inode 号码信息。另外 lost+found 目录大小 16KB，说明记录信息太多 1 个 block 不够用，分配了 4 个 block 来记录。</p>
<h2 id="文件"><a class="markdownIt-Anchor" href="#文件"></a> 文件</h2>
<p>当新建一个一般文件时，系统会分配一个 inode 与相对于该文件大小的 block 数量给该文件。</p>
<p>假设 block 大小为 4KB，inode 大小为 128B，要新建 100KB 大小的文件，那么会分配到 1 个 inode 与 25 个 block 来储存该文件。由于 inode 只有 12 个直接指向，因此还要额外分配 1 个 block 来作为 block 号码记录用，文件实际上需要 26 个 block 来储存。</p>
<h2 id="目录树读取"><a class="markdownIt-Anchor" href="#目录树读取"></a> 目录树读取</h2>
<p>inode 本身并不记录文件名，文件名的记录在目录的 block 当中。所以给目录写权限，实际上操作的是修改目录的 block 数据。</p>
<p>删除文件记录（<code>rm</code> 命令），修改文件指向 inode 记录（<code>mv</code> 命令），或者新增文件指向 inode 记录（<code>cp</code> 命令），对应的就是在目录下进行删除、重命名、新增操作。</p>
<p>以下面记录为例：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ ll <span class="token parameter variable">-di</span> /ext333/ /ext333/lost+found/ /ext333/lost+found/pass 
<span class="token number">2</span>  drwxr-xr-x. <span class="token number">3</span> root root  <span class="token number">4096</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:37 /ext333/
<span class="token number">11</span> drwx------. <span class="token number">2</span> root root <span class="token number">16384</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:54 /ext333/lost+found/
<span class="token number">14</span> -rw-r--r--. <span class="token number">1</span> root root     <span class="token number">5</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:54 /ext333/lost+found/pass<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>假设 root 要读取 <code>/ext333/lost+found/pass</code> 这个文件，顺序是这样的：</p>
<ol>
<li>通过挂载点的信息找到 inode 号码为 2 的 ext333 目录，查询 2 号 inode 内容，得到目录权限配置为 755。由于存在 x 权限，因此用户可以进入到 ext333 目录中。由于存在 r 权限，因此用户可以读取目录 ext333 的 block 内容。</li>
<li>通过读取 ext333 目录的 block 内容，得到 lost+found 目录的 inode 号码为 11。继续查询 11 号 inode 内容，得知权限为 rwx，因此继续进入 lost+found 目录，并读取目录的 block 内容。</li>
<li>通过读取目录 lost+found 的 block 内容得知 pass 文件的 inode 号码为 14。继续查询 14 号 inode 内容，得到权限为 rw。由于存在 r 权限，因此获得数据实际存放的 block 地址。</li>
<li>读取 pass 文件的 block 内容。</li>
</ol>
<h2 id="新增文件"><a class="markdownIt-Anchor" href="#新增文件"></a> 新增文件</h2>
<p>新增一个文件或目录时，文件系统的行为如下：</p>
<ol>
<li>首先确定用户是否对欲添加文件的目录拥有 w 和 x 权限，只有具备这两个权限才能进行添加操作；</li>
<li>根据 inode bitmap 寻找一个未使用的 inode 号码，并将新文件的权限和属性写入该 inode 中；</li>
<li>根据 block bitmap 寻找一个未使用的 block 号码，将实际数据写入该 block 中，并更新 inode 的 block 指向数据；</li>
<li>同步更新 inode bitmap 和 block bitmap 中的写入的 inode 与 block 数据，并更新 superblock 的内容。</li>
</ol>
<p>inode table 与 data block 被称为数据存储区域，而其他区域，如 superblock、block bitmap 和 inode bitmap 等，被称为 metadata（中间区域）。</p>
<h1 id="写时复制文件系统"><a class="markdownIt-Anchor" href="#写时复制文件系统"></a> 写时复制文件系统</h1>
<p>写时复制（COW，copy-on-write）利用快照兼顾了安全性和性能。如果要修改数据，会使用克隆或可写快照，修改过的数据并不会直接覆盖当前数据，而是被放入文件系统中的另一个位置。即使数据修改已经完成，之前的旧数据也不会被重写。最流行的 COW 文件系统有下面两种：</p>
<ul>
<li>
<p><strong>ZFS 文件系统</strong></p>
<p>ZFS（Z File System）是一个稳定的文件系统，用在 Sun 公司的 OpenSolaris 系统中，但它并非开源。开源版本叫做 OpenZFS 项目。</p>
</li>
<li>
<p><strong>Btrfs 文件系统</strong></p>
<p>Btrfs 文件系统也被称为 B 树文件系统，它稳定易用，能够动态调整已挂载文件系统的大小。目前 OpenSUSE Linux 把 Btrfs 作为其默认文件系统。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 文件属性解释</title>
    <url>/1872252014/</url>
    <content><![CDATA[<h1 id="查看文件属性"><a class="markdownIt-Anchor" href="#查看文件属性"></a> 查看文件属性</h1>
<p>执行 <code>ls -la</code> 命令后，可以看到当前目录下所有文件的权限和属性：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ ll <span class="token parameter variable">-la</span>
total <span class="token number">32</span>
dr-xr-x---.  <span class="token number">4</span> root root  <span class="token number">175</span> Sep  <span class="token number">8</span> <span class="token number">22</span>:48 <span class="token builtin class-name">.</span>
dr-xr-xr-x. <span class="token number">17</span> root root  <span class="token number">224</span> Sep  <span class="token number">7</span> <span class="token number">13</span>:37 <span class="token punctuation">..</span>
-rw-------.  <span class="token number">1</span> root root <span class="token number">1260</span> Sep  <span class="token number">7</span> <span class="token number">13</span>:38 anaconda-ks.cfg
-rw-------.  <span class="token number">1</span> root root  <span class="token number">847</span> Sep  <span class="token number">8</span> <span class="token number">12</span>:32 .bash_history
-rw-r--r--.  <span class="token number">1</span> root root   <span class="token number">18</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .bash_logout
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .bash_profile
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .bashrc
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">100</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .cshrc
drwxr-xr-x.  <span class="token number">2</span> root root    <span class="token number">6</span> Sep  <span class="token number">8</span> <span class="token number">22</span>:48 dir1
drwxr-----.  <span class="token number">3</span> root root   <span class="token number">19</span> Sep  <span class="token number">7</span> 05:51 .pki
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">129</span> Dec <span class="token number">28</span>  <span class="token number">2013</span> .tcshrc
-rw-------.  <span class="token number">1</span> root root  <span class="token number">508</span> Sep  <span class="token number">7</span> 05:52 .viminfo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>total 为该目录下的所有数据所占用的实际块数量乘以块大小的值。</p>
<p>从左到右以空格分隔成七列，分别代表：类型和权限、连接、所有者、所有组、大小、修改时间、文件名。</p>
<h1 id="文件类型"><a class="markdownIt-Anchor" href="#文件类型"></a> 文件类型</h1>
<p>第一列第一个字段用来表示文件的类型，文件类型有下面几种：</p>
<table>
<thead>
<tr>
<th><strong>标记</strong></th>
<th><strong>类型</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>普通文件</td>
<td>文本文件、数据文件、可执行程序等都作为普通文件存储</td>
</tr>
<tr>
<td>d</td>
<td>目录</td>
<td>目录不存放常规数据，它用来组织访问其他文件</td>
</tr>
<tr>
<td>c</td>
<td>字符设备文件</td>
<td>指处理数据时每次只能处理一个字符的设备，例如鼠标、键盘（一次性读取设备）</td>
</tr>
<tr>
<td>b</td>
<td>块设备文件</td>
<td>指处理数据时每次能处理大块数据的设备，例如硬盘</td>
</tr>
<tr>
<td>s</td>
<td>本地域套接字</td>
<td>实现进程间通信的连接，本地域套接字由系统调用 socket 创建</td>
</tr>
<tr>
<td>p</td>
<td>有名管道(FIFO)</td>
<td>让运行在同一主机上的两个进程相互通信，和 socket 文件相似</td>
</tr>
<tr>
<td>l</td>
<td>符号链接</td>
<td>也叫做软链接（Linkfile），通过名字指向文件</td>
</tr>
</tbody>
</table>
<p><code>ls</code> 命令结果展示文件颜色含义：</p>
<table>
<thead>
<tr>
<th><strong>颜色</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>灰色</td>
<td>普通文件</td>
</tr>
<tr>
<td>蓝色</td>
<td>目录</td>
</tr>
<tr>
<td>绿色</td>
<td>可执行文件</td>
</tr>
<tr>
<td>黄色</td>
<td>特殊文件</td>
</tr>
<tr>
<td>红色</td>
<td>压缩文件</td>
</tr>
</tbody>
</table>
<h1 id="文件权限"><a class="markdownIt-Anchor" href="#文件权限"></a> 文件权限</h1>
<p>第一列后九个字段以三个为一组，分别表示：</p>
<ul>
<li>文件所有者权限</li>
<li>同用户组权限</li>
<li>其他用户权限</li>
</ul>
<p>权限为&quot;rwx&quot;的三个参数组合，没有权限显示为&quot;-&quot;减号。</p>
<h1 id="连接节点"><a class="markdownIt-Anchor" href="#连接节点"></a> 连接节点</h1>
<p>第二列数字表示节点，每个文件都会将它的权限与属性记录到文件系统的 inode 中。</p>
<p>这个属性记录的就是有多少不同的文件名连接到相同的一个 inode 号码。</p>
<h1 id="所有者所有组"><a class="markdownIt-Anchor" href="#所有者所有组"></a> 所有者/所有组</h1>
<p>第三列和第四列分别表示文件所属的用户和用户组。</p>
<h1 id="文件大小"><a class="markdownIt-Anchor" href="#文件大小"></a> 文件大小</h1>
<p>第五列表示文件的容量大小，默认单位为 Bytes。</p>
<p>目录显示的大小不是文件夹大小，而是目录元数据的大小。</p>
<h1 id="修改日期"><a class="markdownIt-Anchor" href="#修改日期"></a> 修改日期</h1>
<p>第六列为文件的创建日期或最近修改时间。</p>
<p>如果修改时间距离太久，那时间部分会显示成年份。</p>
<h1 id="文件名"><a class="markdownIt-Anchor" href="#文件名"></a> 文件名</h1>
<p>第七列为文件名或文件夹名。</p>
<p>Linux 的文件名是大小写敏感的。</p>
<p>文件或目录名的第一个字母是&quot;.&quot;表示隐藏文件。</p>
<p><strong>文件名规则</strong>：</p>
<ul>
<li>由大写字母、小写字母、数字和一些特殊符号组成；</li>
<li>不可以包含 * ? &lt; &gt; ( ) [ ] { } / \ | &quot;  ` ＆ ;  ! 等符号；</li>
<li>＋-可以出现在文件名中，但是不能作为文件名中的第一个字母；</li>
<li>文件名中一般不应该包含空格；</li>
<li>使用 Ext 文件系统时，文件名最长 255 个字符，路径最长 4096 个字符。</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 文件权限</title>
    <url>/46662635/</url>
    <content><![CDATA[<h1 id="基本权限"><a class="markdownIt-Anchor" href="#基本权限"></a> 基本权限</h1>
<p>基础权限有三种，分别是：读（r，Read）、写（w，Write）、执行（x，eXecute）。</p>
<p>同样的权限标记对于文件和目录代表不同的意义。</p>
<h2 id="文件权限"><a class="markdownIt-Anchor" href="#文件权限"></a> 文件权限</h2>
<p>文件包括一般文本文件、数据库和二进制可执行文件。文件权限只针对文件内容而言，和改名、删除等操作无关。</p>
<table>
<thead>
<tr>
<th>数字</th>
<th>字符</th>
<th>权限</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>r</td>
<td><strong>读取文件内容</strong>。例如使用 <code>cat</code> 命令查看，使用 <code>vim</code> 以<strong>只读</strong>方式打开。</td>
</tr>
<tr>
<td>2</td>
<td>w</td>
<td><strong>编辑修改</strong>文件内容，但<strong>不包括删除</strong>文件。例如使用 <code>vim</code>、<code>sed</code> 等对文件内容进行修改并保存。</td>
</tr>
<tr>
<td>1</td>
<td>x</td>
<td>文件具有可以被系统<strong>执行</strong>的权限。例如命令和脚本必须拥有此权限才能直接执行。</td>
</tr>
</tbody>
</table>
<h2 id="目录权限"><a class="markdownIt-Anchor" href="#目录权限"></a> 目录权限</h2>
<p>目录主要的内容是记录文件名清单，所以目录权限实际关联的是目录下文件属性查看与更改。</p>
<table>
<thead>
<tr>
<th>数字</th>
<th>字符</th>
<th>权限</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>r</td>
<td><strong>仅查询</strong>目录下的文件或目录<strong>名称</strong>，无法看到属性，相当于执行不加参数的 <code>ls</code> 命令。</td>
</tr>
<tr>
<td>2</td>
<td>w</td>
<td>改变目录结构清单权限，也就是在目录下<strong>新建、删除、重命名</strong>文件或目录。</td>
</tr>
<tr>
<td>1</td>
<td>x</td>
<td><strong>进入目录</strong>的权限，<strong>查询</strong>目录下的文件<strong>属性</strong>。</td>
</tr>
</tbody>
</table>
<h1 id="权限参考"><a class="markdownIt-Anchor" href="#权限参考"></a> 权限参考</h1>
<p>根据使用场景来配置权限。</p>
<p><strong>用户进入目录所需权限</strong>：</p>
<ul>
<li>目录需要 x 权限，来运行 <code>cd</code> 切换目录。</li>
<li>目录需要 r 权限，来使用 <code>ls</code> 命令查看目录中文件列表。</li>
</ul>
<p><strong>用户读取目录内文件所需权限</strong>：</p>
<ul>
<li>目录需要 x 权限来进入目录。</li>
<li>文件需要 r 权限来运行 <code>cat</code>、<code>more</code> 等读取文件命令。</li>
</ul>
<p><strong>用户修改目录内文件所需权限</strong>：</p>
<ul>
<li>目录需要 x 权限来进入目录。</li>
<li>文件需要 r 和 w 权限来使用 <code>vi</code> 等工具进行文件读写。</li>
</ul>
<p><strong>用户创建一个文件所需权限</strong>：</p>
<ul>
<li>目录需要 w 和 x 权限来创建文件。</li>
</ul>
<p><strong>用户执行目录下的命令所需权限</strong>：</p>
<ul>
<li>目录需要 x 权限来进入目录。</li>
<li>文件需要 x 权限来运行命令。</li>
</ul>
<h1 id="特殊权限"><a class="markdownIt-Anchor" href="#特殊权限"></a> 特殊权限</h1>
<p>在 Linux 系统中，还有一些特殊权限。</p>
<h2 id="suid"><a class="markdownIt-Anchor" href="#suid"></a> SUID</h2>
<p>当 s 标志出现在文件所有者的 x 权限上时，被称为 Set UID，其含义为：</p>
<ul>
<li>SUID 权限<strong>仅对二进制程序有效</strong>，不能用在脚本上；</li>
<li>执行者对该程序需要具有 x 的可执行权限；</li>
<li>本权限仅在执行该程序的过程中（run-time）有效；</li>
<li><strong>执行者将具有该程序所有者的权限</strong>。</li>
</ul>
<p>例如一般用户运行 <code>passwd</code> 命令修改密码，需要修改 <code>/etc/shadow</code> 文件。但是该文件的权限只有 root 可读写，而用户运行 passwd 程序时，会暂时获得 passwd 程序的 root 权限，从而可以通过 <code>passwd</code> 命令修改 <code>/etc/shadow</code> 文件。</p>
<p>这是因为运行 <code>passwd</code> 后会启动一个新的进程，该进程会产生一个新的 PID。在该 PID 产生时，SUID 会给予该 PID 特殊的权限设置，使得执行者在该进程中具有该程序所有者的权限。</p>
<h2 id="sgid"><a class="markdownIt-Anchor" href="#sgid"></a> SGID</h2>
<p>当 s 标志出现在文件所属组的 x 权限上时，被称为 Set GID。SGID 可以针对文件或目录来设置。</p>
<p><strong>针对文件</strong>，SGID 有以下功能：</p>
<ul>
<li>SGID 对二进制程序有效；</li>
<li>程序执行者对该程序来说，需要具备 x 的权限；</li>
<li><strong>执行者在执行的过程中将会获得该程序所属组的权限</strong>。</li>
</ul>
<p>例如，一般用户使用 <code>locate</code> 这个程序可以查询 <code>/var/lib/mlocate/mlocate.db</code> 文件的内容，会暂时获得 slocate 用户组的权限。</p>
<p><strong>针对目录</strong>，SGID 有以下功能：</p>
<ul>
<li>用户若对此目录具有 r 和 x 的权限时，该用户能够进入此目录；</li>
<li>用户在此目录下的有效用户组将会变成该目录的用户组；</li>
<li><strong>若用户在此目录下具有 w 的权限，则用户所创建的新文件的所属组与此目录的所属组相同。</strong></li>
</ul>
<h2 id="sbit"><a class="markdownIt-Anchor" href="#sbit"></a> SBIT</h2>
<p>当 t 出现在文件所有者的其他用户 x 权限上时，被称为 Sticky Bit。其含义为：</p>
<ul>
<li>SBIT 权限<strong>仅对目录有效</strong>；</li>
<li>当用户对该目录具有 w 和 x 权限时，即具有写入权限时；</li>
<li><strong>当用户在该目录下创建文件或目录时，仅有自己与 root 才有权力删除该文件。</strong></li>
</ul>
<p>例如，用户 1 对目录 A 具有 w 的权限，里面还有其他用户的文件。此时，目录 A 加上了 SBIT 权限时，用户 1 只能修改自己创建的文件，无法删除他人文件。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>计算机硬件基础</title>
    <url>/3847559470/</url>
    <content><![CDATA[<h1 id="计算机简介"><a class="markdownIt-Anchor" href="#计算机简介"></a> 计算机简介</h1>
<p>计算机是一种拥有输入和输出设备的机器，它可以通过输入设备接受用户的输入，并经过中央处理器的数学与逻辑单元的处理，将这些输入转换成有用的信息进行生成或储存。因此，计算机可以说是一种具有高度智能化的信息处理工具。</p>
<h2 id="计算机组成"><a class="markdownIt-Anchor" href="#计算机组成"></a> 计算机组成</h2>
<p>计算机通常由五大部分组成，它们分别是输入单元、输出单元、中央处理器（CPU）内部的控制单元、算术逻辑单元和内存。这些部分协同工作，使得计算机能够完成复杂的计算和数据处理任务。其中，输入单元用于接收用户的输入信息，输出单元用于向用户展示计算机处理结果，控制单元则负责控制计算机的整个运作过程，算术逻辑单元则处理计算机的算术和逻辑运算，而内存则用于储存数据和程序。这五大部分共同构成了现代计算机的核心。</p>
<h2 id="计算机分类"><a class="markdownIt-Anchor" href="#计算机分类"></a> 计算机分类</h2>
<p>根据用途的不同，计算机可以被分为以下几类：</p>
<ul>
<li>
<p><strong>超级计算机</strong>（Supercomputer）：</p>
<p>这是最快也最贵的计算机，通常用于需要进行高速计算的项目中，比如军事、气象、太空、模拟等。</p>
</li>
<li>
<p><strong>大型计算机</strong>（Mainframe Computer）：</p>
<p>这种计算机用于处理大规模的数据和复杂的运算，常见于证券、银行、大型企业数据库服务器等场所。</p>
</li>
<li>
<p><strong>迷你计算机</strong>（Minicomputer）：</p>
<p>迷你计算机是低配版的大型计算机，适用于那些场所环境要求不那么严格的场合，比如科研、工程分析、工厂等。</p>
</li>
<li>
<p><strong>工作站</strong>（Workstation）：</p>
<p>工作站是专门针对特定用途而设计的计算机，比如图形工作站、机器学习等。与个人电脑相比，工作站更强调稳定性。</p>
</li>
<li>
<p><strong>微型计算机</strong>（Microcomputer）：</p>
<p>微型计算机也称为个人计算机（PC），包括移动设备和桌面型电脑等。它们是普及度最高的计算机类型，广泛应用于个人和办公场所，具有性价比高和易于携带的优点。</p>
</li>
</ul>
<h1 id="cpu"><a class="markdownIt-Anchor" href="#cpu"></a> CPU</h1>
<p>中央处理器（CPU，Central Processing Unit）是计算机中最重要的组成部分之一，它是一个集成了微指令集和特定功能的芯片。CPU 通过执行指令来控制计算机的操作，包括算术逻辑运算、数据存储和检索等核心功能。因此，CPU 可以被认为是计算机的” 大脑 “，它的性能直接影响计算机的整体运行速度和效率。</p>
<h2 id="cpu-的组成单元"><a class="markdownIt-Anchor" href="#cpu-的组成单元"></a> CPU 的组成单元</h2>
<ul>
<li>
<p><strong>算术逻辑单元</strong></p>
<p>算术逻辑单元（ALU）是 CPU 中的一个重要组成部分，它主要负责执行算术运算和逻辑运算，如加、减、乘、除、与、或、非等。ALU 的运算结果将被存储在寄存器中，供其他单元继续使用。</p>
</li>
<li>
<p><strong>控制单元</strong></p>
<p>控制单元（CU）是 CPU 中的另一个重要组成部分，它主要负责协调和控制 CPU 各个单元之间的工作。CU 从内存中读取指令，并解析指令，然后根据指令的要求控制其他单元的操作。CU 还可以将运算结果写回内存或输出到外设。</p>
</li>
</ul>
<p>通过 ALU 和 CU 的紧密配合，CPU 能够实现各种复杂的计算和操作，从而实现计算机的各种功能。</p>
<h2 id="cpu-指令集"><a class="markdownIt-Anchor" href="#cpu-指令集"></a> CPU 指令集</h2>
<p>CPU 的指令集根据设计理念的不同，可以分为精简指令集（RISC）和复杂指令集（CISC）两种类型：</p>
<ul>
<li>
<p><strong>精简指令集</strong>（RISC，Reduced Instruction Set Computing）</p>
<p>精简指令集的微指令集比较简单明了，每个指令的执行时间都很短，完成的操作比较单一，执行效率高。常见的 RISC CPU 包括 Sun 公司的 SPARC 系列（主要用于学术和银行等大型工作站）、IBM 公司的 Power Architecture（包括 PowerPC，例如索尼 PS 游戏机）和 ARM 系列（主要用于手机、网络设备等嵌入式系统）。</p>
</li>
<li>
<p><strong>复杂指令集</strong>（CISC，Complex Instruction Set Computer）</p>
<p>复杂指令集的每个小指令可以执行一些较低阶的硬件操作，指令数目多而复杂，每条指令的长度不同，执行时间较长，但每个指令可以处理的工作较为丰富。常见的 CISC CPU 包括 AMD 和 Intel 的 x86、x64 架构处理器，其中 “x86” 是因为最早的 Intel 元组型号 8086 发展而来，架构从 8 位升级到 32 位，现在普遍使用的是 64 位 CPU，称为 x86_64 架构。</p>
</li>
</ul>
<p>不同的指令集在硬件设计和编程语言的选择上有所区别，选择适合自己需求的 CPU 和指令集对于系统的性能和稳定性有着重要的影响。</p>
<h2 id="微指令集"><a class="markdownIt-Anchor" href="#微指令集"></a> 微指令集</h2>
<p>除了硬件参数差异（比如二级缓存大小）外，不同 x86 架构的 CPU 还有微指令集的区别。例如，Intel 处理器具有独特的指令集，如用于虚拟化（Intel-VT）、视频硬解码（MMX，SSE）等，可以有效提高特定工作的运行效率。</p>
<p>选择适合自己需求的 CPU 和指令集对于系统的性能和稳定性都有着重要的影响。特定的微指令集能够支持特定的操作，例如 SSE 指令集可以提高多媒体应用程序的性能，因此在开发需要高性能计算的应用程序时需要仔细选择微指令集。</p>
<h2 id="多核心"><a class="markdownIt-Anchor" href="#多核心"></a> 多核心</h2>
<p>多核心是指将两个或更多的运算核心嵌入到一颗 CPU 封装中。与单核 CPU 相比，多核 CPU 可以同时执行更多的指令，从而提高系统的运行效率。多核心处理器广泛应用于需要高性能计算的领域，如科学研究、金融分析、人工智能等。同时，多核心处理器也可以提高普通用户在运行多任务时的体验，例如同时打开多个应用程序或运行多个虚拟机。</p>
<h2 id="cpu-频率"><a class="markdownIt-Anchor" href="#cpu-频率"></a> CPU 频率</h2>
<p>CPU 频率是指 CPU 每秒钟所执行的时钟周期数，通常以赫兹（Hz）为单位。频率越高表示 CPU 单位时间内可以执行更多的指令和计算任务。例如，CPU 的频率为 4.0 GHz 表示这颗 CPU 在一秒内可以执行 4 × 10^9 次时钟周期。</p>
<p>但是，CPU 频率并不是衡量 CPU 性能的唯一指标，还需要考虑 CPU 架构、核心数量、缓存大小、指令集支持等因素。相同频率的 CPU 在性能上可能存在巨大差异。因此，在选择 CPU 时需要全面考虑性能、功耗和预算等因素。</p>
<h2 id="南桥和北桥"><a class="markdownIt-Anchor" href="#南桥和北桥"></a> 南桥和北桥</h2>
<p>南桥和北桥是主板芯片组中的两个核心部件，它们起到协调 CPU 和其他系统组件之间通信的作用。</p>
<ul>
<li>
<p><strong>北桥</strong></p>
<p>北桥是主板芯片组中的一部分，负责连接 CPU 和内存、显卡等高速设备，以及提供系统总线。早期，北桥还包含了内存控制器等重要的子系统，但随着技术的进步，现在内存控制器已经整合到了 CPU 封装中，因此北桥的功能逐渐减弱。</p>
</li>
<li>
<p><strong>南桥</strong></p>
<p>南桥则负责连接低速设备接口，如硬盘、USB、网卡等，提供输入输出总线。此外，南桥还包括了一些重要的子系统，如硬盘控制器、USB 控制器、声卡等。</p>
</li>
</ul>
<p>在现代 CPU 架构中，北桥的功能已经被整合到了 CPU 封装中，因此南北桥已经不再是主板设计的必要组成部分。但是，南北桥的功能仍然存在于芯片组中，并且是支持 CPU 和其他系统组件之间通信的关键组件之一。</p>
<h2 id="32-位与-64-位"><a class="markdownIt-Anchor" href="#32-位与-64-位"></a> 32 位与 64 位</h2>
<p>CPU 的字组大小，也被称为 word size，指的是 CPU 每次能够处理的数据量。32 位 CPU 的字组大小基于 CPU 解析的大小，即 4 个字节。而 64 位 CPU 能够一次性读写 8 个字节（64 位）的数据。</p>
<p>通常情况下，CPU 的字组大小会影响总线宽度和内存读写能力。由于 32 位 CPU 的字组大小为 4 个字节，其最大寻址能力为 2^32 个字节，相当于 4GB。因此，最多只能支持 4GB 内存大小。相比之下，64 位 CPU 的字组大小为 8 个字节，其最大寻址能力为 2^64 个字节，相当于 16EB。因此，64 位 CPU 能够支持更大的内存容量。</p>
<h2 id="外频与倍频"><a class="markdownIt-Anchor" href="#外频与倍频"></a> 外频与倍频</h2>
<p>在早期的 CPU 架构中，北桥用于连接 CPU、内存和显卡设备，因此每个设备都必须与北桥连接，并且具有相同的工作频率。为了解决这个问题，前端总线（FSB，Front Side Bus）应运而生。然而，由于 CPU 的运算速度远远超过其他设备，因此需要使用外频和倍频来满足 FSB 的频率要求。</p>
<p>外频指的是 CPU 与外部元件进行数据传输时的速度。而倍频是 CPU 内部用来加速工作性能的一个倍数。</p>
<p>CPU 的实际频率可以通过以下公式计算：CPU 频率 = 外频 x 倍频。通过调整外频和倍频的值，可以提高 CPU 的性能。</p>
<h2 id="超线程"><a class="markdownIt-Anchor" href="#超线程"></a> 超线程</h2>
<p>超线程（HT，Hyper-Threading）是一种在 CPU 内部将重要的寄存器（register）分为两组的技术，使得每组寄存器都可以供程序使用。因此，两个程序可以同时竞争 CPU 的运算单元，而不需要通过操作系统的多任务切换。</p>
<p>通过 HT 机制，操作系统可以使用实际核心的两倍数量，并且让每个核心逻辑上分离。在支持多核心运行的程序时，只要运算达不到 100% 的 CPU 使用率，超线程确实能帮助提升执行速度，更好地利用 CPU 性能。</p>
<p>在某些情况下，超线程可能会降低性能，例如在 CPU 达到 100% 使用率时，超线程可能会增加 CPU 的开销并导致性能下降。</p>
<h2 id="多级缓存"><a class="markdownIt-Anchor" href="#多级缓存"></a> 多级缓存</h2>
<p>一般 CPU 拥有二级 (L2 Cache) 或更多级缓存，由比 DRAM 速度更快的静态随机访问内存 (SRAM, Static Random Access Memory) 组成，用于存放一些常用的数据。这样，数据可以不通过内存读取，从而大幅提升性能。</p>
<h1 id="内存"><a class="markdownIt-Anchor" href="#内存"></a> 内存</h1>
<p>CPU 处理的数据来源于内存，而处理完毕的数据也要先写回内存，再从内存传输到输出单元。</p>
<p>内存的主要组件是动态随机访问内存 (DRAM, Dynamic Random Access Memory)，只有在通电时才能记录和使用。由于断电后数据会消失，因此也被称为挥发性内存。</p>
<h2 id="内存类型"><a class="markdownIt-Anchor" href="#内存类型"></a> 内存类型</h2>
<p>内存从 SDRAM 发展为 DDR（Double Data Rate），也就是所谓的双倍数据传输速度 SDRAM，它可以在一次工作周期中进行两次数据传输。</p>
<p>例如 DDR400 的内存，代表数据宽度为 64bit，外频为 200MHz，频率为 400MHz，频宽为 3.2GB/s。</p>
<h2 id="内存速度"><a class="markdownIt-Anchor" href="#内存速度"></a> 内存速度</h2>
<p>内存工作频率由 CPU 内的内存控制器决定。例如，假如内存频率为 1600MHz，总线宽度为 64bit，理论最大传输速度为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>1600</mn><mi>M</mi><mi>H</mi><mi>z</mi><mo>∗</mo><mn>64</mn><mi>b</mi><mi>i</mi><mi>t</mi><mo>=</mo><mn>1600</mn><mi>M</mi><mi>H</mi><mi>z</mi><mo>∗</mo><mn>8</mn><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=</mo><mn>12800</mn><mi>M</mi><mi>B</mi><mi mathvariant="normal">/</mi><mi>s</mi><mo>=</mo><mn>12.8</mn><mi>G</mi><mi>B</mi><mi mathvariant="normal">/</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">1600MHz * 64bit = 1600MHz * 8Bytes = 12800MB/s = 12.8GB/s
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord">4</span><span class="mord mathnormal">b</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">8</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">.</span><span class="mord">8</span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord">/</span><span class="mord mathnormal">s</span></span></span></span></span></p>
<h2 id="多通道设计"><a class="markdownIt-Anchor" href="#多通道设计"></a> 多通道设计</h2>
<p>当两条同样的内存插入支持内存双通道的主板中时，总线宽度由 64bit 升级到 128bit，传输速度翻倍。这是双通道内存的设计理念。</p>
<p>除了双通道外，服务器提供三信道甚至四信道的内存环境。</p>
<h2 id="物理地址扩展"><a class="markdownIt-Anchor" href="#物理地址扩展"></a> 物理地址扩展</h2>
<p>物理地址扩展（PAE）是基于 x86 服务器的一种功能，它使运行 Windows Server 版本的计算机可以支持 4GB 以上物理内存。物理地址扩展允许将最多 64GB 的物理内存用作常规的 4 KB 页面，并扩展内核能使用的位数以将物理内存地址从 32 位扩展到 36 位。</p>
<h1 id="主板"><a class="markdownIt-Anchor" href="#主板"></a> 主板</h1>
<p>主板（Mainboard）是一种电脑硬件，由芯片组构成，用于沟通和连接各种设备，为 CPU 提供支持和资源。</p>
<p>现代主板一般集成了许多设备元件，如声卡、网卡、显卡、磁盘整合卡等。</p>
<h2 id="cmos-芯片"><a class="markdownIt-Anchor" href="#cmos-芯片"></a> CMOS 芯片</h2>
<p>CMOS 芯片是一种低功耗的、非易失性的芯片，它用于记录主板的重要参数，例如系统时间、CPU 频率、设备 I/O 地址和 IRQ 等信息。由于这些参数需要在断电后仍能保持，CMOS 芯片需要额外的电子供电来保存这些设置。</p>
<h2 id="bios"><a class="markdownIt-Anchor" href="#bios"></a> BIOS</h2>
<p>BIOS (Basic Input Output System) 是一种固化在主板上的程序，用于初始化和测试硬件设备，加载操作系统，并提供各种底层服务和功能。BIOS 存储在闪存（Flash Memory）或 EEPROM 中，可以在开机时被执行。主要用途是加载和修改 CMOS（Complementary Metal-Oxide Semiconductor）中的参数，例如系统时间、CPU 频率、设备 I/O 地址和 IRQ 等。同时，BIOS 也尝试调用存储设备中的开机程序，以启动操作系统。</p>
<p>通常在开机时按下 [del] 键或 [F1] 键可以进入 BIOS 设置界面，进行各种参数设置和硬件配置。</p>
<h2 id="uefi"><a class="markdownIt-Anchor" href="#uefi"></a> UEFI</h2>
<p>UEFI (Unified Extensible Firmware Interface) 是新一代的固件接口标准，相比于传统的 BIOS 更加先进。UEFI 可以使用一个特制的 shell 来做一些管理工作。</p>
<h2 id="固件"><a class="markdownIt-Anchor" href="#固件"></a> 固件</h2>
<p>固件 (firmware) 是绑定在硬件上的控制软件，例如磁盘阵列卡、网卡等。通常储存在只读存储器 (Read Only Memory, ROM) 中，以保证固件的安全性。</p>
<h2 id="pci-插槽"><a class="markdownIt-Anchor" href="#pci-插槽"></a> PCI 插槽</h2>
<p>主板上的扩展插槽主要有 PCI 和 PCI-E 两种类型，它们的速度和频宽如下：</p>
<table>
<thead>
<tr>
<th>规格</th>
<th>宽度 (bit)</th>
<th>速度 (MHz)</th>
<th>频宽</th>
</tr>
</thead>
<tbody>
<tr>
<td>PCI</td>
<td>32</td>
<td>33</td>
<td>133MB/s</td>
</tr>
<tr>
<td>PCI 2.2</td>
<td>64</td>
<td>66</td>
<td>533MB/s</td>
</tr>
<tr>
<td>PCI-X</td>
<td>64</td>
<td>133</td>
<td>1064MB/s</td>
</tr>
<tr>
<td>AGP 4x</td>
<td>32</td>
<td>66x4</td>
<td>1066MB/s</td>
</tr>
<tr>
<td>AGP 8x</td>
<td>32</td>
<td>66x8</td>
<td>2133MB/s</td>
</tr>
<tr>
<td>PCI-E 1.0 x4</td>
<td></td>
<td></td>
<td>1GB/s</td>
</tr>
<tr>
<td>PCI-E 2.0 x2</td>
<td></td>
<td></td>
<td>1GB/s</td>
</tr>
<tr>
<td>PCI-E 3.0 x1</td>
<td></td>
<td></td>
<td>1GB/s</td>
</tr>
<tr>
<td>PCI-E 4.0 x1</td>
<td></td>
<td></td>
<td>2GB/s</td>
</tr>
<tr>
<td>PCI-E 5.0 x1</td>
<td></td>
<td></td>
<td>4GB/s</td>
</tr>
</tbody>
</table>
<p>一般来说，PCI-E 的规格由插槽的长度决定，PCI-E 插槽的工作模式可以参考主板的说明书。如果将一个速度为 x16 的设备插在一个速度为 x8 的 PCI-E 插槽上，该设备将以 x8 的速度运行。</p>
<p>例如，一个 CPU 通常支持 16 个信道（PCI-E 3.0 x16），如果主板上有三个 PCI-E 插槽，那么 PCI-E 插槽的速度可以工作在以下模式：1 x16，2 x8，1 x8 + 2 x4，具体取决于插入的设备数量。</p>
<h2 id="usb-接口"><a class="markdownIt-Anchor" href="#usb-接口"></a> USB 接口</h2>
<p>USB 接口一般用来连接 U 盘、移动硬盘盒、键盘、鼠标等设备。各版本的带宽与速度对比如下：</p>
<table>
<thead>
<tr>
<th>版本</th>
<th>带宽</th>
<th>速度 (MB/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>USB 1.0</td>
<td>12 Mbit/s</td>
<td>1.5</td>
</tr>
<tr>
<td>USB 2.0</td>
<td>480 Mbit/s</td>
<td>60</td>
</tr>
<tr>
<td>USB 3.0</td>
<td>5 Gbit/s</td>
<td>500</td>
</tr>
<tr>
<td>USB 3.1</td>
<td>10 Gbit/s</td>
<td>1000</td>
</tr>
</tbody>
</table>
<p>为了方便区分版本，主板给 USB 接口采用不同颜色进行显示：白色代表 USB 2.0，蓝色代表 USB 3.0，红色代表 USB 3.1。</p>
<h2 id="其他接口"><a class="markdownIt-Anchor" href="#其他接口"></a> 其他接口</h2>
<p>主板上常见的其他接口如下：</p>
<ul>
<li>
<p><strong>音频输入与输出</strong></p>
<p>一些 3.5mm 圆形插孔，一般用绿色表示耳机插孔，粉红色表示麦克风输入插孔。</p>
</li>
<li>
<p><strong>RJ-45 网络接口</strong></p>
<p>方形接口，用来插入网线。</p>
</li>
<li>
<p><strong>HDMI 接口</strong></p>
<p>HDMI 接口一般用于视频输出。如果主板上有板载显卡，一般会提供该接口。</p>
</li>
</ul>
<h2 id="设备-io-地址与-irq-中断信道"><a class="markdownIt-Anchor" href="#设备-io-地址与-irq-中断信道"></a> 设备 I/O 地址与 IRQ 中断信道</h2>
<p>主板芯片组通过 I/O 地址和 IRQ 中断信道来控制设备。</p>
<ul>
<li>
<p><strong>I/O 地址</strong></p>
<p>I/O 地址用来标识对应的设备，如果两个设备使用相同的 I/O 地址会造成地址冲突，导致设备无法正常工作。</p>
</li>
<li>
<p><strong>IRQ 中断信道</strong></p>
<p>IRQ 用来标识设备工作状态，以方便 CPU 分配工作任务。每个设备都有自己的 IRQ 中断信道，当设备需要 CPU 处理时，会通过 IRQ 向 CPU 发出中断请求。CPU 会停止当前的任务，处理中断请求，并在完成处理后返回原先的任务。</p>
</li>
</ul>
<h1 id="显卡"><a class="markdownIt-Anchor" href="#显卡"></a> 显卡</h1>
<p>显卡是计算机中的一种重要的组件，主要负责图像和影像的显示，也被称为视频显卡（Video Card）或图形加速卡（Graphics Card）。</p>
<h2 id="显存"><a class="markdownIt-Anchor" href="#显存"></a> 显存</h2>
<p>由于每个图像需要占用内存空间来存储颜色信息，因此显卡上有一个专门用于存储图像信息的内存，称为显存。</p>
<h2 id="gpu"><a class="markdownIt-Anchor" href="#gpu"></a> GPU</h2>
<p>除了负责图像显示，显卡上还有一个专门用于进行 3D 运算的加速芯片，称为 GPU。</p>
<h2 id="显卡插槽"><a class="markdownIt-Anchor" href="#显卡插槽"></a> 显卡插槽</h2>
<p>由于显卡需要大量的数据传输，因此使用能提供高带宽的 PCI-E 插槽。</p>
<h2 id="显卡接口"><a class="markdownIt-Anchor" href="#显卡接口"></a> 显卡接口</h2>
<p>常见显卡上用来连接显示器的接口如下:</p>
<ul>
<li>
<p><strong>D-Sub(VGA)</strong></p>
<p>是较早之前的连接接口，主要为 15 针的连接，用于模拟信号传输。</p>
</li>
<li>
<p><strong>DVI</strong></p>
<p>有提供数字传输的 DVI-D 和整合数字和模拟传输的 DVI-I 两种类型。</p>
</li>
<li>
<p><strong>HDMI</strong></p>
<p>可以同时传输图像和声音。</p>
</li>
<li>
<p><strong>DP(DisplayPort)</strong></p>
<p>类似于 HDMI。</p>
</li>
</ul>
<h1 id="硬盘"><a class="markdownIt-Anchor" href="#硬盘"></a> 硬盘</h1>
<p>硬盘是计算机中用于存储数据的设备，一般分为机械硬盘和固态硬盘。</p>
<h2 id="机械硬盘的组成"><a class="markdownIt-Anchor" href="#机械硬盘的组成"></a> 机械硬盘的组成</h2>
<p>传统机械硬盘（HDD，Hard Disk Drive）的物理结构如下：</p>
<ul>
<li>
<p><strong>盘片</strong></p>
<p>数据记录介质，可以有一个或多个盘片。</p>
</li>
<li>
<p><strong>主轴电机</strong></p>
<p>带动盘片旋转，转速越高，读写速度越快。常见的转速有 7200 rpm（转 / 分钟）和 5400 rpm。</p>
</li>
<li>
<p><strong>读写磁头</strong></p>
<p>读取和写入数据，每个盘片面都有一个磁头。</p>
</li>
<li>
<p><strong>机械臂</strong></p>
<p>控制磁头的位置，使其能够读取或写入指定的盘片面。</p>
</li>
</ul>
<p>此外，硬盘电路板上还有一个小容量的闪存用作缓冲内存，用于临时提高硬盘性能。</p>
<p>机械硬盘非常脆弱，因此在通电状态下绝对不要发生碰撞或直接拔插电源线。否则可能会导致逻辑坏道（文件系统损坏）或物理坏道。</p>
<h2 id="机械硬盘盘片"><a class="markdownIt-Anchor" href="#机械硬盘盘片"></a> 机械硬盘盘片</h2>
<p>机械硬盘盘片的表面结构如下：</p>
<ul>
<li>
<p><strong>扇区（sector）</strong></p>
<p>盘片同心圆上切出的小块区域，是硬盘的最小物理存储单元。传统硬盘的扇区容量为 512 字节，而现代硬盘则采用了 4KB 扇区设计。</p>
</li>
<li>
<p><strong>磁道（track）</strong></p>
<p>盘片同心圆上的一个圆环，由一系列相同半径的扇区组成。</p>
</li>
<li>
<p><strong>柱面（cylinder）</strong></p>
<p>所有盘片同心圆上的同一磁道就构成一个柱面。</p>
</li>
</ul>
<p>由于同心圆外圈的扇区比内圈的扇区多，因此硬盘的数据读写是从外向内进行的。</p>
<p>传统机械硬盘的容量计算公式为：磁头数 * 柱面 * 扇区数 * 512Bytes</p>
<h2 id="硬盘传输接口"><a class="markdownIt-Anchor" href="#硬盘传输接口"></a> 硬盘传输接口</h2>
<p>硬盘与主板连接接口经过多次改版，目前主流的有 SATA 和 SAS 接口。</p>
<ul>
<li>
<p><strong>IDE 接口</strong></p>
<p>使用的平行线可以连接两个设备，因此有主 / 从 (Master/Slave) 构架，可以通过跳针设置。</p>
<p>接口传输速度为 Ultra 133 规格，理论速度最高 133MB/s。</p>
</li>
<li>
<p><strong>SATA 接口</strong></p>
<p>在家用机上 IDE 接口的替代接口。SATA 的平行线将数据传输和供电分开。一条平行线对应一个设备，没有跳针设计。</p>
<p>目前主流使用的 SATA 3.0 版本传输速度为 600MB/s。</p>
</li>
<li>
<p><strong>SCSI 接口</strong></p>
<p>在以前服务器硬盘常用接口。硬盘在控制器上含有一块处理器，用来支持一些高级功能。</p>
</li>
<li>
<p><strong>SAS 接口</strong></p>
<p>SAS（Serial Attached SCSI）是串行式 SCSI 的意思，目前已在服务器领域全面取代了 SCSI。</p>
<p>SAS 3.0 的传输速度能达到 1200MB/s。</p>
</li>
</ul>
<h2 id="固态硬盘"><a class="markdownIt-Anchor" href="#固态硬盘"></a> 固态硬盘</h2>
<p>固态硬盘 (SSD, Solid State Disk) 以 NAND 闪存作为储存介质，因此不存在机械硬盘的磁头、盘片等结构，也没有数据分散的问题，读写速度和延迟时间比机械硬盘更优秀。</p>
<p>固态硬盘的寿命和速度取决于使用的内存颗粒类型，常见的类型从好到差分别为 SLC、MLC、TLC、QLC。</p>
<p>一般而言，电脑使用固态硬盘作为系统盘，数据储存在机械硬盘上，可以有效提升整个系统性能。</p>
<h1 id="电源"><a class="markdownIt-Anchor" href="#电源"></a> 电源</h1>
<p>电源供应器（Power Supply Unit，PSU）用于给主板、CPU、显卡和硬盘等硬件供电。选择质量好的电源可以有效降低硬件意外损坏的概率。</p>
<p>如果使用诸如 AIDA 等软件对未超频的电脑进行测试时，在测试过程中出现中途断电或重启等情况，说明电源的额定功率不够或者不稳定。需要减少设备连接或者更换更高功率的电源。</p>
<p>在选购电源时，除了考虑电源的额定功率之外，还需要考虑能源转换率，也就是 $ 输入功率 / 输出功率 $ 的值。转换率值越大越好。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>磁盘分区知识</title>
    <url>/3200821655/</url>
    <content><![CDATA[<h1 id="磁盘设备名"><a class="markdownIt-Anchor" href="#磁盘设备名"></a> 磁盘设备名</h1>
<p>在新版 Linux 中，IDE 和 SATA 的磁盘命名没有区别。</p>
<h2 id="ide-接口硬盘"><a class="markdownIt-Anchor" href="#ide-接口硬盘"></a> IDE 接口硬盘</h2>
<p>由于一个 IDE 接口可以连接两个 IDE 设备，一般主板可以接 4 个 IDE 设备。在系统中，IDE 设备的命名如下：</p>
<table>
<thead>
<tr>
<th><strong>IDE(Jumper)</strong></th>
<th><strong>Master</strong></th>
<th><strong>Slave</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>IDE1(Primary)</td>
<td>/dev/hda</td>
<td>/dev/hdb</td>
</tr>
<tr>
<td>IDE2(Secondary)</td>
<td>/dev/hdc</td>
<td>/dev/hdd</td>
</tr>
</tbody>
</table>
<h2 id="sata-接口硬盘"><a class="markdownIt-Anchor" href="#sata-接口硬盘"></a> SATA 接口硬盘</h2>
<p>SATA 接口设备名由 Linux 内核检测到磁盘的顺序从 a 开始排列，与插槽号无关。例如，两块磁盘插到 SATA1 和 SATA5 插槽上，系统中识别为 sda 和 sdb。</p>
<h1 id="磁盘阵列"><a class="markdownIt-Anchor" href="#磁盘阵列"></a> 磁盘阵列</h1>
<p>磁盘阵列（RAID，Redundant Arrays of Inexpensive Disks）即容错廉价磁盘阵列，指通过一些技术（软件或硬件）将多个较小的磁盘整合成一个较大的磁盘设备，并且具有一定数据保护的功能。</p>
<h2 id="磁盘阵列类型"><a class="markdownIt-Anchor" href="#磁盘阵列类型"></a> 磁盘阵列类型</h2>
<p>磁盘整列有两种组建方式。</p>
<h3 id="硬件磁盘阵列"><a class="markdownIt-Anchor" href="#硬件磁盘阵列"></a> 硬件磁盘阵列</h3>
<p>硬件（hardware）磁盘阵列通过磁盘阵列卡完成组建任务，拥有专门芯片来处理 RAID 任务。性能比较好，例如用来处理 RAID 5 的同位检查码计算，并不会重复消耗原本系统的 I/O 总线。硬件磁盘阵列的设备文件名为/dev/sd[a-p]。</p>
<h3 id="软件磁盘阵列"><a class="markdownIt-Anchor" href="#软件磁盘阵列"></a> 软件磁盘阵列</h3>
<p>软件（software）磁盘阵列利用软件来仿真磁盘阵列功能，与 CPU 运算和 I/O 总线速度关系很大。在 CentOS 中提供的软件磁盘阵列软件为 mdadm，支持以分区为单位组建 RAID0/1/5 等。软件磁盘阵列使用的设备文件名是系统的设备文件/dev/md[0-1]。</p>
<h2 id="磁盘阵列等级"><a class="markdownIt-Anchor" href="#磁盘阵列等级"></a> 磁盘阵列等级</h2>
<p>常见磁盘阵列等级有 4 种：RAID 0（等量模式，stripe）、RAID 1（映像模式，mirror）、RAID 0+1 或 RAID 1+0、RAID 5。</p>
<h3 id="raid-0"><a class="markdownIt-Anchor" href="#raid-0"></a> RAID 0</h3>
<p>此模式下，RAID 会将磁盘先切出等量的区块（名为 chunk，大小 4KB ~ 1MB），写入文件时，该文件依据块大小切割好，依序放到各个磁盘中去。</p>
<p>磁盘可用容量为所有磁盘容量之和。</p>
<p>读写性能最佳。</p>
<p>安全性最糟，任意一块磁盘损坏，所有文件数据将缺损，所有数据都会丢失。</p>
<h3 id="raid-1"><a class="markdownIt-Anchor" href="#raid-1"></a> RAID 1</h3>
<p>此模式让同一份数据完整保存在两块磁盘上面，写入文件时，该文件复制为两份，并分别写入到各个磁盘中去。</p>
<p>磁盘可用容量为所有磁盘容量之和的一半。</p>
<p>写性能在使用软阵列时不好，因为南桥芯片的 I/O 性能有限，同时写入会导致带宽不够。读取性能和 RAID 0 一样。</p>
<p>安全性最好。</p>
<h3 id="raid-01raid-10"><a class="markdownIt-Anchor" href="#raid-01raid-10"></a> RAID 0+1，RAID 1+0</h3>
<p>所谓 RAID 0+1 就是先让两块磁盘组成 RAID 0，再将两组 RAID 0 组成一组 RAID 1。RAID 1+0 则是先组 RAID 0，再组成 RAID 1。</p>
<p>磁盘可用容量和 RAID 1 一样只有一半可用。</p>
<p>读写性能和 RAID 0 一样。</p>
<p>安全性和 RAID 1 一样。</p>
<h3 id="raid-5"><a class="markdownIt-Anchor" href="#raid-5"></a> RAID 5</h3>
<p>至少需要三块以上磁盘才能组建。在每个循环的写入过程中，每块磁盘还加入一个同位检查数据（Parity），这个数据会记录其他磁盘的备份数据，用于磁盘损坏时的恢复。</p>
<p>磁盘可用容量为总磁盘容量减一块磁盘容量。</p>
<p>读写取性能介于 RAID 1 和 RAID 0 之间。</p>
<p>安全性能方面，只接受损坏不超过一块的硬盘情况下恢复数据。</p>
<h2 id="预备磁盘"><a class="markdownIt-Anchor" href="#预备磁盘"></a> 预备磁盘</h2>
<p>磁盘阵列中的磁盘损坏时，可更换坏掉的磁盘并插入新的磁盘，磁盘阵列会主动重建数据。这通常需要在关机重启时进行，但 SAS 支持热插拔，可以避免重启。</p>
<p>为实现系统实时主动重建，需要预备磁盘。预备磁盘是指一块或多块未包含在原磁盘阵列等级中的磁盘。只有在磁盘阵列中出现磁盘损坏时，才会主动将预备磁盘引入磁盘阵列中进行数据重建。</p>
<h1 id="逻辑卷管理器"><a class="markdownIt-Anchor" href="#逻辑卷管理器"></a> 逻辑卷管理器</h1>
<p>逻辑卷管理器（LVM，Logical Volume Manager）通过软件组合几个物理分区（PV），将它们称为一块看起来是独立的大磁盘（VG），然后再将这块大磁盘分成可使用分区（LV），最终挂载使用。</p>
<h2 id="物理卷"><a class="markdownIt-Anchor" href="#物理卷"></a> 物理卷</h2>
<p>物理卷（PV，Physical Volume）分区需要通过 <code>fdisk</code> 调整系统标识符（system ID）为 8e（LVM 的标识符），然后通过 <code>pvcreate</code> 命令将其转换为 LVM 的最底层物理卷（PV），才能利用这些 PV。</p>
<h2 id="卷用户组"><a class="markdownIt-Anchor" href="#卷用户组"></a> 卷用户组</h2>
<p>LVM 将许多 PV 整合成卷用户组(VG，Volume Group)，在 32 位系统下每个 VG 最多仅能包含 65534 个 PE。如果使用 LVM 默认参数，则一个 VG 最大可达 256GB 容量。在 64 位系统下已不存在限制。</p>
<h2 id="物理扩展块"><a class="markdownIt-Anchor" href="#物理扩展块"></a> 物理扩展块</h2>
<p>LVM 默认使用 4MB 的物理扩展块（PE，即 Physical Extent），它是整个 LVM 中最小的存储块，类似于文件系统中的 block 大小。</p>
<h2 id="逻辑卷"><a class="markdownIt-Anchor" href="#逻辑卷"></a> 逻辑卷</h2>
<p>VG 会被切分成逻辑卷（LV，即 Logical Volume），这个 LV 就是最后可以被格式化使用的分区。</p>
<p>LV 的大小与此 LV 内的 PE 总数有关。</p>
<p>为了方便用户利用 LVM 管理其系统，LV 的设备文件名通常指定为 <code>/dev/vgname/lvname</code> 的样式。</p>
<p>更改文件系统容量本质是通过交换 PE 来进行数据转换，将原本 LV 内的 PE 转移到其他设备中以降低 LV 容量，或将其他设备的 PE 加到此 LV 中以增大容量。</p>
<p>对 LV 数据写入机制有两种：</p>
<ul>
<li>
<p><strong>线性模式</strong>（linear）：如果有两个分区 sdb1 和 sdb2 加入到 VG 中，并且整个 VG 只有一个 LV 时，数据会先将 sdb1 写满，再开始写 sdb2。</p>
</li>
<li>
<p><strong>交错模式</strong>（striped）：类似于 RAID 0 的模式，同时向两个分区内写入数据。</p>
</li>
</ul>
<p>LVM 的重点在于可以弹性调整文件系统容量，而不是性能优先，因此默认使用线性模式进行读写。</p>
<h1 id="mbr-分区表"><a class="markdownIt-Anchor" href="#mbr-分区表"></a> MBR 分区表</h1>
<p>目前主流分区表格式有 MBR 和 GPT。早期的 Linux 系统为了兼容 Windows 磁盘，使用的是支持 Windows 的 MBR。</p>
<p>MBR 分区表无法支持 2T 以上容量的硬盘。</p>
<h2 id="第一个扇区"><a class="markdownIt-Anchor" href="#第一个扇区"></a> 第一个扇区</h2>
<p>MBR 分区表第一个扇区（512Bytes）用来记录三个重要的信息：</p>
<ul>
<li>
<p><strong>主引导分区</strong>（MBR，Master Boot Record）：用来安装引导加载程序的地方，有 446Bytes 大小。</p>
</li>
<li>
<p><strong>分区表</strong>（Partition Table）：记录整块硬盘的分区状态，有 64Bytes 大小。</p>
</li>
<li>
<p><strong>引导记录标识</strong>（BRID）：用来判断设备是否可以用于启动，只有 2 Bytes 大小。值为 55 或 AA 表示可引导。</p>
</li>
</ul>
<p>如果第一个扇区出现物理坏道，整块硬盘都不可用。</p>
<h2 id="主引导分区"><a class="markdownIt-Anchor" href="#主引导分区"></a> 主引导分区</h2>
<p>MBR 只有 446Bytes，主要提供以下功能：</p>
<ul>
<li>提供菜单，可以选择不同开机选项，实现多重引导；</li>
<li>载入内核文件，指向可开机的程序区段开启动系统；</li>
<li>转交其他 Loader，将引导加载功能转交给其他 Loader 负责。</li>
</ul>
<h2 id="分区表"><a class="markdownIt-Anchor" href="#分区表"></a> 分区表</h2>
<p>分区表记录了每个分区的起始柱面号，分区只是针对那 64Bytes 的分区表进行设置。由于只有 64Bytes 大小，所以仅能写入四组分区信息。这四组分区信息分为主（Primary）或扩展（Extended）分区。</p>
<p>主分区和扩展分区在 Linux 系统中表示为 <code>sda[1-4]</code>。</p>
<p>分区的最小单位为柱面（Cylinder），通常每个分区都包含一个或多个柱面。</p>
<h2 id="扩展分区"><a class="markdownIt-Anchor" href="#扩展分区"></a> 扩展分区</h2>
<p>扩展分区是指利用额外的扇区来记录分区信息，但无法进行格式化。可以在扩展分区中创建逻辑分区，具体做法是在每个逻辑分区的最前面几个扇区记录分区信息。需要注意的是，一个磁盘最多只能有一个扩展分区，这是操作系统的限制。</p>
<p>为了确保磁盘的连续性，通常将扩展分区的柱面号分配在所有主分区之后。这样可以更好地利用磁盘空间，并有助于提高磁盘读写效率。</p>
<h2 id="逻辑分区"><a class="markdownIt-Anchor" href="#逻辑分区"></a> 逻辑分区</h2>
<p>从扩展分区分出的分区也称为逻辑分区（Logical Partition）。在 Linux 系统中，逻辑分区从 hda5 开始计算。</p>
<p>在一个扩展分区内，相邻的逻辑分区可以合并。如果不相邻，则只能重建扩展分区。</p>
<p>需要注意的是，如果扩展分区被破坏，所有的逻辑分区将被删除，因为逻辑分区的信息都记录在扩展分区中。</p>
<h1 id="gpt-分区表"><a class="markdownIt-Anchor" href="#gpt-分区表"></a> GPT 分区表</h1>
<p>GPT 分区表是为了适应 4K 扇区的硬盘和固态硬盘而设计的，它抛弃了原先以柱面为单位的计算法，改用逻辑区块位址（LBA，Logical Block Address）来规划分区。默认大小为 512Bytes，第一个 LBA 为 LBA0。</p>
<p>GPT 分区表使用前 34 个 LBA 区块来记录分区信息。此外，磁盘最后 33 个 LBA 区块会用于存储分区表备份，以保障分区信息的安全。</p>
<h2 id="mbr-兼容区块"><a class="markdownIt-Anchor" href="#mbr-兼容区块"></a> MBR 兼容区块</h2>
<p>GPT 分区表中的 LBA0 用来兼容 MBR 格式。不同之处在于，原本分区表记录段仅放入一个特殊标志的分区，用来表示此磁盘为 GPT 磁盘。</p>
<h2 id="gpt-表头记录"><a class="markdownIt-Anchor" href="#gpt-表头记录"></a> GPT 表头记录</h2>
<p>GPT 分区表中的 LBA1 记录了分区表本身的位置和大小，备份分区表存放位置，以及分区表校验机制码（CRC32）。如果系统检测到分区表有错误，可以通过这个记录区来获取备份分区表并进行恢复。</p>
<h2 id="分区表-2"><a class="markdownIt-Anchor" href="#分区表-2"></a> 分区表</h2>
<p>分区表存放在 LBA2-33 位置。从 LBA2 开始，每个 LBA 都可以记录 4 笔分区记录，所以默认可以记录 128 个分区记录。</p>
<p>每笔记录占用 128 字节空间，具体内容如下表：</p>
<table>
<thead>
<tr>
<th>起始字节</th>
<th>长度</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>16 字节</td>
<td>分区类型 GUID</td>
</tr>
<tr>
<td>16</td>
<td>16 字节</td>
<td>分区 GUID</td>
</tr>
<tr>
<td>32</td>
<td>8 字节</td>
<td>起始 LBA（小端序）</td>
</tr>
<tr>
<td>40</td>
<td>8 字节</td>
<td>末尾 LBA</td>
</tr>
<tr>
<td>48</td>
<td>8 字节</td>
<td>属性标签（如 bit60 表示“只读”）</td>
</tr>
<tr>
<td>56</td>
<td>72 字节</td>
<td>分区名，可以包括 36 个 UTF-16（小端序）字符</td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>Linux</category>
        <category>0.基础概论</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 下压缩和解压文件</title>
    <url>/635683850/</url>
    <content><![CDATA[<h1 id="常见压缩格式"><a class="markdownIt-Anchor" href="#常见压缩格式"></a> 常见压缩格式</h1>
<p>各种压缩工具使用的压缩技术不同，最后生成的文件后缀也不同，下面是 Linux 下常用的几种压缩格式：</p>
<table>
<thead>
<tr>
<th>后缀</th>
<th>对应程序</th>
</tr>
</thead>
<tbody>
<tr>
<td>*.Z</td>
<td>compress 程序压缩的文件</td>
</tr>
<tr>
<td>*.zip</td>
<td>zip 程序压缩的文件</td>
</tr>
<tr>
<td>*.gz</td>
<td>gzip 程序压缩的文件</td>
</tr>
<tr>
<td>*.bz2</td>
<td>bzip2 程序压缩的文件</td>
</tr>
<tr>
<td>*.xz</td>
<td>xz 程序压缩的文件</td>
</tr>
<tr>
<td>*.tar</td>
<td>tar 程序打包的数据，没有经过压缩</td>
</tr>
<tr>
<td>*.tar.gz</td>
<td>tar 程序打包的文件，经过 gzip 的压缩</td>
</tr>
<tr>
<td>*.tar.bz2</td>
<td>tar 程序打包的文件，经过 bzip2 的压缩</td>
</tr>
<tr>
<td>*.tar.xz</td>
<td>tar 程序打包的文件，经过 xz 的压缩</td>
</tr>
</tbody>
</table>
<p>gzip 和 bzip2 都只能针对单个文件进行压缩和解压缩，而 tar 可以调用它们来集中打包文件。</p>
<h1 id="单文件压缩解压"><a class="markdownIt-Anchor" href="#单文件压缩解压"></a> 单文件压缩解压</h1>
<p><code>compress</code> 程序已经不再被使用，<code>gzip</code> 为系统内置程序，可用的参数有下面这些：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-c</td>
<td>将压缩的数据输出到屏幕上，可通过数据流重定向来处理</td>
</tr>
<tr>
<td>-d</td>
<td>解压缩的参数</td>
</tr>
<tr>
<td>-t</td>
<td>可以检验压缩包看有无损坏</td>
</tr>
<tr>
<td>-v</td>
<td>可以显示出源文件/压缩文件的压缩比等信息</td>
</tr>
<tr>
<td>-#</td>
<td>压缩等级，-1 最快，-9 压缩比最高</td>
</tr>
</tbody>
</table>
<p>例如压缩当前目录下的 b.log 文件，不加参数会自动删除原文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ ll
total <span class="token number">184</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep  <span class="token number">9</span> 05:48 b.log
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">178</span> Sep  <span class="token number">9</span> 05:57 c.log
<span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">gzip</span> <span class="token parameter variable">-v</span> b.log 
b.log:   <span class="token number">93.2</span>% -- replaced with b.log.gz
<span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ ll
total <span class="token number">20</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">12439</span> Sep  <span class="token number">9</span> 05:48 b.log.gz
-rw-r--r--. <span class="token number">1</span> root root   <span class="token number">178</span> Sep  <span class="token number">9</span> 05:57 c.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>-d</code> 参数将文件解压时会删除原压缩文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">gzip</span> <span class="token parameter variable">-d</span> b.log.gz <span class="token punctuation">;</span> ll
total <span class="token number">184</span>
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep  <span class="token number">9</span> 05:48 b.log
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">178</span> Sep  <span class="token number">9</span> 05:57 c.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>将文件按最高压缩比压缩并保留原文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">gzip</span> <span class="token parameter variable">-9</span> <span class="token parameter variable">-c</span> b.log <span class="token operator">></span> b.gz <span class="token punctuation">;</span> ll
total <span class="token number">196</span>
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">11764</span> Sep <span class="token number">10</span> <span class="token number">11</span>:09 b.gz
-rw-------. <span class="token number">1</span> root root <span class="token number">182023</span> Sep  <span class="token number">9</span> 05:48 b.log
-rw-r--r--. <span class="token number">1</span> root root    <span class="token number">178</span> Sep  <span class="token number">9</span> 05:57 c.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>读取被压缩的纯文本文件可以使用 <code>zcat</code> 命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ zcat b.gz <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-2</span>
<span class="token assign-left variable">type</span><span class="token operator">=</span>CRED_DISP <span class="token assign-left variable">msg</span><span class="token operator">=</span>audit<span class="token punctuation">(</span><span class="token number">1631178061.322</span>:415<span class="token punctuation">)</span>: <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">60628</span> <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">auid</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ses</span><span class="token operator">=</span><span class="token number">22</span> <span class="token assign-left variable">subj</span><span class="token operator">=</span>system_u:system_r:crond_t:s0-s0:c0.c1023 <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">'op=PAM:setcred grantors=pam_env,pam_unix acct="root" exe="/usr/sbin/crond" hostname=? addr=? terminal=cron res=success'</span>
<span class="token assign-left variable">type</span><span class="token operator">=</span>USER_END <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>bzip2</code> 和 <code>xz</code> 的用法与 <code>gzip</code> 差不多，只是在压缩比上有区别。</p>
<h1 id="打包命令"><a class="markdownIt-Anchor" href="#打包命令"></a> 打包命令</h1>
<p>使用<code>gzip</code>对目录进行压缩时，其会将目录内的所有文件分别压缩。</p>
<p>将多个文件或目录包成一个大文件的命令称为打包，可以使用 <code>tar</code> 进行。</p>
<p><code>tar</code> 命令五个主要参数必备其一，不可以同时使用：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-c</td>
<td>新建打包文件；</td>
</tr>
<tr>
<td>-t</td>
<td>查看打包文件的内容含有哪些文件；</td>
</tr>
<tr>
<td>-x</td>
<td>解压打包文件，搭配-C 指定解压到的目录；</td>
</tr>
<tr>
<td>-r</td>
<td>向压缩归档文件末尾追加文件；</td>
</tr>
<tr>
<td>-u</td>
<td>更新原压缩包中的文件。</td>
</tr>
</tbody>
</table>
<p><code>tar</code> 命令其他参数，其中 <code>-f</code> 是必备：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-j</td>
<td>通过<code>bzip2</code>的支持进行压缩解压，文件最好用<code>.tar.bz2</code>后缀；</td>
</tr>
<tr>
<td>-z</td>
<td>通过<code>gzip</code>的支持进行压缩解压，文件最好用<code>.tar.gz</code>后缀；</td>
</tr>
<tr>
<td>-J</td>
<td>通过<code>xz</code>的支持进行压缩解压，文件最好用<code>.tar.xz</code>后缀；</td>
</tr>
<tr>
<td>-v</td>
<td>在压缩解压过程中，将正在处理的文件名显示出来；</td>
</tr>
<tr>
<td>-f filename</td>
<td>接要被处理的文件名；</td>
</tr>
<tr>
<td>-C dir</td>
<td>解压时指定目标目录，不指定则在当前目录解压。</td>
</tr>
</tbody>
</table>
<p>备份时要用到的参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-p</td>
<td>保留备份数据的原本权限和属性，常用于备份重要的配置文件；</td>
</tr>
<tr>
<td>-P</td>
<td>保留绝对路径，即允许备份数据中含有根目录；</td>
</tr>
<tr>
<td>–exclude=FILE</td>
<td>压缩过程中，排除掉文件 <code>FILE</code>。</td>
</tr>
</tbody>
</table>
<p>命令简记如下：</p>
<table>
<thead>
<tr>
<th>目标</th>
<th>命令</th>
</tr>
</thead>
<tbody>
<tr>
<td>压缩</td>
<td><code>tar -zcvf 压缩文件名.tar.gz 原文件</code></td>
</tr>
<tr>
<td>解压</td>
<td><code>tar -zxvf 压缩文件名.tar.gz -C 目标目录</code></td>
</tr>
<tr>
<td>查询</td>
<td><code>tar -ztvf 压缩文件名.tar.gz</code></td>
</tr>
</tbody>
</table>
<h1 id="压缩文件"><a class="markdownIt-Anchor" href="#压缩文件"></a> 压缩文件</h1>
<p>例如，使用 <code>gzip</code> 压缩备份 <code>/etc</code> 这个目录到 <code>/root</code> 下面，使用 <code>-p</code> 参数保留源文件权限和属性：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zpcv</span> <span class="token parameter variable">-f</span> /root/etc.tar.gz /etc
/etc/vimoutlinerrc
/etc/ntp.conf
/etc/updatedb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>压缩时排除某些文件可以用 <code>--exclude=</code> 参数。例如，排除掉 <code>22</code> 文件夹：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zcv</span> <span class="token parameter variable">-f</span> <span class="token number">2</span>.tar.gz <span class="token parameter variable">--exclude</span><span class="token operator">=</span>/root/2/22 /root/2
tar: Removing leading `/' from member names
/root/2/
/root/2/1.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以使用<code>--new</code>（包含<code>mtime</code>和<code>ctime</code>）和<code>--newer-mtime</code>时间参数来筛选文件。</p>
<p>比如打包<code>/root/audit/</code>下面修改日期在<code>2021年09月10日</code>之后的文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 audit<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zcv</span> <span class="token parameter variable">-f</span> new10.tar.gz --newer-mtime<span class="token operator">=</span><span class="token string">"2021/09/10"</span> /root/audit/*
tar: Option --newer-mtime: Treating <span class="token function">date</span> <span class="token variable"><span class="token variable">`</span><span class="token number">2021</span>/09/10' as <span class="token number">2021</span>-09-10 00:00:00
tar: Removing leading <span class="token variable">`</span></span>/' from member names
tar: /root/audit/b.log: <span class="token function">file</span> is unchanged<span class="token punctuation">;</span> not dumped
/root/audit/c.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="查看压缩包"><a class="markdownIt-Anchor" href="#查看压缩包"></a> 查看压缩包</h1>
<p>使用以下命令可以查看压缩文件的内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-ztv</span> <span class="token parameter variable">-f</span> /root/etc.tar.gz 
-rw-r--r-- root/root       <span class="token number">111</span> <span class="token number">2019</span>-11-27 <span class="token number">11</span>:47 etc/sysconfig/ntpdate
-rw-r--r-- root/root        <span class="token number">45</span> <span class="token number">2019</span>-11-27 <span class="token number">11</span>:47 etc/sysconfig/ntpd
drwxr-xr-x root/root         <span class="token number">0</span> <span class="token number">2021</span>-09-07 <span class="token number">13</span>:35 etc/xdg/
drwxr-xr-x root/root         <span class="token number">0</span> <span class="token number">2018</span>-04-11 00:59 etc/xdg/autostart/
drwxr-xr-x root/root         <span class="token number">0</span> <span class="token number">2021</span>-09-07 05:53 etc/xdg/systemd/
lrwxrwxrwx root/root         <span class="token number">0</span> <span class="token number">2021</span>-09-07 05:53 etc/xdg/systemd/user -<span class="token operator">></span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/systemd/user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从显示结果可以看到根目录，也就是文件名开头的 <code>/</code> 被移除了，这样做是为了安全。</p>
<p>如果使用 <code>-P</code> 保留根目录，则解压后的文件会是绝对路径，本地存在的相同文件会被压缩包内文件覆盖。</p>
<h1 id="解压文件"><a class="markdownIt-Anchor" href="#解压文件"></a> 解压文件</h1>
<p>解压缩文件 <code>etc.tar.gz</code> 到 <code>/tmp</code> 目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zxv</span> <span class="token parameter variable">-f</span> etc.tar.gz <span class="token parameter variable">-C</span> /tmp
etc/gdbinit.d/golang.gdb
etc/vimoutlinerrc
etc/ntp.conf
etc/updatedb.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解压 <code>etc.tar.gz</code> 中的单独文件 <code>etc/sudo.conf</code> 到当前目录：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">tar</span> <span class="token parameter variable">-zxv</span> <span class="token parameter variable">-f</span> etc.tar.gz etc/sudo.conf
etc/sudo.conf
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ ll etc/
total <span class="token number">4</span>
-rw-r-----. <span class="token number">1</span> root root <span class="token number">1786</span> Sep <span class="token number">30</span>  <span class="token number">2020</span> sudo.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 下挂载操作</title>
    <url>/848908018/</url>
    <content><![CDATA[<h1 id="常用设备名"><a class="markdownIt-Anchor" href="#常用设备名"></a> 常用设备名</h1>
<p>设备在 Linux 系统中显示为文件，常见设备以及设备在系统中文件名如下：</p>
<table>
<thead>
<tr>
<th>设备</th>
<th>设备在系统内的文件名</th>
</tr>
</thead>
<tbody>
<tr>
<td>IDE 硬盘</td>
<td>/dev/hd[a-d]</td>
</tr>
<tr>
<td>SCSI/SATA/USB 硬盘</td>
<td>/dev/sd[a-p]</td>
</tr>
<tr>
<td>U 盘</td>
<td>/dev/sd[a-p]</td>
</tr>
<tr>
<td>软驱</td>
<td>/dev/fd[0-7]</td>
</tr>
<tr>
<td>打印机</td>
<td>25 针：/dev/lp[0-2] USB：/dev/usb/lp[0-15]</td>
</tr>
<tr>
<td>鼠标</td>
<td>USB：/dev/usb/mouse[0-15] PS2：/dev/psaux</td>
</tr>
<tr>
<td>当前 CD/DVD ROM</td>
<td>/dev/cdrom</td>
</tr>
<tr>
<td>当前鼠标</td>
<td>/dev/mouse</td>
</tr>
<tr>
<td>磁带机</td>
<td>IDE：/dev/ht0 SCSI：/dev/st0</td>
</tr>
</tbody>
</table>
<h1 id="挂载点"><a class="markdownIt-Anchor" href="#挂载点"></a> 挂载点</h1>
<p>在 Linux 中，挂载是将一个目录作为进入点，将磁盘分区的数据放置在该目录下，进入该目录等同于读取该分区中的内容。进入点的目录被称为挂载点，也就是虚拟目录中用于分配额外存储设备的目录。</p>
<p>例如，磁盘 1 挂载到根目录<code>/</code>，磁盘 2 挂载到<code>/ext333</code>目录，则<code>/ext333</code>目录下的文件最上层目录是<code>/ext333</code>，而不是<code>/</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ext333<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token parameter variable">-lid</span> /ext333/
<span class="token number">2</span> drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">4096</span> Sep  <span class="token number">9</span> <span class="token number">15</span>:37 /ext333/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>ext</code>文件系统最顶层目录的 inode 一般为 2 号，而<code>xfs</code>文件系统最顶层目录的 inode 一般为 128 号。由于同一个文件系统中某个 inode 只会对应一个文件，因此可以通过 inode 号码来确认不同文件名是否为相同文件。</p>
<h1 id="挂载设备"><a class="markdownIt-Anchor" href="#挂载设备"></a> 挂载设备</h1>
<p>硬盘格式化后需要挂载在目录中才能访问，磁盘挂载前需要注意以下事项：</p>
<ul>
<li>单一文件系统不应该被重复挂载在不同的挂载点（目录）中。</li>
<li>单一目录不应该重复挂载多个文件系统。</li>
<li>作为挂载点的目录理论上应该都是空目录。</li>
</ul>
<p>如果用于挂载的目录不为空，则挂载文件系统后，原目录下的内容将暂时无法访问。</p>
<p><code>mount</code>命令可用选项如下：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a</code></td>
<td>依照配置文件<code>/etc/fstab</code>的数据将所有未挂载的磁盘都挂载上来</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>显示 Label 名称</td>
</tr>
<tr>
<td><code>-t</code></td>
<td>加上文件系统类型来指定欲挂载的类型</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>默认系统会将实时挂载的情况实时写入<code>/etc/mtab</code>中。<code>-n</code>可以取消写入</td>
</tr>
<tr>
<td><code>-L</code></td>
<td>利用文件系统的卷标名来挂载</td>
</tr>
<tr>
<td><code>-o</code></td>
<td>后面接一些挂载时额外加上的参数，比如账号、密码、权限等</td>
</tr>
</tbody>
</table>
<p><code>-o</code>后接的可挂载参数如下：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ro</code>/<code>rw</code></td>
<td>挂载为只读或可读写</td>
</tr>
<tr>
<td><code>async</code>/<code>sync</code></td>
<td>修改默认写入方式同步或异步，默认异步</td>
</tr>
<tr>
<td><code>auto</code>/<code>noauto</code></td>
<td>允许此分区被以<code>mount -a</code>自动挂载</td>
</tr>
<tr>
<td><code>dev</code>/<code>nodev</code></td>
<td>是否允许分区上可创建设备文件，<code>dev</code>为允许</td>
</tr>
<tr>
<td><code>suid</code>/<code>nosuid</code></td>
<td>是否允许含有 suid/sgid 的文件格式</td>
</tr>
<tr>
<td><code>exec</code>/<code>noexec</code></td>
<td>是否允许拥有可执行文件</td>
</tr>
<tr>
<td><code>user</code>/<code>nouser</code></td>
<td>是否允许此分区让任何用户执行<code>mount</code>，一般只有<code>root</code>可用<code>mount</code></td>
</tr>
<tr>
<td><code>defaults</code></td>
<td>默认值为<code>rw</code>，<code>suid</code>，<code>dev</code>，<code>exec</code>，<code>auto</code>，<code>nouser</code>，<code>async</code></td>
</tr>
<tr>
<td><code>remount</code></td>
<td>重新挂载，重新更新参数时可以重新挂载</td>
</tr>
</tbody>
</table>
<p>例如将<code>/dev/sdb4</code>挂载到<code>/root/sdb4m</code>文件夹上：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mount</span> /dev/sdb4 /root/sdb4m/
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">df</span>
Filesystem              1K-blocks    Used Available Use% Mounted on
/dev/sda1                 <span class="token number">1038336</span>  <span class="token number">190536</span>    <span class="token number">847800</span>  <span class="token number">19</span>% /boot
tmpfs                      <span class="token number">386128</span>       <span class="token number">0</span>    <span class="token number">386128</span>   <span class="token number">0</span>% /run/user/0
/dev/sdb4                   <span class="token number">92580</span>     <span class="token number">332</span>     <span class="token number">87128</span>   <span class="token number">1</span>% /root/sdb4m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看挂载情况：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mount</span> <span class="token parameter variable">-l</span> <span class="token operator">|</span> <span class="token function">grep</span> sdb
/dev/sdb4 on /root/sdb4m <span class="token builtin class-name">type</span> ext3 <span class="token punctuation">(</span>rw,relatime,seclabel,data<span class="token operator">=</span>ordered<span class="token punctuation">)</span> <span class="token punctuation">[</span>boss<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="重新挂载"><a class="markdownIt-Anchor" href="#重新挂载"></a> 重新挂载</h1>
<p>如果进入维护模式，根目录以只读状态挂载的，可以使用重挂载功能将其挂载成可读写：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mount</span> <span class="token parameter variable">-o</span> remount,rw,auto /<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="卸载设备"><a class="markdownIt-Anchor" href="#卸载设备"></a> 卸载设备</h1>
<p>有些设备例如 CD 光驱，必须卸载了才能退出来。可以使用<code>umount</code>来卸载设备。</p>
<p>使用<code>-f</code>参数强制卸载，例如卸载硬盘<code>sdb4</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">umount</span> <span class="token parameter variable">-f</span> /root/sdb4m/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果加入<code>-f</code>卸载不掉还可以使用<code>-l</code>参数试试。</p>
<h1 id="开机挂载"><a class="markdownIt-Anchor" href="#开机挂载"></a> 开机挂载</h1>
<p>开机配置文件<code>/etc/fstab</code>实际上将挂载记录到<code>/etc/mtab</code>与<code>/proc/mounts</code>这两个文件中。</p>
<p>系统挂载的限制如下：</p>
<ul>
<li>根目录 <code>/</code> 必须挂载，并且必须先于其他挂载点进行挂载。</li>
<li>挂载点必须为已存在的目录。</li>
<li>每个挂载点在同一时间内，只能挂载一次。</li>
<li>每个分区在同一时间内，只能挂载一次。</li>
<li>若要进行卸载，必须先将工作目录移到挂载点之外。</li>
</ul>
<p>查看 <code>/etc/fstab</code> 文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/fstab
/dev/mapper/centos-root /                       xfs     defaults        <span class="token number">0</span> <span class="token number">0</span>
/dev/mapper/centos-swap swap                    swap    defaults        <span class="token number">0</span> <span class="token number">0</span>
        ^                ^                       ^         ^            ^ ^
      设备名            挂载点                  文件系统   挂载参数       备份 扫描<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以第一条为例从左到右分别为:</p>
<ul>
<li>第一列：需要挂载的设备名、Label 或 UUID。</li>
<li>第二列：挂载点（必须是目录）。</li>
<li>第三列：文件系统类型。</li>
<li>第四列：挂载参数，如 <code>defaults</code>、<code>rw</code>、<code>ro</code>、<code>noauto</code> 等。这里的默认值等于 <code>mount -o default</code> 时用的值。</li>
<li>第五列：是否需要使用 dump 命令备份，<code>0</code> 代表不需要备份，<code>1</code> 表示每天需要备份。</li>
<li>第六列：用 <code>fsck</code> 检查文件系统顺序，<code>0</code> 表示不需要检查，<code>1</code> 代表在根文件系统 <code>/</code> 之前检查，<code>2</code> 代表在其他文件系统之后检查。</li>
</ul>
<p>其实<code>/etc/fstab</code>（file system table）就是将我们利用<code>mount</code>命令挂载时所用到的参数写入到了文件。</p>
<p>例如，要在 <code>/dev/sdb4</code> 开机自动挂载到 <code>/root/sdb4m</code> 目录下，可以在 <code>/etc/fstab</code> 中添加一行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">vi</span> /etc/fstab
/dev/mapper/centos-root /                       xfs     defaults        <span class="token number">0</span> <span class="token number">0</span>
/dev/mapper/centos-swap swap                    swap    defaults        <span class="token number">0</span> <span class="token number">0</span>
/dev/sdb4 /root/sdb4m                           ext3    defaults        <span class="token number">0</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后用 <code>mount -a</code> 命令更新挂载状态:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mount</span> <span class="token parameter variable">-a</span> <span class="token punctuation">;</span> <span class="token function">df</span> <span class="token operator">|</span> <span class="token function">grep</span> sdb
/dev/sdb4                   <span class="token number">92580</span>     <span class="token number">332</span>     <span class="token number">87128</span>   <span class="token number">1</span>% /root/sdb4m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>可以看到硬盘已经挂载成功了。当系统重启时，<code>/dev/sdb4</code> 就会自动挂载到 <code>/root/sdb4m</code> 目录下了。</p>
<h1 id="特殊设备挂载"><a class="markdownIt-Anchor" href="#特殊设备挂载"></a> 特殊设备挂载</h1>
<p>意思为直接挂载存在硬盘中的镜像文件。也可以挂载大文件，作为虚拟磁盘使用。</p>
<p>例如挂载<code>/root/TinyCore-current.iso</code>到<code>/mnt/tinycore_iso</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">mount</span> <span class="token parameter variable">-o</span> loop /root/TinyCore-current.iso /mnt/tinycore_iso/
mount: /dev/loop0 is write-protected, mounting read-only
<span class="token punctuation">[</span>root@101c7 ~<span class="token punctuation">]</span>$ <span class="token function">df</span> <span class="token operator">|</span> <span class="token function">grep</span> loop
/dev/loop0                  <span class="token number">20348</span>   <span class="token number">20348</span>         <span class="token number">0</span> <span class="token number">100</span>% /mnt/tinycore_iso<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 CentOS 7 中可以省略<code>-o loop</code>参数。</p>
<h1 id="挂载内存盘"><a class="markdownIt-Anchor" href="#挂载内存盘"></a> 挂载内存盘</h1>
<p>所谓内存盘就是将一部分内存当作文件系统挂载起来，不过关机或卸载里面的资料会完全丢失。</p>
<p>在挂载时使用<code>-t ramfs none</code>参数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ <span class="token function">mount</span> <span class="token parameter variable">-t</span> ramfs none /root/ram
<span class="token punctuation">[</span>root@server1 ~<span class="token punctuation">]</span>$ <span class="token function">df</span> <span class="token parameter variable">-ha</span>
Filesystem               Size  Used Avail Use% Mounted on
none                        <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>    - /root/ram<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
  <entry>
    <title>Linux 中使用帮助</title>
    <url>/4039294623/</url>
    <content><![CDATA[<h1 id="帮助命令"><a class="markdownIt-Anchor" href="#帮助命令"></a> 帮助命令</h1>
<p>某些命令可以使用 <code>--help</code> 参数来查看简短的帮助信息。例如，要查看命令 <code>mkdir</code> 的帮助信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> <span class="token parameter variable">--help</span>
Usage: <span class="token function">mkdir</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. DIRECTORY<span class="token punctuation">..</span>.
Create the DIRECTORY<span class="token punctuation">(</span>ies<span class="token punctuation">)</span>, <span class="token keyword">if</span> they <span class="token keyword">do</span> not already exist.

Mandatory arguments to long options are mandatory <span class="token keyword">for</span> short options too.
  -m, <span class="token parameter variable">--mode</span><span class="token operator">=</span>MODE   <span class="token builtin class-name">set</span> <span class="token function">file</span> mode <span class="token punctuation">(</span>as <span class="token keyword">in</span> <span class="token function">chmod</span><span class="token punctuation">)</span>, not <span class="token assign-left variable">a</span><span class="token operator">=</span>rwx - <span class="token builtin class-name">umask</span>
  -p, <span class="token parameter variable">--parents</span>     no error <span class="token keyword">if</span> existing, <span class="token function">make</span> parent directories as needed
  -v, <span class="token parameter variable">--verbose</span>     print a message <span class="token keyword">for</span> each created directory
  <span class="token parameter variable">-Z</span>                   <span class="token builtin class-name">set</span> SELinux security context of each created directory
                         to the default <span class="token builtin class-name">type</span>
      --context<span class="token punctuation">[</span><span class="token operator">=</span>CTX<span class="token punctuation">]</span>  like -Z, or <span class="token keyword">if</span> CTX is specified <span class="token keyword">then</span> <span class="token builtin class-name">set</span> the SELinux
                         or SMACK security context to CTX
      <span class="token parameter variable">--help</span>     display this <span class="token builtin class-name">help</span> and <span class="token builtin class-name">exit</span>
      <span class="token parameter variable">--version</span>  output version information and <span class="token builtin class-name">exit</span>

GNU coreutils online help: <span class="token operator">&lt;</span>http://www.gnu.org/software/coreutils/<span class="token operator">></span>
For complete documentation, run: info coreutils 'mkdir invocation<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>一些特殊符号的含义：</p>
<ul>
<li>省略号<code>...</code>：表示可以有多个选项或参数。</li>
<li>中括号<code>[]</code>：之间的任何内容都是可选的。</li>
<li>大括号<code>&#123;&#125;</code>：表示应该选择由|隔开的各项中一个。</li>
<li>尖括号<code>&lt;&gt;</code>：内为变量表示参数可变。</li>
<li>不带中括号<code>[]</code>：表示<strong>必选项</strong>，必须作为命令的一部分输入。</li>
</ul>
<h1 id="查询手册"><a class="markdownIt-Anchor" href="#查询手册"></a> 查询手册</h1>
<p>使用 <code>man</code> 命令可以查询操作手册（manual），所有内建命令都有对应的操作手册页面。</p>
<p>手册存放在 <code>/usr/share/man</code> 目录中，可以通过修改 <code>/etc/man_db.conf</code> 文件来定义 man 查询手册的位置。</p>
<p>例如使用 <code>man</code> 命令查询 <code>mkdir</code> 命令的手册：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ <span class="token function">man</span> <span class="token function">mkdir</span>
MKDIR<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                      User Commands                                     MKDIR<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

NAME
       <span class="token function">mkdir</span> - <span class="token function">make</span> directories

SYNOPSIS
       <span class="token function">mkdir</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. DIRECTORY<span class="token punctuation">..</span>.

DESCRIPTION
       Create the DIRECTORY<span class="token punctuation">(</span>ies<span class="token punctuation">)</span>, <span class="token keyword">if</span> they <span class="token keyword">do</span> not already exist.

       Mandatory arguments to long options are mandatory <span class="token keyword">for</span> short options too.

       -m, <span class="token parameter variable">--mode</span><span class="token operator">=</span>MODE
              <span class="token builtin class-name">set</span> <span class="token function">file</span> mode <span class="token punctuation">(</span>as <span class="token keyword">in</span> <span class="token function">chmod</span><span class="token punctuation">)</span>, not <span class="token assign-left variable">a</span><span class="token operator">=</span>rwx - <span class="token builtin class-name">umask</span>

       -p, <span class="token parameter variable">--parents</span>
              no error <span class="token keyword">if</span> existing, <span class="token function">make</span> parent directories as needed

       -v, <span class="token parameter variable">--verbose</span>
              print a message <span class="token keyword">for</span> each created directory

 Manual page mkdir<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> line <span class="token number">1</span> <span class="token punctuation">(</span>press h <span class="token keyword">for</span> <span class="token builtin class-name">help</span> or q to quit<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 man 页面使用方向键浏览，用空格或[PageUp]，[PageDown]翻页。</p>
<p>输入/关键字来向下（?关键字向上）搜索手册中的内容，在搜索中按 n 和 N 进行正向查询和反向查询。</p>
<p>使用 <code>-f</code> 选项查询命令相关说明文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ <span class="token function">man</span> <span class="token parameter variable">-f</span> <span class="token function">date</span>
<span class="token function">date</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>             - print or <span class="token builtin class-name">set</span> the system <span class="token function">date</span> and <span class="token function">time</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>通常查询显示的是最低编号的内容（可以在 man_db.conf 中设置）。可以使用数字指定查询相应区块文档：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ <span class="token function">man</span> <span class="token parameter variable">-f</span> info
info <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>             - <span class="token builtin class-name">read</span> Info documents
info <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>             - readable online documentation
<span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ <span class="token function">man</span> <span class="token number">5</span> info
INFO<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>                                    File Formats Manual                                   INFO<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

NAME
       info - readable online documentation<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以使用 <code>-k</code> 选项进行模糊查询：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ <span class="token function">man</span> <span class="token parameter variable">-k</span> setse
setsebool <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>        - <span class="token builtin class-name">set</span> SELinux boolean value
<span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ <span class="token function">man</span> <span class="token parameter variable">-k</span> sets
cpupower <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         - Shows and sets processor power related values
ExtUtils::XSSymSet <span class="token punctuation">(</span>3pm<span class="token punctuation">)</span> - keep sets of symbol names palatable to the VMS linker
ipset <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>            - administration tool <span class="token keyword">for</span> IP sets
setsebool <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>        - <span class="token builtin class-name">set</span> SELinux boolean value
setsid <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>           - run a program <span class="token keyword">in</span> a new session
systemd.preset <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>   - Service enablement presets<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>man 手册约定：</p>
<table>
<thead>
<tr>
<th>区域号</th>
<th>所涵盖的内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>可执行程序或 shell 命令。</td>
</tr>
<tr>
<td>2</td>
<td>系统内核可调用的函数和工具等。</td>
</tr>
<tr>
<td>3</td>
<td>一些常用函数（Function）与函数库（Library），大部分为 C 的函数库（libc）。</td>
</tr>
<tr>
<td>4</td>
<td>设备文件的说明，通常在 <code>/dev</code> 下的文件。</td>
</tr>
<tr>
<td>5</td>
<td>配置文件或者是某些文件的格式。</td>
</tr>
<tr>
<td>6</td>
<td>游戏和演示。</td>
</tr>
<tr>
<td>7</td>
<td>惯例与协议等，例如文件系统、网络协议等名词解释。</td>
</tr>
<tr>
<td>8</td>
<td>只有超级用户和系统管理员可使用的系统管理命令。</td>
</tr>
<tr>
<td>9</td>
<td>内核例程，与 Kernel 有关的文件。</td>
</tr>
</tbody>
</table>
<h1 id="查询-info-文档"><a class="markdownIt-Anchor" href="#查询-info-文档"></a> 查询 Info 文档</h1>
<p>类似于在命令行中浏览网页，使用<code>info</code>可以查询存放在 <code>/usr/share/info/</code> 目录下的文档。例如，可以使用以下命令查询有关 <code>mkdir</code> 的信息：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>user1@101c7 root<span class="token punctuation">]</span>$ info <span class="token function">mkdir</span>
File: libc.info,  Node: Creating Directories,  Next: File Attributes,  Prev: Renaming Files,  Up: File Sys<span class="token punctuation">\</span>
tem Interface

<span class="token number">14.8</span> Creating Directories
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

Directories are created with the <span class="token string">'mkdir'</span> function.  <span class="token punctuation">(</span>There is also a
shell <span class="token builtin class-name">command</span> <span class="token string">'mkdir'</span> <span class="token function">which</span> does the same thing.<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其中，File 表示 info 页面的数据来源文件，Node 表示页面所属节点。<a href="http://xn--3ds.info">在.info</a> 的说明文件中，每个节点都有定位与链接，类似于超链接，可以快速跳转。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>1.基本操作</category>
      </categories>
  </entry>
</search>
